            [21:34 18/6/03 Bioinformatics-btn187.tex] Page: i357 i357i365 BIOINFORMATICS Vol.
24 ISMB 2008, pages i357i365doi:10.1093/bioinformatics/btn187 BLASTing small moleculesstatistics and extreme statistics of chemical similarity scores Pierre Baldi1,2,3, and Ryan W. Benz1,2 1Department of Computer Science, 2Institute for Genomics and Bioinformatics and 3Department of Biological Chemistry, University of California, Irvine, CA 92697-3435, USA ABSTRACT Motivation: Small organic molecules, from nucleotides and amino acids to metabolites and drugs, play a fundamental role in chemistry, biology and medicine.
As databases of small molecules continue to grow and become more open, it is important to develop the tools to search them efficiently.
In order to develop a BLAST-like tool for small molecules, one must first understand the statistical behavior of molecular similarity scores.
Results: We develop a new detailed theory of molecular similarity scores that can be applied to a variety of molecular representations and similarity measures.
For concreteness, we focus on the most widely used measurethe Tanimoto measure applied to chemical fingerprints.
In both the case of empirical fingerprints and fingerprints generated by several stochastic models, we derive accurate approximations for both the distribution and extreme value distribution of similarity scores.
These approximation are derived using a ratio of correlated Gaussians approach.
The theory enables the calculation of significance scores, such as Z-scores and P-values, and the estimation of the top hits list size.
Empirical results obtained using both the random models and real data from the ChemDB database are given to corroborate the theory and show how it can be applied to mine chemical space.
Availability: Data and related resources are available throughContact: pfbaldi@ics.uci.edu 1 INTRODUCTION Small organic molecules, from nucleotides and amino acids to metabolites and drugs, play a fundamental role in chemistry, biology, and medicine.
As chemical repositories of small molecules continue to grow and become more open (Chen et al., 2005, 2007; Irwin and Shoichet, 2005), it becomes increasingly important to develop the tools to search them efficiently.
In one of the most typical settings, a query molecule is used to search millions of other compounds not only for exact matches, but also for approximate matches.
In a drug discovery project, for instance, one may be interested in retrieving all the commercially-available compounds that are similar to a given lead, with the aim of finding compounds with better physical, chemical, biological or pharmacological properties.
Likewise, in a reverse synthesis project, one may be interested in identifying small molecules that can explain a mass spectrometry signature, or can be used used as building blocks for the artificial synthesis of a metabolite or a natural product.
The idea of searching for molecular cousins is of course not new, and constitutes one of the pillars of bioinformatics where one routinely searches for To whom correspondence should be addressed.
homologs of nucleotide or amino acid sequences.
Search tools such as BLAST (Altschul et al., 1997) and its significance e-scores have become de facto standards of modern biology, and have driven the exponential expansion of bioinformatics.
While molecular similarity is different from molecular homology in that it is not predicated on an underlying evolutionary process, there is no reason to believe that a BLAST-like tool for small molecules cannot be developed.
Indeed, many different representations and similarity measures have been developed in chemoinformatics over the years (Leach and Gillet, 2005).
Yet no consensus tool such as BLAST has emerged.
One of the reasons behind the lack of consensus is that there has been no systematic, large-scale, open study of molecular similarity scores, and their statistical distributions and significance levels.
As a result, the majority of existing chemical search engines do not return a score with the molecules they retrieve, let alone any measure of significance.
Examples of fundamental questions one would like to address include: What threshold should one use to assess significance in a typical search?
Is a Tanimoto score of 0.4 significant or not?
How many molecules should be expected to have a score above 0.4 and under which assumptions?
How does the answer depend on the size of the database being queried?
How does the answer depend on the type of query used?
A clear answer to these questions is critical for unifying existing chemical databases and search methods, for assessing the significance of a similarity score, and ultimately for helping to better understand the nature of chemical space.
Here we address these questions by conducting a systematic statistical study of chemical similarity scores and their extreme values as a function of, for instance, database size.
To do so, in Section 2, we first define the molecular representations and similarity scores to be used in the study.
Then, in Section 3, we introduce the probabilistic models required to both approximate empirical distributions of similarity scores and to create random models of the background similarity scores against which significance can be assessed.
In Section 4, we develop the theory for the distribution of the similarity scores, and in Section 5 the theory for the distribution of the extreme values of these similarity scores.
Experimental results to illustrate and corroborate the theory are described in Section 6 followed by a discussion and conclusions in Section 7.
2 MOLECULAR REPRESENTATIONS AND SIMILARITY SCORES Many different representations and similarity scores have been developed in chemoinformatics (Leach and Gillet, 2005).
The methods to be described are very broadly applicable but, for brevity, we illustrate the theory using one of the most commonly 2008 The Author(s) This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/2.0/uk/) which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.
file:pfbaldi@ics.uci.edu [21:34 18/6/03 Bioinformatics-btn187.tex] Page: i358 i357i365 P.Baldi and R.W.Benz used frameworks across chemoinformatics platforms, namely binary fingerprint representations with Tanimoto similarity scores.
2.1 Molecular representations: fingerprints To search large databases of compounds by similarity, most modern chemoinformatics systems use a fingerprint vector representation (Baldi et al., 2007; Fligner et al., 2002; Flower, 1998; James et al., 2004; Leach and Gillet, 2005; Xue et al., 2003, 2004) whereby a molecule is represented by a vector whose components index the presence/absence, or the number of occurrences, of a particular functional group, feature or substructure in the molecular bond graph.
Because binary fingerprints are used in the great majority of cases, here we present the theory for these fingerprints, but it should be clear that the theory can readily be adapted to fingerprint based on counts.
We use A to denote a molecule and A= (Ai) to denote the corresponding fingerprint vector.
We let A denote the number of bits set to 1 (1-bits) in the fingerprint A (A=|A|).
In early chemoinformatics systems, fingerprint vectors were relatively short, containing typically a few dozen components selected from a small set of features, hand-picked by chemists.
In most modern systems, however, the major trend is towards the combinatorial construction of extremely long feature vectors with a number of components N that can vary in the 103106 range, depending on the set of features.
Examples of typical features include all possible labeled paths or labeled trees, up to a certain depth.
The advantage of these much longer, combinatorially-based representations is 2-fold.
First, they do not require expert chemical knowledge, which may be incomplete or unavailable.
Second, they can support extremely large numbers of compounds, such as those that are starting to become available in public repositories and commercial catalogs, as well as the recursively enumerable space of virtual molecules (Bohacek et al., 1996).
The particular nature of the fingerprint components is not essential for the theory.
To illustrate the principles, in the simulations we use both fingerprints based on labeled paths and fingerprints based on labeled shallow trees with qualitatively similar results.
For brevity and consistency, the examples reported in the Results are derived primarily using fingerprints based on paths.
2.2 Fingerprint compression In many chemoinformatics systems, the long sparse fingerprint vectors are often compressed to much shorter and denser binary fingerprint vectors.
The most widely used method of compression is a lossy compression method based on the application of the logical OR operator to the binary fingerprint vector after modulo wrapping to 1024 bits (James et al., 2004).
Thus component i of the compressed fingerprint is set to 0 if and only if all the positions i modulo 1024 are set to 0 in the uncompressed fingerprint.
Other more efficient lossless methods of compression have recently been developed (Baldi et al., 2007).
With the proper and obvious adjustments, our results are applicable to both lossy compressed and uncompressed fingerprints.
Because lossy compressed representations are the most widely used, we report the majority of our results using modulo-OR compressed binary fingerprints of length N =1024.
Due to their smaller size, these also have the advantage of speeding up Monte Carlo sampling simulations.
2.3 Similarity scores Several similarity measures have been developed for molecular fingerprints (Holliday et al., 2002; Leach and Gillet, 2005; Swamidass and Baldi, 2007).
Given two molecules A and B, the Tanimoto similarity measure is given by S(A,B)=S(A, B)= (AB)/(AB) (1) Here (AB) denotes the size of the intersection, i.e.the number of 1-bits common to A and B, and AB denotes the size of the union, i.e.the number of 1-bits in A or B.
Because the Tanimoto similarity is by far the most widely used, the theory and experimental results reported here are based on Tanimoto similarity.
However, the same theory can readily be applied to all the other measures.
To see this, it suffices to note that the other measures consist of algebraic expressions built from AB and AB, as well as other obvious terms such as A, B, and sometimes N. For instance, the Tversky measure (Rouvray, 1992; Tversky, 1977) is defined as S (A, B)= AB/[A+B+(1)(AB)], where the parameters and can be used to tune the search towards the sub-structures or superstructures in the query molecule.
The theory to be presented begins precisely by studying the statistical distribution and properties of the intersection and the union, in particular their mean, variance and covariance.
Thus, the distribution and statistical properties of all the other similarity measures can readily be derived from the distributions analyzed in this article.
For this reason, we focus on the Tanimoto score, which can be viewed as the chemoinformatics analog of the alignment score in bioinformatics.
2.4 Data In the simulations and results, we illustrate the methods using fingerprints of molecules randomly sampled from the 5 M molecules available in the ChemDB database (Chen et al., 2005, 2007), or randomly generated using the stochastic generative models described in Section 3.
The empirical fingerprints are generated by indexing all the labeled paths of length up to eight, or all the labeled trees of depths up to two present in the molecular bond graph.
The labels on the vertices correspond to the atom type (e.g.C, N, O) while the labels on the edges correspond to the bond type (e.g.single, double, triple).
The exact details of the fingerprints, which are not important for this study, can be found in (Baldi et al., 2007) and
