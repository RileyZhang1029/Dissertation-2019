Bioinformatics, 31(16), 2015, 2614–2622
doi: 10.1093/bioinformatics/btv193
Advance Access Publication Date: 5 April 2015
Original Paper

Sequence analysis

EBSeq-HMM: a Bayesian approach for
identifying gene-expression changes in
ordered RNA-seq experiments
Ning Leng1,2, Yuan Li1, Brian E. McIntosh2, Bao Kim Nguyen2,
Bret Duffin2, Shulan Tian2, James A. Thomson2,3,4, Colin N. Dewey5,
Ron Stewart2 and Christina Kendziorski5,*

1Department of Statistics, University of Wisconsin, Madison, WI, USA, 2Regenerative Biology, Morgridge Institute
for Research, Madison, WI, USA, 3Department of Cell and Regenerative Biology, University of Wisconsin School of
Medicine and Public Health, Madison, WI, USA, 4Department of Molecular, Cellular, and Developmental Biology,
University of California, Santa Barbara, CA, USA and 5Department of Biostatistics and Medical Informatics,
University of Wisconsin, Madison, WI, USA

*To whom correspondence should be addressed.
Associate Editor: Inanc Birol

Received on October 14, 2014; revised on February 23, 2015; accepted on March 30, 2015

Abstract

Motivation: With improvements in next-generation sequencing technologies and reductions in
price, ordered RNA-seq experiments are becoming common. Of primary interest in these experi-
ments is identifying genes that are changing over time or space, for example, and then characteriz-
ing the speciﬁc expression changes. A number of robust statistical methods are available to
identify genes showing differential expression among multiple conditions, but most assume condi-
tions are exchangeable and thereby sacriﬁce power and precision when applied to ordered data.
Results: We propose an empirical Bayes mixture modeling approach called EBSeq-HMM.
In
EBSeq-HMM, an auto-regressive hidden Markov model is implemented to accommodate depend-
ence in gene expression across ordered conditions. As demonstrated in simulation and case
studies, the output proves useful in identifying differentially expressed genes and in specifying
gene-speciﬁc expression paths. EBSeq-HMM may also be used for inference regarding isoform
expression.
Availability and implementation: An R package containing examples and sample datasets is avail-
able at Bioconductor.
Contact: kendzior@biostat.wisc.edu
Supplementary information: Supplementary data are available at Bioinformatics online.

1 Introduction

With improvements in next-generation sequencing technologies and
reductions in price, ordered RNA-seq experiments are becoming
common. Of primary interest in these experiments is characterizing
how genes are changing over some factor with ordered levels (for
in space, along a gradient, etc).
example, ordered in time,

For simplicity, we refer to any ordered RNA-seq experiment as a
time-course experiment, noting that other similar designs may be
analyzed within this framework; and we restrict attention to time-
course data collected within a single biological condition.

In a time-course RNA-seq experiment, an investigator may be
interested in genes that are monotonically increasing or decreasing,

2614
VC The Author 2015. Published by Oxford University Press.
This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/4.0/),
which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact
journals.permissions@oup.com

EBSeq-HMM: Identify expression changes in ordered RNA-seq experiments

2615

that increase initially then decrease, that increase initially then re-
main unchanged and so on. We refer to these types of changes in ex-
pression hereinafter as expression paths, and we consider three
broad types: (i) constant paths: expression remains unchanged, or
equally expressed (EE), over all time points; (ii) sporadic paths: ex-
pression shows some change between at least one pair of time
points, but remains unchanged between at least one other pair and
(iii) dynamic paths: expression changes continuously. With respect
to the examples listed earlier, the first few (expression is monotonic-
ally increasing, monotonically decreasing, increasing then decreas-
ing) are instances of dynamic paths. The last (increase initially then
remain unchanged) is an example of a sporadic path.

A number of robust statistical methods are available for identify-
ing differentially expressed (DE) genes [EBSeq (Leng et al., 2013),
DESeq2 (Love et al., 2014), edgeR (Robinson et al., 2010), voom
(Law et al., 2014), baySeq (Hardcastle and Kelly, 2010), Cuffdiff2
(Trapnell et al., 2012)] as well as isoforms [EBSeq, rSeqDiff (Shi and
Jiang, 2013), Cuffdiff2, BitSeq (Glaus et al., 2012)] in a static RNA-
seq experiment; and most of these methods accommodate time-
course experiments by considering time as a factor with multiple,
unordered, levels (Supplementary Section S7 provides details). The
statistical tests employed are designed to identify a gene as DE if it
shows a change at least one time point; and, consequently, non-con-
stant genes are detected collectively. Multiple steps of subsequent
analyses are required if an investigator wants to distinguish sporadic
paths from dynamic ones, to classify genes into distinct paths and to
assess the associated classification uncertainty—for example, per-
form model fitting multiple times with different design matrices and
then adjust for multiple testing. In addition, as these approaches
were not designed specifically for time-course experiments, they do
not accommodate dependence over time and consequently sacrifice
power if applied in this setting.

These same issues were addressed in the context of microarray
time-course experiments, and a number of methods are available for
analyzing (Conesa et al., 2006; Filkov et al., 2002; Ma et al., 2009;
Yuan and Kendziorski, 2006) and clustering (Ernst et al., 2005;
Luan and Li, 2003) time-course microarray data. These methods are
not directly applicable to RNA-seq studies since they do not accom-
modate count data, the unequal variabilities in measurements or the
dependence of isoforms within genes. To address this, the approach
developed by Conesa et al. (2006), maSigPro, originally developed
for microarray time-course analysis, was recently extended to ac-
commodate ordered RNA-seq count data (Nueda et al., 2014). Like
DESeq2 and edgeR, maSigPro-GLM is based on a negative binomial
(NB) generalized linear model
(GLM); but unlike previous
approaches, maSigPro-GLM defines gene-specific expected expres-
sion by a time-dependent polynomial to accommodate dependence
over time. Once significant genes are selected, a second regression is
conducted for each gene to identify the time points at which it shows
expression differences. Clustering algorithms are then applied to the
resulting regression coefficients and/or expression values to identify
groups of genes with similar expression profiles. Although useful the
two step procedure makes it challenging to determine appropriate
thresholds for false discovery rate (FDR) control, and suggested
thresholds are conservative in many settings (Nueda et al., 2014). In
addition, identified gene groups are subject to limitations inherent in
clustering algorithms; namely, the number of groups as well as
group membership are determined by user-defined cutoffs, there is
no probabilistic information associated with a given gene’s member-
ship within a group, and it is not clear how to classify gene groups
into expression paths.

To address these considerations, we have developed an empirical
Bayes auto-regressive hidden Markov model (HMM) based ap-
proach called EBSeq-HMM. The model extends our previous work,
EBSeq, for identifying DE genes and isoforms across two or more
biological conditions (Leng et al., 2013). As detailed in Methods, an
auto-regressive process describes changes in expression over time,
and a hidden Markov component is used to accommodate depend-
ence. EBSeq-HMM allows users to identify genes with non-constant
expression over multiple ordered conditions, and simultaneously
classify them into expression paths. Results from a simulation study,
detailed in Section 3.1, suggest that EBSeq-HMM has increased
power over competing approaches for identifying genes following
non-constant paths, especially for those genes showing subtle yet
consistent changes over time. EBSeq-HMM also provides improved
accuracy in classifying genes into expression paths. Similar results
are demonstrated in a case study of the adult mouse limb presented
in Section 3.2.

2 Methods

2.1 EBSeq-HMM: an empirical Bayes auto-regressive
Hidden Markov model
EBSeq-HMM requires estimates of gene or isoform expression col-
lected over three or more ordered levels of a factor. The general
model is presented for gene-level analysis; the isoform-level model is
discussed in Section 2.3. To simplify the presentation, we refer to
ordered levels as time points denoted by t ¼ 1; 2; . . . ; T, noting that
the method directly accommodates other ordered data structures
(e.g. ordered in space, along a gradient, etc.).

Let Xt be a G  Nt matrix of expression values for G genes in Nt
samples at time t. The full set of observed expression values is then
denoted by X ¼ ðX1; X2; . . . ; XTÞ. With a slight abuse of notation,
let Xg denote one row of this matrix containing data for gene g over
time; Xgtn denotes expression values for gene g at time t in sample n.
Of interest are changes in the latent mean expression levels for gene
g: lg1; lg2; . . . ; lgT . We allow for three possibilities, or states, to de-
scribe such changes: Up, Down, EE. If lt 1 < lt, we define state SDt
as Up; if lt 1 > lt; SDt is Down and lt 1 ¼ lt defines SDt as EE. The
main goals in an ordered RNA-seq experiment—identifying genes
that change over time, and specifying each genes’ expression path—
can be restated as questions about these underlying states. In short,
for each gene g and each transition between t 1 and t, we would
like to estimate the probability of each state. A gene is said to follow
a non-constant path if at least one state is not EE. We would also
like to estimate the most likely expression path, which is given by
the configuration of expression states over time (SD2
g ),
noting that the most likely configuration of states need not equal the
collection of states that define SDt
g marginally at each t (an example
is provided in Section 3.1).

g ; . . . ; SDT

g ; SD3

To make inference regarding these states, we propose a
model for the set of expression measurements taken on a gene g.
We make the common and well-supported assumption that gene
expression in an RNA-seq experiment is well described by a NB dis-
tribution (Anders and Huber, 2010; Hardcastle and Kelly, 2010;
Love et al., 2014; Nueda et al., 2014; Robinson et al., 2010;
Trapnell et al., 2012). Were we to consider time t in isolation,
this implies Xgtnjrgt; qgt  NBðrgt; qgtÞ where the NB distribu-
tion may be parameterized such that lgt ¼ rgtð1   qgtÞ=qgt. For sim-
plicity of notation, we assume equal
library sizes. Details on
adjustments for unequal library sizes are given in Supplementary
Section S2.

2616

N.Leng et al.

g; qg; t 1Þ where ns

g ¼ c if s is Up; ns

Because our interest here is in quantifying changes in Xgt over
time, we assume expression at time t depends on that at t 1 through
parameters r and q. Specifically, ðXgtnjrg; t 1; qg; t 1; SDt
g ¼ sÞ 
NBðrg; t 1 ns
g ¼ 1=c if s is Down
g ¼ 1 if s is EE. The data dependent parameter c specifies the
and ns
expected change associated with each state. For example, if c¼ 2,
g ¼ Up refers to a 2-fold increase in expression between t 1
then SDt
and t. Although c may be defined by a user, we suggest estimation
by maximum likelihood (see the next section). We further model
fluctuations in lgt by defining a prior distribution for qgt : ðqgtja; b;
Xg; t 1 ¼ xg; t 1Þ  Betaða þ Nt 1 rg; t 1; b þ
xg; t 1; jÞ for all g
and t > 1. Given this set-up, when t > 1, the marginal predictive con-
ditional distribution describing expression (or emissions) for each
state is Beta-NB: ðXgtnjXg; t 1 ¼ xg; t 1; SDt
g ; HÞ  Beta–NBða þ Nt 1
rg; t 1; b þ
g. The ex-
xg; t 1; jÞ=ða þ Nt 1
pected mean is then defined as ns
rg; t 1Þ (Teerapabolarn, 2008). When t¼ 1, the prior distribution for
qg1 is defined as ðqg1ja; bÞ  Betaða; bÞ for all g, and the marginal
predictive distribution is ðXg1njHÞ  Beta–NBða; b; rg;1Þ.

grg; t 1Þ where H ¼ ½a; b; rg; t 1; ns

grg; t 1ðb þ

xg; t 1;j; ns

X

X

X

j

j

j

g

For genes with dynamic paths, each state SDt

g is dependent on the
prior state SDt 1
since these genes represent continuous changes over
time. To accommodate this dependence, we assume that the state
process is described by a Markov chain. The constant and sporadic
genes do not show continuous changes over time, and consequently
we assume that states are independent, although we note that de-
pendence among expression levels is still accommodated via the
auto-regressive component.

In summary, the time-course Xg for a dynamic gene is governed
by two interrelated probabilistic mechanisms: the conditional distri-
bution (emissions model) at each time and the process describing the
evolution of states over time. Initially, we assume that the observed
expression vector can be characterized by the Beta-NB model
described earlier and that the state process can be described by a
Markov chain. Were it the case that dependence among measure-
ments is fully captured by the state process, the proposed model
would be a standard HMM. However, this last assumption does not
hold, given that Xt for dynamic genes depends not only on the state
SDt but also on Xt 1 through rt 1. Consequently, the model for dy-
namic genes is given by a Markov-switching auto-regressive model,
as in Hamilton (1989) and Ailliot and Monbet (2012) (Fig. 1). For
constant and sporadic genes, we assume the same emissions model,
but do not assume the state process is Markov. Taken together, since
we do not know the expression path type a priori, the model for the
full set of expression measurements is a two-component mixture
over the sporadic/constant and dynamic genes.

2.2 Parameter estimation
In the emissions distributions, the unknown parameters (r’s, a and
b) are estimated using the method of moments (r’s are estimated
within time point while a and b are estimated using all samples); c is
estimated via maximum likelihood. Recall that EBSeq-HMM as-
sumes a mixture model with a Markov component m1 and a non-
Markov component m2. We assume equal prior probabilities of
being in each mixture component.

In Markov chain m1, the Baum-Welch algorithm is used to esti-
g ¼ jjm1Þ and state transition probabilities
mate initial pj ¼ PðSD2
at;tþ1
g ¼ d; m1Þ for t2. Here, we assume a non-
g ¼ jjSDt
dj ¼ PðSDtþ1
homogeneous Markov chain for the hidden states so at;tþ1
’s are dif-
ferent for different t’s. Denote the vector of initial probabilities and


the state transition matrices estimated from the last step as p
; A
.
Þ


g ¼ PðMg ¼ m1jXg; p
Given parameter estimates p
; A

, define zm1


; A

dj

Fig. 1. (a) An auto-regressive hidden Markov component models dynamic
paths. (b) An auto-regressive non-hidden Markov component models con-
stant and sporadic paths

g ¼ j; Xg;t 1 ¼ xg;t 1Þ. The forward and back-
and bjðXgtÞ ¼ PðXgtjSDt
ward steps of the Baum-Welch algorithm are then defined as
X
follows:
ag;jðtÞ ¼ ½
X
g ¼ jjm1Þ
½bg;dðt þ 1ÞbdðXg;tþ1Þa

/ PðXg1; . . . ; Xgt; SDt

ag;dðt   1Þa

bg;jðtÞ ¼

bjðXg;tÞ

t 1;t
dj

t;tþ1
jd



d

d

The initial and state transition probabilities are updated by:

at;tþ1
D;J ¼

¼

/ PðXg;tþ1; . . . ; XgTjXgt; SDt

g ¼ j; m1Þ

Þ

g ¼ J; Mg ¼ m1jXg; p
Þ

g ¼ j; Mg ¼ m1jXg; p
; A

; A

j

g

g

g

g ¼ D; SDtþ1
PðSDt
g ¼ D; SDtþ1

X
X
X
PðSDt
X
X
X
ag;DðtÞa
X
ag;DðtÞa
X
X
PðSD2
pJ ¼
X
X
X
ag;Jð2Þbg;Jð2Þzm1
ag;jð2Þbg;jð2Þzm1

¼

g

g

g

g

g

j

j

g

t;tþ1
D;J bg;JðXg;tþ1Þbg;Jðt þ 1Þzm1
t;tþ1
D;j bg;jðXg;tþ1Þbg;jðt þ 1Þzm1

g

g

Þ
g ¼ J; Mg ¼ m1jXg; p
Þ
PðSD2
g ¼ j; Mg ¼ m1jXg; p

g

j

Parameters are estimated by fixing expected fold-change (FC) c
at 1.2. The process is then repeated for c in (1.4, 1.6, . . . , 3); and
the parameter set with maximum likelihood is used in the final
model.

2.3 Inference at the isoform level
The model detailed in the previous section applies to gene counts.
To apply the approach to isoforms, the uncertainty inherent in
isoform expression estimation should be accommodated. In short,

EBSeq-HMM: Identify expression changes in ordered RNA-seq experiments

2617

estimating expression at the gene-level is a relatively easy task in
RNA-seq as all reads mapping to a gene’s constituent exons may be
used. The same holds true for estimating expression for an isoform
unique to its parent gene. However, for genes with multiple iso-
forms, the problem is more challenging as reads mapping to overlap-
ping exons (exons present in more than one isoform) must be
allocated to isoforms in a way that is consistent with their expres-
sion. Consequently, there is increased uncertainty (on average) in ex-
pression estimates for isoforms with multiple overlapping exons,
referred to as complex isoforms; and the uncertainty has been shown
to have a substantial effect on downstream analysis methods (Leng
et al., 2013).

Specifically, define an isoform of gene g as belonging to the
Ig¼ k group, for example, where k¼ 1, 2 or 3, if the total number of
isoforms from gene g is k (the Ig¼ 3 group contains all isoforms
from genes having 3 or more isoforms). Leng et al. (2013) demon-
strated that there is decreased variability in the Ig¼ 1 group, but
increased variability in the others, due to the relative increase in un-
certainty inherent in estimating isoform expression when multiple
isoforms of a given gene are present. This observation is not specific
to the dataset and/or the method used for isoform expression estima-
tion; it is also not specific to the particular method used for quan-
tifying isoform complexity.

To adjust for the increased uncertainty inherent in complex iso-
form expression estimates, we allow the Beta prior to depend on iso-
gija; bIg  Betaða; bIgÞ. The hyperparameter a is shared
form group: qC
across isoforms, but here b depends on Ig, accommodating the sys-
tematic differences in variability among the Ig groups. Ig quantifies a
measure of isoform complexity and may be defined by the user as
the number of isoforms from a gene, as described earlier. It could
also be defined by an isoform’s mappability score or credibility
interval as provided by Koehler et al. (2011), Li and Dewey (2011)
or Derrien et al. (2012).

2.4 Simulated data
We followed the simulation setup of Robinson and Smyth (2007) by
defining counts as NB with gene-specific mean in sample n and time
point t given by lgt and variance lgtð1 þ lgt/gtÞ. The (lgt, /gt)’s
were sampled as pairs from the mouse limb case study data
described in the next section. Paired sampling was done to preserve
the mean-variance relationship observed in most RNA-seq datasets.
Each simulated dataset contains 10 000 genes and 15 samples which
represent three biological replicates at each of five time points. One
hundred datasets were considered for each simulation scenario.

2.4.1 Sim I
Sim I considers dynamic changes over time for 60% of the genes,
which matches the percentage in the case study data. For these
genes, paths were generated from an HMM. With five conditions,
there are four states in the hidden chain (as shown in Fig. 1), so
three state transition matrices were used. We defined the initial
transition matrices as
probabilities as 0.5 and the

 

!

 

!

 

!

0:9 0:1

0:2 0:8

,

0:1 0:9

0:8 0:2

and

state
0:9 0:1

0:1 0:9

, which resulted in

Up-Up-Down-Down and Down-Down-Up-Up being the two most
frequent expression paths. Note that other paths were realized as
well, although with fewer genes. Once a gene’s particular path
(collection of states) was generated, lg;tþ1 was simulated as lgt
multiplied (divided) by d if SDtþ1
g was Up (Down). For one-half of
the dynamic genes, we simulated strong effects, with d sampled

from empirical FCs between 1.3 and 1.4 calculated using case
study data. The other one-half represent weak effects with d
sampled from empirical FCs between 1.2 and 1.3. The remaining
40% of genes were simulated as constant meaning the latent level
of expression remains unchanged across conditions. To simulate
genes following constant paths, we only took the genes whose
simulated empirical FC of medians between any two adjacent time
points was within (1/1.2, 1.2).

2.4.2 Sim II
For this simulation scenario, 40% of the 10 000 genes were simu-
lated as dynamic as in Sim I and another 20% were simulated as
sporadic. For dynamic genes, paths were generated from an HMM
as described in Sim I; half were simulated as strong effects and the
other half were with weak effects. For the sporadic genes, a time
point t was chosen at random and lgt was defined as lgt  d, where d
was sampled from empirical FCs between 1.3 and 1.4. The remain-
ing 40% of genes were simulated as constant, again as described in
Sim I.

2.5 Case study data
Of interest in our case study, detailed below, is RNA-seq data from
the James Thomson Lab at the Morgridge Institute for Research.
We evaluated gene expression from seven positions along the mouse
limb: proximal stylopod, distal stylopod, elbow, proximal zeugo-
pod, distal zeugopod, autopod and digit. Three 12-week old C57BL/
6J female mice were euthanized by cervical dislocation, followed by
the extraction of the right forelimb. The tissues were treated with
RNAlater (Sigma), per manufacturers instructions, dissected using a
SteREO Discovery.V8 microscope (Zeiss), and stored at  20C.
The tissues were homogenized and lysed using a variable speed rotor
stator homogenizer and Qiazol (Qiagen). Total RNA was extracted
from the homogenized tissue samples using Qiagen’s RNeasy Lipid
Tissue Mini (digits) and Midi (all other) Kits. A total of 21 samples
were sequenced using Illumina’s Directional mRNA-Seq protocol
(Part # 15018460 Rev. A). The reads are single-end with read length
42-bp. Each sample was run on one lane of an Illumina GAII in a
randomized order to reduce batch effects. Alignment was done using
Bowtie (Langmead et al., 2010) with the hg19 RefSeq annotation.
Expression estimates were obtained from RSEM (Li and Dewey,
2011) and library size factors were obtained using median-of-ratios
normalization (Anders and Huber, 2010). See Supplementary
Section S7 for package versions and further details.

2.6 Identification of DE genes and classification
EBSeq-HMM is compared with EBSeq, DESeq2, edgeR, voom,
maSigPro and a naive method based on FC. See Supplementary
Section S7 for package versions and further details. Two tasks are of
interest: identifying DE genes, defined as those showing any change
across conditions; and assigning DE genes into their most likely ex-
pression path.

2.6.1 Identification of DE genes
To identify a list of DE genes with FDR a via EBSeq-HMM or
EBSeq, we take those genes for which the posterior probability (PP)
of being constant is less than or equal to a.

Both DESeq2 and edgeR implement a generalized-linear model
to test H0: data intercept versus H1: data interceptþ condition
with derived P-values adjusted for multiplicities using Benjamini
and Hochberg (1995). To construct a list of DE genes with target
FDR a, we consider those genes with adjusted P-values less than or

2618

N.Leng et al.

equal to a. As detailed in Law et al. (2014), the voom approach first
estimates the precision weights based on the inverse variance, then
applies the limma empirical Bayes pipeline taking the precision
weights as prior information to account for the unequal variabilities
in RNA-seq data. A similar hypothesis test was performed as in
DESeq2 and edgeR, and the P-values were adjusted using
Benjamini-Hochberg as well. Genes with adjusted P-values less than
or equal to a were considered.

As suggested in the maSigPro user manual, we applied the GLM
method in the maSigPro package with the NB family and default
parameter settings. We also considered two additional settings.
Specifically, maSigPro uses an R2 value to obtain a sorted gene list.
However, it is not clear how to pick an R2 threshold that gives a
gene list with FDR controlled at some target level. The authors sug-
gest 0.7 as the default R2 value. In addition to this default setting,
we also considered R2 thresholds of 0.5 and 0.3 to evaluate
maSigPro more thoroughly.

For the naive FC method, denote medt

g as the median expression
of gene g at time point t. A gene g is called Up (Down) between t
and tþ 1 if
evaluate five values of K: 1.2, 1.3, 1.5, 2 and 2.5. A gene is defined
as DE if it is non-EE at any transition.

is greater than (less than) K; otherwise, it is EE. We

medtþ1
g
medt
g

2.6.2 Classification of genes into expression paths
Recall that EBSeq-HMM provides gene-specific posterior probabil-
ities associated with each expression path. For EBSeq-HMM, a DE
gene is classified into a specific expression path if its PP of being in
that path exceeds 0.5. Selecting genes with PP > 0.5 ensures that the
posterior maximizing class always minimizes the Bayes risk regard-
less of choice of the metric loss function (Schlu¨ ter et al., 2005), al-
though we note that there may be reasons to consider different
thresholds in some situations (Section 4). For EBSeq, DESeq2,
edgeR, voom and maSigPro, classifying DE genes into expression
paths is not of interest, and no clear guidelines on how to do so is
provided. Consequently, these methods are not evaluated for expres-
sion path classification. Finally, since no uncertainty measure of as-
signment is available using FC, for the FC analysis a gene is classified
into the path defined by the Up/Down/EE calls across transitions.

3 Results

3.1 Simulation results
Simulation studies were conducted to investigate the operating char-
acteristics of EBSeq-HMM and to assess how it compares with
EBSeq, DESeq2, edgeR, voom, maSigPro and FC analysis. As de-
tailed in Methods, each simulated dataset derives counts from a NB
model. Like EBSeq-HMM, EBSeq, DESeq2, edgeR and maSigPro
also assume that counts are distributed as NB, and consequently,
this assumption should not provide advantage, or lack thereof, to
any one method in particular. As the form of the variance is that
assumed in edgeR, there may be a slight advantage given to that
method. Parameter estimates were derived from case study data to
help ensure that many features of real data are preserved in the
simulation (e.g. mean/variance relationship and magnitude of FCs;
Section 2.4 and the Supplement Section S3 for more details).

Table 1 shows the power and FDR for identifying dynamic genes
in Sim I, where the target FDR is controlled at 5%. In addition to
showing power overall, it is also shown separately for strong and
weak effects (FDR is not shown for each subgroup because false dis-
coveries are discoveries of EE genes and therefore cannot be

classified as strong or weak). EBSeq-HMM has higher power than
EBSeq, DESeq2, edgeR and voom, which is largely due to its ability
to identify genes showing subtle, yet consistent, changes over time.
Specifically, the power of the five methods is comparable for genes
with strong effects, but EBSeq-HMM shows advantage in identify-
ing genes where changes between any two points are relatively
small. An example of two genes identified exclusively by EBSeq-
HMM is shown in Figure 2 [panels (a) and (b)]. It is clear from the
figure that the change between any two points is small (FC < 1.3)
and in some cases these changes would not be identified by a mar-
ginal analysis between adjacent time points [e.g. time points 1 and 2
in Fig. 2b], but EBSeq-HMM identifies the genes as dynamic given
the consistent changes over time.

Note that although EBSeq-HMM has the highest empirical FDR
among these five methods, it is still well-controlled under the 5%
target FDR. In fact, among all approaches, the empirical FDR from
EBSeq-HMM is closest to the target FDR. To better understand the
overall performance of each method, the third column in Table 1
shows the F1 score. The F1 score measures a test’s accuracy account-
ing for both power and false discoveries, where an F1 score reaches
its best value at 1 and worst at 0. EBSeq-HMM has the highest F1
score among all approaches.

In addition, Table 1 shows that [consistent with other studies
(Nueda et al., 2014)],
the suggested threshold of maSigPro
(R2 ¼ 0:7) is conservative and provides lower power than EBSeq-
HMM, EBSeq, DESeq2, edgeR and voom. The power is improved
by relaxing the threshold, but is still lower than others. The FC ana-
lysis works best at threshold 1.3, but is still inferior to the other
methods.

Table 2 shows the power, FDR and F1 score for identifying DE
genes (either dynamic or sporadic) in Sim II where, again, the target
FDR is controlled at 5%. The increased power of EBSeq-HMM in
identifying dynamic genes that was demonstrated in Sim I persists
when sporadic genes are present, and EBSeq-HMM also shows ad-
vantage for identifying sporadic genes.

In spite of this advantage, we note that all methods show
reduced power for identifying sporadic genes. This is because in the
simulation (and in our case study data upon which the simulation is
based), the range of expression differences in sporadic genes is
smaller, in general, than in dynamic genes. For example, consider
dynamic genes having fold changes at each transition between 1.3
and 1.4. On average, for a dynamic gene that is monotonically
increasing, the range in expression would be  1354 ¼ 332 over all
conditions (for a weak dynamic gene, the range would be  2:44).
However, in a sporadic gene, the range would be  1:35 since only
one condition differs from the others.

In addition to identification of DE genes, we also evaluated the
ability of EBSeq-HMM and FC to classify genes into distinct expres-
sion paths (EBSeq, DESeq2, edgeR, voom and maSigPro were not
evaluated as they were not developed for this purpose; Section 2.6).
Figure 3 shows results for eight dynamic paths simulated in Sim I;
these eight were chosen as they contain the most genes among all
simulated paths. The ground truth shows the number of genes simu-
lated in each expression path. Also shown are the average number
classified into each path by EBSeq-HMM and by FC analysis at FC
threshold K¼ 1.2 and 1.3 (averages are calculated over 100 Sim I
datasets). Correct classifications are shown in blue; incorrect are
shown in red. For FC analysis, we chose 1.2 and 1.3 as they per-
formed best under all thresholds considered. As shown, EBSeq-
HMM identified more true positives than FC, while the FDR is well
below 5%. Similar
results were observed in Sim II data
(Supplementary Fig. S2).

EBSeq-HMM: Identify expression changes in ordered RNA-seq experiments

2619

Table 1. Operating characteristics for identifying changes in Sim I

Power (%)

FDR (%)

F1 score (%)

Power (strong) (%)

Power (weak) (%)

EBSeqHMM
EBSeq
DESeq2
edgeR
voom
maSigPro (0.7)
maSigPro (0.5)
maSigPro (0.3)
FC (2.5)
FC (2)
FC (1.5)
FC (1.3)
FC (1.2)

98.6
90.0
92.4
92.5
91.9
46.8
76.1
86.9
0.6
3.4
42.1
90.0
98.6

4.3
0.1
0
0.1
0
0
0.1
0.5
0.2
1.4
3.5
8.5
19.7

97.1
94.7
96.1
96.1
95.8
63.8
86.4
92.8
1.2
6.6
58.7
90.7
88.6

99.7
93.9
95.4
96.1
95.1
56.1
81.5
90.6
0.8
4.3
55.7
97.5
99.8

97.5
86.1
89.4
89.4
88.6
37.5
70.6
83.2
0.5
2.6
28.6
82.4
97.9

The ﬁrst three columns show the average power, FDR and F1 score for detecting DE genes in Sim I. Power within the strong and weak groups is further eval-
uated in columns 4 and 5. Averages are calculated over 100 Sim I simulations. The standard errors (not shown) for EBSeq-HMM, EBSeq, DESeq2, edgeR, voom
and maSigPro (and in most cases FC) were 0:005.

study gene expression changes over seven positions (proximal to dis-
tal) along the limbs of adult mice.

EBSeq-HMM, EBSeq, DESeq2, edgeR and voom identified
14 817, 12 825, 11 517, 9520 and 10 259 DE genes at a 5% target
FDR, and there is substantial overlap among the lists. Specifically,
EBSeq-HMM identified over 90% of the genes identified by the
other approaches. maSigPro identified 2479, 6919 and 10 727 DE
genes using R2 threshold 0.7, 0.5 and 0.3 and FC analyses identified
4225, 6500, 10 881, 14 016 and 15 877 genes for K ¼ 2.5, 2, 1.5,
1.3 and 1.2, respectively. These identifications showed substantially
lower overlap with other methods.

Given that the majority of genes identified by EBSeq, DESeq2,
edgeR and voom are also identified by EBSeq-HMM, we focus ini-
tially on genes that are identified exclusively by EBSeq-HMM.
Figure 2c and d shows two examples. As in the simulated data
[shown in (a) and (b)], these genes have subtle but consistent
changes over the seven limb positions, again demonstrating that by
accommodating dependence, EBSeq-HMM has increased power to
identify genes showing relatively weak, but consistent, changes.
Supplementary Figure S3 shows similar results for other genes iden-
tified exclusively by EBSeq-HMM.

Although the simulation and case study results suggest that
EBSeq-HMM has increased power for identifying DE genes, the
main advantage of EBSeq-HMM over other approaches is in its abil-
ity to classify genes into particular expression paths. To illustrate,
we consider Hox genes, a set of genes that are of primary interest
here as they are well-known to play an important role in maintain-
ing positional identity in adult cells (Rinn et al., 2006; Wang et al.,
2009). In our case study data, 33 out of 39 Hox genes were identi-
fied as DE by EBSeq-HMM. Figure 4 shows expression levels of the
33 genes along with their most likely expression paths. Although the
positional changes for most Hox genes are not well-known, it is
known that Hoxb4 and Hoxb8 have up-regulated expression in
proximal sites (Rinn et al., 2006; Wang et al., 2009). The EBSeq-
HMM paths for these genes are consistent with these prior studies
and provide further information as they characterize changes across
the seven positions. In addition, the overall pattern of Hox gene ex-
pression found here demonstrates that, in general, higher numbered
Hox genes are up-regulated distally and lower numbered Hox genes
are up-regulated proximally. This is in agreement with existing data
and models of proximal-distal patterning of the limb (Zakany and
Duboule, 2007).

Fig. 2. Shown are two genes identiﬁed exclusively by EBSeq-HMM in Sim I
data (upper) and in case study data (lower). The x-axis shows time points
(upper) and positions on mouse limb (lower), and the y-axis shows median
gene expression adjusted for library sizes

3.2 Case study results
An important problem in regenerative biology is understanding the
connection between gene expression patterns and the positional
identities of cells throughout development. Once humans and other
mammals reach adulthood, they possess a very limited ability to re-
generate body parts like limb structures; and it has been hypothe-
sized that a loss of positional
identity information is at least
partially responsible for the reduction in regenerative capacity.
However, a few studies (Chang, 2009; Rinn et al., 2006; Wang
et al., 2009) have demonstrated that some aspects of positional iden-
tity in mammals are retained into adulthood. Understanding the
changes in gene expression across limb positions in mammals is an
essential first step in gaining a better understanding of these proc-
esses. Toward this end, we conducted RNA-seq experiments to

2620

N.Leng et al.

Table 2. Operating characteristics for identifying changes in Sim II

Power (%)

FDR (%)

F1 score (%)

Power (strong) (%)

Power (weak) (%)

Power (sporadic) (%)

EBSeqHMM
EBSeq
DESeq2
edgeR
voom
maSigPro (0.7)
maSigPro (0.5)
maSigPro (0.3)
FC (2.5)
FC (2)
FC (1.5)
FC (1.3)
FC (1.2)

94.5
81.4
84.1
84.4
83.2
33.1
56.8
67.4
0.4
2.5
36.1
83.0
95.8

4.5
0.1
0
0
0
0
0.1
0.5
0.4
1.9
4.0
9.0
20.1

95.0
89.7
91.4
91.6
90.8
49.7
72.4
80.4
0.8
4.9
52.5
86.8
87.1

99.7
93.9
95.2
95.4
95.0
56.0
81.6
89.9
0.7
4.2
55.9
97.4
99.8

97.4
86.1
89.3
89.5
88.7
37.8
70.6
82.3
0.4
2.5
28.6
82.5
97.9

86.4
64.2
67.9
68.3
65.9
5.5
18.2
30.0
0.1
0.8
23.9
69.2
89.6

The ﬁrst three columns show the average power, FDR and F1 score for detecting DE genes in Sim II. For dynamic genes, the power within the strong and weak
groups is further evaluated in columns 4 and 5. Power within the sporadic group is evaluated in column 6. Averages are calculated over 100 Sim II simulations.
The standard errors (not shown) for EBSeq-HMM, EBSeq, DESeq2, edgeR, voom and maSigPro (and in most cases FC) were 0:005.

increased power to identify genes showing subtle, yet consistent,
changes. Second, for every gene, EBSeq-HMM calculates the gene-
specific PP associated with each possible expression path and in
doing so allows for genes to be classified into distinct expression
paths with a pre-specified FDR. Put another way, EBSeq-HMM not
only identifies genes that change across conditions, but can be used
to specify how they change.

Simulations demonstrated the power of EBSeq-HMM over other
approaches to identify DE genes. In particular, results showed that
DESeq2, edgeR and voom perform well in detecting trends and/or
changes are relatively strong, but that EBSeq-HMM has increased
power to identify genes showing weaker changes. EBSeq-HMM also
worked well for identifying genes showing sporadic changes (where
there is no dependence across ordered conditions as for some genes
in Sim II). Applying maSigPro-GLM with its default cutoff for call-
ing DE genes gave significantly reduced power
than other
approaches. Relaxing the cutoff improved its power, but it was still
inferior to the others.

In addition to DE gene identification, EBSeq-HMM performed
well for classifying genes into expression paths. We defined a gene as
being in a particular path if the gene was classified as DE at FDR 5%
(PP of EE was less than 0.05) and the PP of being in that path ex-
ceeded 0.5. Given the two step process, observed mis-classification
rates were conservatively controlled. Note that in some cases, a DE
gene may not be classified to any particular path. For example, if the
last time point of a four-condition experiment is known to be noisy, a
gene that is initially increasing may have equal PP, say one-third, of
being Up-Up-Up, Up-Up-EE, and Up-Up-Down. This gene would be
called DE with 5% FDR since PP(EE-EE-EE) < 0.05, but it would not
be assigned into a particular expression path if threshold 0.5 was
used. In some cases, a user may want to modify these thresholds. If a
false negative classification was considered more serious than a false
positive, this threshold could be adjusted. Motivation for doing so
under varying loss functions is discussed in (Berger, 1985).

5 Implementation

EBSeq-HMM is implemented as an R package (EBSeqHMM), cur-
rently available at Bioconductor: www.bioconductor.org/packages/
devel/bioc/html/EBSeqHMM.html. EBSeq-HMM requires estimates
of gene or isoform expression, but is not specific to any particular esti-
mation method. To estimate library sizes, EBSeq-HMM defaults to

Fig. 3. Shown are the number of genes (ground truth) simulated in Sim I as
being in each of eight dynamic paths (these eight are shown as they contain
the most genes among all simulated paths). Also shown are the average
number classiﬁed into each path by EBSeq-HMM and by FC analysis at
thresholds 1.2 and 1.3 (averages are calculated over 100 Sim I datasets).
Correct classiﬁcations are shown in blue (ﬁrst bar); incorrect are shown in red
(second bar)

To explore other genes beyond the Hox family that may be
involved in positional identity, we considered 2347 genes that are clas-
sified by EBSeq-HMM into one of 64 possible dynamic paths. Among
the 64 clusters formed by these dynamic genes, the two largest are Up-
Down-Up-Down-Down-Down (827) and Down-Up-Down-Up-Up-
Up (218). Figure 5a and b shows median expression of each position
for each of these genes. As these groups each contain Hox genes but
also previously unknown genes showing similar dynamics across pos-
ition, the novel identifications define candidates for further study.

4 Discussion

We have developed an approach called EBSeq-HMM for analysis of
ordered RNA-seq experiments. EBSeq-HMM may be used to iden-
tify genes that are DE across a set of ordered conditions and to clas-
sify genes into their most likely expression paths. There are a
number of methods available for identifying DE genes that may be
used when data from multiple conditions is available. EBSeq-HMM
has two main advantages over these approaches. First, it accommo-
dates dependence across ordered conditions and consequently has

EBSeq-HMM: Identify expression changes in ordered RNA-seq experiments

2621

NIH GM102756, NIH U54 AI117924, NSF DMS-12-65203 and UL1
RR025011.

Conﬂict of Interest: none declared.

References

Ailliot,P. and Monbet,V. (2012) Markov-switching autoregressive models for

wind time series. Environ. Model. Softw., 30, 92–101.

Anders,S. and Huber,W. (2010) Differential expression analysis for sequence

count data. Genome Biol., 11, R106.

Benjamini,Y. and Hochberg,Y. (1995) Controlling the false discovery rate: a
practical and powerful approach to multiple testing. J. R. Stat. Soc.Ser. B
(Methodological), 57, 289–300.

Berger,J.O.

(1985) Statistical Decision Theory and Bayesian Analysis.

Springer Science & Business Media.

Bullard,J.H. et al. (2010) Evaluation of statistical methods for normalization
BMC

in mRNA-seq

experiments.

expression

differential

and
Bioinformatics, 11, 94.

Chang,H. (2009) Anatomic demarcation of cells: genes to patterns. Science,

326, 1206–1207.

Conesa,A. et al. (2006) maSigPro: a method to identify signiﬁcantly differen-
experiments.

time-course microarray

proﬁles

expression

tial
in
Bioinformatics, 22, 1096–1102.

Fig. 4. Shown are median expression levels of 33 Hox genes identiﬁed as DE
by EBSeq-HMM. The expression values were adjusted for library size and fur-
ther scaled to mean 0 and standard deviation 1 for each gene; median expres-
sion over three replicates is shown. Genes were clustered via hierarchical
clustering using Euclidean distance and complete linkage. The x-axis shows
seven positions over the mouse limb

Fig. 5. (a), (b) Shown are genes classiﬁed as following an Up-Down-Up-
Down-Down-Down (left panel, 827 genes) or Down-Up-Down-Up-Up-Up
(right panel, 218 genes) expression path in the case study data. Each line indi-
cates one gene. The x-axis shows seven positions over the mouse limb; the
y-axis shows median scaled expression within each position

median-of-ratios normalization (Anders and Huber, 2010); TMM
(Robinson and Oshlack, 2010) and Upper Quartile Normalization
(Bullard et al., 2010) are also available in the package.

Like most methods, EBSeq-HMM makes assumptions regarding
the distribution governing expression measurements. Consequently,
poor performance may result if there are strong departures from
these assumptions. Model diagnostics are implemented in EBSeq-
HMM to ensure that assumptions can be easily checked. They
should be considered with each application and results should not
be used if serious departures from model assumptions are observed.
A typical diagnostic summary for the case study data is shown in
Supplementary Figure S4.

Acknowledgements

The authors would like to thank Michael Newton and Ming Yuan for
comments that helped improve the manuscript. This work was supported by

Derrien,T. et al. (2012) Fast computation and applications of genome mapp-

ability. PLoS One, 7, e30377.

Ernst,J. et al. (2005) Clustering short time series gene expression data.

Bioinformatics, 21(Suppl. 1), i159–i168.

Filkov,V. et al. (2002) Analysis techniques for microarray time-series data.

J. Comput. Biol., 9, 317–330.

Glaus,P. et al.

(2012)

Identifying differentially expressed transcripts

from RNA-seq data with biological variation. Bioinformatics, 28,
1721–1728.

Hamilton,J.D. (1989) A new approach to the economic analysis of nonstation-

ary time series and the business cycle. Econometrica, 357–384.

Hardcastle,T.J. and Kelly,K.A. (2010) baySeq: empirical Bayesian methods
for identifying differential expression in sequence count data. BMC
Bioinformatics, 11, 422.

Koehler,R. et al. (2011) The uniqueome: a mappability resource for short-tag

sequencing. Bioinformatics, 27, 272–274.

Langmead,B. et al. (2010) Ultrafast and memory-efﬁcient alignment of short

DNA sequences to the human genome. Genome Biol., 10, R25.

Law,C.W. et al. (2014) Voom: precision weights unlock linear model analysis

tools for RNA-seq read counts. Genome Biol., 15, R29.

Leng,N. et al. (2013) EBSeq: an empirical Bayes hierarchical model for infer-

ence in RNA-seq experiments. Bioinformatics, 29, 1035–1043.

Li,B. and Dewey,C.N. (2011) RSEM: accurate transcript quantiﬁcation from
RNA-seq data with or without a reference genome. BMC Bioinformatics,
12, 323.

Love,M.I. et al. (2014) Moderated estimation of fold change and dispersion

for RNA-seq data with DESeq2. Genome Biol., 15, 550.

Luan,Y. and Li,H. (2003) Clustering of time-course gene expression data using

a mixed-effects model with b-splines. Bioinformatics, 19, 474–482.

Ma,P. et al. (2009) Identifying differentially expressed genes in time course

microarray data. Stat. Biosciences, 1, 144–159.

Nueda,M.J. et al. (2014) Next maSigPro: updating maSigPro bioconductor

package for RNA-seq time series. Bioinformatics., 30, 2598–2602.

Rinn,J. et al. (2006) Anatomic demarcation by positional variation in ﬁbro-

blast gene expression programs. PLoS Genet., 2, e119.

Robinson,M.D. and Oshlack,A. (2010) A scaling normalization method
for differential expression analysis of RNA-seq data. Genome Biol., 11,
R25.

Robinson,M.D. and Smyth,G.K. (2007) Moderated statistical tests for assess-

ing differences in tag abundance. Bioinformatics, 23, 2881–2887.

Robinson,M.D. et al. (2010) edgeR: a bioconductor package for differential
expression analysis of digital gene expression data. Bioinformatics, 26,
139–140.

Schlu¨ ter,R. et al. (2005) Bayes risk minimization using metric loss functions.

In: INTERSPEECH, pp. 1449–1452.

2622

N.Leng et al.

Shi,Y. and Jiang,H. (2013) rSeqDiff: detecting differential isoform expression
from RNA-seq data using hierarchical likelihood ratio test. PLoS One, 8,
e79448.

Wang,K.

et

al.

(2009) Regeneration,

repair

and

remembering

identity: the three Rs of Hox gene expression. Trends Cell Biol., 19,
268–275.

Teerapabolarn,K. (2008) On the negative binomial approximation to the
beta-negative binomial distribution. Int. J. Contemp. Math. Sci., 3,
1213–1216.

Yuan,M. and Kendziorski,C. (2006) Hidden Markov models for microarray
time course data in multiple biological conditions. J. Am. Stat. Assoc., 101,
1323–1332.

Trapnell,C. et al. (2012) Differential analysis of gene regulation at transcript

Zakany,J. and Duboule,D. (2007) The role of Hox genes during vertebrate

resolution with RNA-seq. Nat. Biotechnol., 31, 46–53.

limb development. Curr. Opin. Genet. Dev., 17, 359–366.

