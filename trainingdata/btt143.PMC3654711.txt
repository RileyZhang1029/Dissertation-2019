BIOINFORMATICS ORIGINAL PAPER  Vol.
29 no.
10 2013, pages 1275 1282 doi:10.1093/bioinformatics/btt143  Gene expression  Advance Access publication April 14, 2013  Shrinkage estimation of dispersion in Negative Binomial models for RNA-seq experiments with small sample size Danni Yu1,2, Wolfgang Huber1 and Olga Vitek2,3,* 1Genome Biology Unit, European Molecular Biology Laboratory, Mayerhofstraße 1, Heidelberg 69117, Germany 2Department of Statistics and 3Department of Computer Science, Purdue University, West Lafayette, IN 47907, USA Associate Editor: Inanc Birol  ABSTRACT Motivation: RNA-seq experiments produce digital counts of reads that are affected by both biological and technical variation.
To distin- guish the systematic changes in expression between conditions from noise, the counts are frequently modeled by the Negative Binomial distribution.
However, in experiments with small sample size, the per-gene estimates of the dispersion parameter are unreliable.
Method: We propose a simple and effective approach for estimating the dispersions.
First, we obtain the initial estimates for each gene using the method of moments.
Second, the estimates are regularized, i.e.
shrunk towards a common value that minimizes the average squared difference between the initial estimates and the shrinkage estimates.
The approach does not require extra modeling assump- tions, is easy to compute and is compatible with the exact test of differential expression.
Results: We evaluated the proposed approach using 10 simulated and experimental datasets and compared its performance with that of currently popular packages edgeR, DESeq, baySeq, BBSeq and SAMseq.
For these datasets, sSeq performed favorably for experi- ments with small sample size in sensitivity, specificity and computa- tional time.
Availability: http://www.stat.purdue.edu/ ovitek/Software.html and Bioconductor.
Contact: ovitek@purdue.edu Supplementary information: Supplementary data are available at Bioinformatics online.
Received on September 25, 2012  revised on February 24, 2013  accepted on March 25, 2013  1 INTRODUCTION  Whole transcriptome shotgun sequencing (RNA-seq) technology (Mardis, 2008  Metzker, 2009  Wang et al., 2009) quantifies gene expression in biological samples in counts of transcript reads mapped to the genes.
Accurate and comprehensive, it has made a major impact on genomic research (Garber et al., 2011  Oshlack et al., 2010  Pepke et al., 2009).
One common goal of RNA-seq experiments is to detect differentially expressed genes, i.e.
genes for which the counts of reads change between conditions more systematically than as expected by random chance (Oshlack et al., 2010).
Statistical methods for detecting differentially expressed genes must reflect the experimental de- sign and appropriately account for the stochastic variation.
*To whom correspondence should be addressed.
Moreover, many RNA-seq experiments serve as high-throughput screens of a small number of samples with the goal of subsequent experimental validation.
Therefore, the analysis must handle a relatively small number of biological replicates.
A variety of statistical methods and software has recently been proposed for detecting differentially expressed genes.
These in- clude DESeq (Anders and Huber, 2010), edgeR (Robinson and Smyth, 2007  Robinson et al., 2010), baySeq (Hardcastle and Kelly, 2010), SAMseq (Li and Tibshirani, 2011), BBSeq(Zhou et al., 2011).
We briefly overview these methods.
We further propose a direct and effective approach for characterizing the variation in the counts of reads, which improves the sensitivity and specificity of detecting differentially expressed genes for ex- periments with small sample size.
We support this approach with an open-source R-based software package sSeq.
2 BACKGROUND  2.1 The Negative Binomial distribution  it  The input to the statistical analysis is a set of discrete counts of reads in each experimental run.
Although the counts can be modeled with the one-parameter Poisson or Geometric distribu- tions (Auer and Doerge, 2011  Li et al., 2011  Marioni et al., 2008), is often advantageous to use the two-parameter Negative Binomial distribution (Anders and Huber, 2010  Hardcastle and Kelly, 2010  Robinson and Smyth, 2007  Robinson et al., 2010).
This distribution is more general and flexible and can be viewed as a generalization of both Poisson and Geometric distributions (Supplementary Materials).
We focus on the Negative Binomial distribution in what follows.
Denote Xgij as the random variable that expresses the counts of reads mapped to gene g ðg ¼ 1, .
.
.
, GÞ in sample (or, equiva- lently, library) j ðj ¼ 1, .
.
.
, niÞ in condition i and denote xgij as the observed values.
For simplicity, we consider two conditions ði ¼ A, BÞ  however, the discussion holds for pairwise compari- sons of conditions in experiments with more complex designs.
We are particularly interested in situations where nA and nB are small, e.g.
1 4.
We consider the following parametrization: Xgij   NBð gi,  gÞ, where  gi   0,  g   0, such that gi g ð ¼denoted VgiÞ EfXgijg ¼  gi, VarfXgijg ¼  gi þ  2  ð1Þ  The dispersion parameter  g determines the extent to which the variance Vgi exceeds the expected value  gi (Cameron and Trivedi, 1998  McCullagh and Nelder, 1989).
ß The Author 2013.
Published by Oxford University Press.
This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/ by-nc/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited.
For commercial re-use, please contact journals.permissions@oup.com   D.Yu et al.
2.2 Motivation for the proposed approach The estimation of VarfXgijg is the main focus of this work and is based on the following considerations.
(1) A naı  ve approach is to estimate VarfXgijg using the method of moments (i.e.
the per-gene sample variance).
However, it is highly variable in experiments with a small sample size (Croarkin and Tobias, 2006).
(2) RNA-seq experiments simultaneously quantify the expres- sion of many genes.
The genes share aspects of biological and technical variation, and therefore a combination of the gene-specific estimates and of consensus estimates can yield better estimates of variation.
Such approaches are increasingly popular with RNA-seq experiments (Anders and Huber, 2010  Robinson and Smyth, 2007).
(3) The variance of the Negative Binomial distribution is a known function of the expected value  gi and of the dis- persion  g. Therefore, an accurate estimation of the dis- persion (e.g.
by combining the gene-specific and consensus estimates, without explicitly modeling its relationship to  gi) can lead to an accurate estimation of the variance while preserving the mean variance relationship.
(4) Finally, constraints of throughput sample availability or cost may restrict the number of biological replicates.
Although experiments with little or no biological replica- tion have poor reproducibility and are undesirable, such under-replicated screens are the only practical option in some situations (Malo et al., 2006  Markowetz, 2010).
They can only detect large changes in expression and re- quire an extensive downstream validation with complemen- tary low-throughput experiments and large sample size.
To detect differentially expressed genes, we assume that the majority of the genes are not differentially expressed, and that for these genes, the samples from all conditions can be viewed as biological replicates (Robinson and Oshlack, 2010  Robinson et al., 2010).
Under this assumption, a con- sensus estimate of dispersion helps to improve the accuracy of gene-specific estimates of variation.
Our main concern is in how to (i) accurately define the consensus estimate of dispersion and (ii) accurately combine the gene-spe- cific estimates of dispersion with the consensus estimate.
2.3 Existing approaches for RNA-seq experiments  Among the existing methods, edgeR (Robinson and Smyth, 2007  Robinson et al., 2010), DESeq (Anders and Huber, 2010) and baySeq (Hardcastle and Kelly, 2010) assume the Negative Binomial distribution, and SAMseq (Li and Tibshirani, 2011) and BBSeq (Zhou et al., 2011) use other flexible models.
The approaches have been extensively evaluated (Soneson and Delorenzi, 2013) and are broadly used.
Hardcastle and Kelly (2010) found that the performance of DESeq, edgeR and baySeq is superior to that of DEGseq (Wang et al., 2010), Li and Tibshirani found that SAMseq improves on PoissonSeq (Li et al., 2011).
We briefly overview these approaches in the historical order.
Table 1 summarizes the discussion.
(2011)  1276  It  Probability model.
edgeR models the count of reads with the Negative Binomial distribution.
includes normalization, which accounts for the changes in read counts owing to technical artifacts such as different sequencing depth.
The normalization factor can be the total library size (i.e.
the number of reads in the library).
A more accurate normalization factor is the  effective  library size mij, which multiplies the size of the library ij by a robust estimate of the log-fold change of the total count in con- dition i as compared with a reference run (Robinson and Oshlack, 2010).
The parameter pgi in row (b) of Table 1 is the probability that a single read maps to gene g for a sample in condition i.
The model assumes that the dispersion parameter is gene specific but constant across conditions.
For experiments without replication versions up to 2.4.6 assumed a common dis- persion in all the genes.
The subsequent versions discourage unreplicated experiments.
Finally, generalized linear models for the Negative Binomial response are available.
DESeq also models the count of reads with the Negative Binomial distribution.
It normalizes the read counts by a size factor sij (Anders and Huber, 2010).
^sij ¼ mediang  1=ðnAþnBÞ  ð2Þ     Q  nA k¼1     xgij  Q  nB k¼1  xgAk  xgBk  The size factor can be thought of as the  representative  ratio of counts in the library to the geometric mean of the counts in all the libraries, and differs from the  effective  library size in edgeR.
The parameter  gi in row (c) of Table 1 is the expected normal- ized expression of gene g in condition i. DESeq allows specifica- tion of separate variances for genes and conditions and models the variances as functions of the expected values.
This relation- ship can be a flexible smooth function (local polynomial) or a parabolic function ^Vgi ¼ sij   ^ gi þ s2 , where a0, a140 are constants.
Alternatives based on generalized linear models for the Negative Binomial response are also available.
gi   a0 þ a1= ^ gi  ij    2     The baySeq specifies the same probability model as edgeR  however, it proposes a different Empirical Bayes characterization of the between-library variation.
The baySeq assumes that sub- sets of the libraries share the parameters of Negative Binomial distribution and derives an empirical prior distribution for the corresponding parameter sets.
After integrating over the empir- ical priors, the dispersion in the integrated likelihood is constant across conditions and different between the genes.
The default normalization parameter is the library size.
BBSeq specifies a Beta-Binomial generalized linear model.
Using the logit link, it connects the expected probability of a read for gene g in condition i and sample j to the linear combin- ations of predictors, such as indicators of conditions and other covariates.
The dispersion parameter can be independent from the mean (free model) or dependent on the mean (constrained model).
SAMseq uses a fully non-parametric approach.
Estimation of dispersion.
edgeR maximizes a weighted combin- ation of the conditional log-likelihoods with per-gene dispersion and of the conditional log-likelihood with common dispersion.
Conditional likelihoods generalize the restricted maximum like- lihood estimation for a discrete response by conditioning on the sum of the read counts per class and improve the statistical properties of dispersion estimates.
The estimation requires   Table 1.
Existing and proposed approaches for differential analysis of RNA-seq experiments with two conditions  Estimation of dispersion in Negative Binomial models  (a) sSeq (proposed) (this manuscript)  (b) edgeR (Robinson and Smyth, 2008)  (c) DESeq (Anders and Huber, 2010)  (d) baySeq (Hardcastle  and Kelly, 2010)  (e) BBSeq  (Zhou et al., 2011)         Probability model Xgij   NB sij gi,  g=sij      Xgij   NB mijpgi,  g  Xgij   NB sij gi,  gi     Estimation of dispersion g ¼    þ ð1    Þ ^ MM ^ sSeq common dispersion and   is a weight  , where   is a  g  ^ edgeR g  maximize linear combination of  per-gene and common-dispersion conditional likelihoods    ¼ ^Vgi   ^ gi  !
P  ^ DESeq gi  1 ni  j  1 sij  = ^ 2 gi  Testing H0 :  gA ¼  gB  Exact test  H0 : pgA ¼ pgB  n¼ 1 Time  Yes min  Yes* min  Exact or GLM-based test  H0 :  gA ¼  gB  Exact or GLM-based test  Yes min          Xgij   NB Nijpgi,  g Empirical priors on sets  of parameters     Xgij   Binom pgi, Nij pgi   Beta, logitEfpgig ¼ Z , VðpgiÞ ¼ EðpgiÞ ð1   EðpgiÞÞ g  ^Vgi is estimated as function of the mean  ^ baySeq g  maximize per-gene integrated  quasi-likelihood  H0 : pgA ¼ pgB  Posterior probability cutoff  ^ BBSeq g  maximize per-gene marginal likelihood  is a free parameter or a function of the mean  H0 :   ¼ 0 Wald test  Yes  h  Yes  h  (f) SAMseq (Li and Tibshirani, 2011)  Non-parametric  H0: same distributions A and B  No  min  Wilcoxon test & resampling  (a) sij is the size factor for sample j in condition i as defined in (Anders and Huber, 2010).
gi is the expected normalized expression of gene g for a sample in condition i.
^ MM the per-gene dispersion estimate using the method of moments in Equation (6).
(b) mij is the  effective  library size.
pgi is the probability that a read in i maps to gene g. *Up to v2.4.6.
(c)  gi is gene- and condition-specific dispersion.
^ gi and ^Vgi can be estimated by the method of moments or by the Cox-Reid corrected Maximum Likelihood.
(d) Nij is the size of the library i from condition j. pgi is as in (b).
(e) pgi is as in (b).
Nij is as in (d).
is the coefficient of the linear predictor associated with an indicator Z of conditions.
Column  Time  is the run time for the experimental datasets in Section 4 on a laptop computer.
is  g  calculating pseudocounts of reads that would have been obtained with libraries of equal size and an iterative computational opti- mization.
For experiments with few replicates, the estimates tend to be discrete values (Lloyd-Smith, 2007  Piegorsch, 1990  Toft et al., 2006).
For experiments with many replicates, edgeR spe- cifies a generalized linear model.
As conditional likelihoods cannot be easily extended to this case, these are further approxi- mated by adjusted profile likelihoods (McCarthy et al., 2012).
DESeq starts by estimating per-gene means and variances of the normalized counts in each gene and condition by the meth- ods of moments.
Next, it re-estimates them by fitting the postu- lated relationship between the expected values and the variances.
The estimates of dispersion can be back-calculated from the es- timates of variance as shown in row (c) of Table 1.
For experi- ments without replication, DESeq assumes that the majority of the genes are not differentially expressed, and combines the sam- ples across conditions to estimate the variance.
The same strategy is used with the generalized linear models.
The baySeq relies on an iterative estimation of the relative gene expression and of the dispersion.
Given an initial partition of the libraries into subsets and an initial estimate of the relative gene expression, it estimates the dispersion using the quasi-likelihood approach.
Given the estimates of dispersion, it re-estimates the relative gene expression by maximizing the integrated likelihood.
This is repeated for different partitions of the libraries.
BBSeq estimates the dispersion using maximum likelihood for the free model.
For the constrained model, it uses the estimates from the free model for all the genes, fits the postulated  relationship to the mean and re-estimates the dispersions.
SAMseq sidesteps the need to estimate the dispersion by using a fully non-parametric approach.
Testing.
For the Negative Binomial model, edgeR tests the null hypothesis H0 : pgA ¼ pgB, and DESeq H0 :  gA ¼  gB separ- ately for each gene.
Both edgeR and DESeq use the exact test, which is free from asymptotic arguments and is therefore pre- ferred.
The test statistic for a gene is the total (normalized) count of reads in all the replicates of a condition.
The P-value is the probability of the normalized read counts per group such that under H0 their probability is same or lower than the probability of the observed counts, conditional on the total counts equal to the observed.
With the generalized linear models, edgeR and DESeq use the asymptotic likelihood ratio or Wald tests.
baySeq ranks the genes by their posterior probabilities of dif- ferential expression.
BBSeq tests the coefficient of the linear pre- dictor (i.e.
condition) in the generalized linear model with the asymptotic Wald test.
SAMseq uses a resampling strategy to es- timate the distribution of the test statistic and the P-values.
3 METHODS  The proposed approach combines aspects of the existing approaches, but is simpler, requires fewer assumptions and streamlines the computation.
It is summarized in Table 1a.
More details regarding the method and its implementation in sSeq are in Supplementary Materials.
Probability model.
The model for the counts Xgij of gene g ¼ 1, .
.
.
, G, replicate j ¼ 1, .
.
.
, ni and condition i ¼ A, B is ð3Þ  Xgij   NBð gi sij,  g=sijÞ, such that  1277   D.Yu et al.
EfXgijg ¼  gi sij, and VarfXgijg ¼  gi sij þ  2  gi g sij  ð4Þ  As  P  g     g    ^  ^ MM  MM    2    P  g  ð ^ MM g    Þ2, the weight   2 ð0, 1Þ.
Larger  ^Vg ¼  , with ^ g ¼  i  ð5Þ  g¼1  We follow edgeR, DESeq and baySeq by specifying a Negative Binomial distribution.
As in experiments with a small sample size, it may be diffi- cult to distinguish the true dependency of dispersions on expected values from artifacts of random variation, the model specifies free gene-specific dispersion parameters  g. As the initial versions of edgeR, we specify a common dispersion across conditions, i.e.
gA ¼  gB ¼denoted  g. As a con- sequence, the counts of differentially expressed genes have different vari- ances in each condition.
We follow DESeq in normalizing the counts by the size factor sij.
However, in the proposed normalization, the size factor affects not only the expected value but also the dispersion.
Equation (4) shows that under this assumption the size factor linearly scales both EfXgijg and VarfXgijg.
Such linear scaling is consistent with the technical variation in RNA-seq experiments, which can be characterized by the Poisson dis- tribution (Marioni et al., 2008).
As typical size factors are close to 1, the proposed model has little practical difference from the model in DESeq.
However, as shown in Supplementary Section 2, it allows us to directly conduct the exact test and contributes to the accuracy of the results.
Estimation of dispersion.
Similarly to DESeq, we start by estimating the dispersion parameters by the methods of moments.
A conservative esti- mate of the per-gene variance in experiments with a small sample size is obtained by pooling the samples across conditions, i.e.
P  P P  j  xgij=^sij  ni  i  j  i  P  P P ðxgij=^sij   ^ gÞ2 ni   1 0 B@ g ¼ max 0, ^ MM  P  i  i  and g ¼ 1, .
.
.
, G. The estimate of dispersion ^ MM P Equation (1), and negative values are truncated at zero P P niVg    g  P  1 CA  1 sij  g  j  is then calculated from  ð6Þ  i 1 sij   2 g  i  j  Unfortunately, in experiments with small sample size, ^ MM are unsatis- factory owing to high variance (Bowman, 1984  Clark and Perry, 1989  Willson et al., 1984).
Next, we improve the statistical properties of these estimates by introducing shrinkage.
g  Stein (1956) showed that when we estimate the expected values of three or more independent Normal random variables with known constant variance, shrinking the per-dimension estimates toward a target value   produces biased estimates, but reduces the mean squared error (MSE) for all choices of  .
The shrinkage estimator by James and Stein (1961) (Lehmann and Casella, 1998  Richards, 1999) implements this strategy.
More recently, Hansen extended the approach of James and Stein with a generalized shrinkage estimator, (Hansen, 2008).
Hansen s shrinkage can be used with any per-dimension estimator with an arbitrary sampling distribution (not necessarily Normal), for which the Central Limit Theorem holds.
Specifically, it requires that the true parameter lies in a neighborhood of the restricted parameter space, and that the estimator is asymptotically Normal with a consistent variance.
Estimators by the method of moments satisfy these criteria.
Applied to the estimation of  g, and assuming that the per-gene estimates are independent, the gen- eralized shrinkage estimator is g ¼ ð1    Þ ^ MM g þ       ¼   þ 1     ^ sSeq     P P  ^ sSeq g gene methods of moment estimates.
The weight   is defined as  is a linear combination of the pre-defined target   and of the per-  g    Þ  =ðG   1Þ  Þð ^ MM  X  ð7Þ  ð  2  g    ¼  MM  g   ^  ^ MM ð ^ MM g    Þ2=ðG   2Þ  , and  MM ¼ 1  ^  G  ^ MM g  g  ð8Þ  g  1278  values of   shrink the estimates closer to the pre-defined target  .
g  We use the Hansen s generalized shrinkage estimator ^ sSeq  in conjunc- tion with the Negative Binomial distribution to test genes for differential expression.
Although the assumption of ^ MM being independent variables is simplistic, it is a suitable approximation for experiments with a small sample size.
A similar assumption is made, e.g.
by DESeq when modeling the variance as function of the mean.
Although the asymptotic argument cannot be justified in this context, we show empirically in Section 5 that ^ sSeq g  performs well in practice.
g  P  Hansen showed that the estimator in Equations (7) and (8) reduces the asymptotic MSE for all choices of targets  .
However, a good practice is to select a value for   that maximizes this reduction.
To this end, we approximate the MSE ¼ Ef ð ^ sSeq g    gÞ2g using the average squared X and ^ MM  g¼1 difference (ASD) between ^ sSeq  G  g  g  ASD ¼ 1 G  G  g¼1  ð ^ sSeq g   ^ MM  g  Þ2  ð9Þ  Equation (9) substitutes  g with ^ MM for numeric stability.
It is shown that  g  and divides MSE by the constant G  ASDð Þ ¼  P  G  constant ð ^ MM g    Þ2  ð10Þ  Figure 1a visualizes the functional form of ASDð Þ for a simulation in Section 4 and shows that the tail of the curve flattens for large  .
Therefore, we can also minimize the bias by minimizing   while enforcing the constraint that ASDð Þ is comparably small.
In practice, sSeq esti-   mates ^  by calculating the slope of ASDð Þ and setting ^  ¼ argmin    5slopeðASDð ÞÞ50  ð11Þ for a small constant   such as   ¼ 0:05.
The selected value is shown by the vertical line in Figure 1a.
^ MM g  Figure 1b illustrates the fact that the proposed shrinkage estimator is a .
The slope of the transformation is linear transformation of ð1    Þ 2 ð0, 1Þ, and the fixed point is the shrinkage target  .
The shrink- age increases the per-gene estimates of dispersion that are smaller than   and decreases the values that are larger than  .
From our experience with multiple datasets, ^  is often around the 95.5th quantile of ^ MM .
In other words, it biases the majority of the estimates towards conservative values.
The proposed estimate of dispersion has analogies in methods de- veloped for other high-throughput technologies.
For example, it is similar in spirit to the moderated variance estimator in the package Limma (Smyth, 2004, 2005), which is also a linear combination of per-gene and consensus estimates.
Testing.
We follow edgeR and DESeq by testing H0 :  gA ¼  gB per gene with the exact test.
The test statistic is Xgi , i.e.
the sum of the read counts in each condition.
Under H0, the P-values are calculated with respect to the reference distribution Xgi   H0 NB  sij    g,  g=   P  and are ad-  P     sij  g  j the false discovery rate (FDR)  j  justed to control Hochberg, 1995).
See Supplementary Materials for more details.
Extensions to experiments with complex designs.
The proposed approach can be extended to pairwise comparisons of conditions in experiments with more complex designs without recurring to a generalized linear model and without additional assumptions.
See Supplementary Materials for details.
(Benjamini and  4 DATASETS  We evaluated the proposed approach using 10 simulated and experimental datasets.
The first five datasets had an external   (a)  Simulation1,ni=2  (c) Simulation1,ni=2: Proposed  (e) Simulation1,ni=2: edgeR  (g) Simulation1,ni=2: DESeq  Estimation of dispersion in Negative Binomial models  (b)  Simulation1,ni=2  (d) Simulation1,ni=2: Proposed  (f)  Simulation1,ni=2: edgeR  (h)  Simulation1,ni=2: DESeq  Fig.
1.
Dispersion and variance estimation in Simulation1.
Similar plots for other datasets are shown in Supplementary Materials.
(a) ASD versus shrinkage target  .
ASD is maximized at   ¼  ^  (solid horizontal line).
The dashed lines are the selected target ^  and its ASD.
(b) The proposed g   0 are transformed to shrinkage estimator is a linear transformation of ^ MM    ¼ 0:11.
(c, e and g) Dispersion estimates by sSeq, edgeR and DESeq versus the per-gene mean read counts across conditions.
Gray smooth scatter are (same on all the plots).
Black dots are ^ g estimated by each method.
Gray lines indicate the true dispersion parameters.
(d, f and h) Same as above, ^ MM g but for the variances of the read counts  , with the slope ð1    Þ ¼ 0:69 and the fixed point ^  ¼ 0:354.
All ^ MM  MM  g   gold standard  of differential expression, and the last two had experimental designs more complex than a two-group compari- son.
See Supplementary Materials for more details.
Simulation1, Simulation2 and Simulation3 each generated G ¼ 20 000 genes in conditions A and B, nA ¼ nB ¼ 2.
Thirty percent of the genes were simulated as differentially expressed.
Size factors were sampled from the Uniform distribution sij  Uniformð0:5, 1:7Þ.
Simulation1 assumed a constant dispersion parameter across all genes and is favorable to sSeq.
Simulation2 assumed that  g is a non-linear function of  g, i.e.
g ¼ 1=ð100 þ  gÞ and as such is favorable to DESeq.
Simulation3 is most realistic.
From the dataset by Bottomly et al.
(2011) (Frazee et al., 2011), the largest experimental dataset in this manuscript, we selected a subset of non-differentially expressed genes (as determined by a consensus Þ from of sSeq, edgeR and DESeq) and sampled pairs ð ^ MM this subset as the true parameters for simulating read counts.
gA , ^ MM  g  MAQC (Shi et al., 2006) is the dataset from the MicroArray Quality Control (MAQC) consortium, comparing three libraries from Ambion human brain reference RNA against two libraries from Stratagene human universal reference RNA.
The libraries were sequenced with the Illumina platform, resulting in 19 580 genes.
A subset of the genes from four of the libraries was assayed by real-time reverse-transcription PCR (Shi et al., 2006  Zhining et al., 2010).
We used the 323 differential genes and 85 non-differ- entially expressed genes determined by real-time reverse-transcrip- tion PCR as the  gold standard .
Although the dataset only has technical replicates, it has been used extensively as the benchmark in the past (Arikawa et al., 2008  Bullard et al., 2010  Patterson et al., 2006).
Griffith et al.
(2010) compared fluorouracil (5-FU)-resistant human colorectal cancer cell lines MIP101 against their non- resistant counterpart MIP/5-FU24.
One library from each con- dition was quantified with the paired-end Illumina platform, resulting in 27 145 genes.
In all, 197 of these genes from the same samples were assayed by quantitative PCR.
We used 12 truly differential genes and 19 truly non-differentially expressed genes as determined by quantitative PCR as the  gold standard  for method comparison.
Brooks et al.
(2011) compared untreated cells of Drosophila melanogaster against cells cultured in presence of Pasilla, the homologue of the mammalian Nova-1 and Nova-2 protein.
Two biological samples per condition were sequenced with the paired-end Illumina platform, resulting in 14 470 genes.
Sultan et al.
(2008) (Frazee et al., 2011) compared two biolo- gical replicates of human cell lines Ramos B and HEK293T with the Illumina platform, yielding 6 573 643 uniquely aligned reads.
Bottomly et al.
(2011) (Frazee et al., 2011) compared brain tissues of two inbred mouse strains, C57BL/6J (B6) and DBA/ 2J (D2), using the Illumina platform.
The analysis of 10 and 11 biological samples per condition resulted in 13 932 genes.
Hammer et al.
(2010) (Frazee et al., 2011) compared gene ex- pression in rat strains Sprague Dawley and L5 SNL Sprague Dawley 2, at two times (2 weeks and 2 months) in a factorial design.
Two distinct biological libraries per condition and per time slot were quantified using the Illumina platform, resulting in 18 635 genes.
Tuch et al.
(2010) compared the expression of genes in normal human tissues and in tissues with oral squamous cell carcinoma.
The experiment compared pairs of normal and tumor samples  1279   D.Yu et al.
from three patients.
The six libraries were sequenced using the SOLiD platform, resulting in 10 453 genes.
are relatively similar.
sSeq has a slightly higher area under the ROC curves.
5 RESULTS  In addition to sSeq, the following versions of the existing packages were used: edgeR v3.0.8 (January 2013), DESeq v1.10.1 (October 2012), baySeq v1.12.0 (October 2012), BBSeq v1.0 (March 2011), SAMSeq as part of the R package samr v2.0 (June 2011).
For sSeq, all the datasets were analyzed with the exact test, and analyses of the Hammer and the Tuch datasets accounted for their experimental designs.
For edgeR and DESeq, the data- sets with two-group comparisons were analyzed with the exact test, and Hammer and Tuch datasets were analyzed with the glm-based approaches.
For edgeR, the estimateCommonDisp function in an older version of edgeR package (v2.4.6) was used to analyze unreplicated datasets.
For DESeq, the option fitType¼ local  was used to estimate the per-group variance.
The default parameters were used otherwise.
See Supplementary Materials for details and representative R scripts.
5.1  sSeq accurately estimates the variation  As the proposed approach shares most similarities with edgeR and DESeq, we compared their estimates of dispersions and vari- ances in more details.
Figure 1c, e and g use the simplest case of Simulation1 to illustrate the estimates by the method of moments and by the three approaches.
As expected, have a high variance, which increases with the mean.
Also as expected, esti- mates by ^ sSeq are biased towards larger values but have smaller deviations from the true values as compared to ^ MM .
Estimates by the other two methods fit the pattern of ^ MM  ^ MM g  g .
g  g  Figure 1d, f and h show that despite the differences in disper- sion estimation, the estimates of variance by the three methods are less different.
This is due to the fact that the values of the dispersions are small as compared with the means, and that the variances in Equation (1) are highly influenced by the expected values.
As a result, the bias in the estimation of the dispersion has a low impact on the overall estimation of variation.
Supplementary Materials provide plots for the other datasets.
The first two columns of Table 2 show that the bias also has little impact on the performance of detecting differentially ex- pressed genes, as the performance of sSeq, edgeR and DESeq  Figure 1d, f and h also provide an insight into why shrinking the method of moments estimates of dispersion is more beneficial than shrinking the method of moments estimates of variance.
On the log scale the relationship between the mean and the variance in the Negative Binomial distribution is roughly linear for large mean counts.
Mathematically, from Equation (1)  logðVgiÞ ¼ logð gi þ  2 logðVgiÞ  large  gi  gi gÞ ¼ logð giÞ þ logð gi g þ 1Þ  2   logð giÞ þ logð gÞ  ð12Þ  A shrinkage of the variance estimates would multiply them by ð1    Þ   1 and would distort the slope of the mean variance relationship in Equation (1) away from Equation (2).
The shrink- age of the dispersion parameter, on the other hand, preserves this nominal mean variance relationship.
Our results (shown in Supplementary Materials) confirmed that shrinking the variance leads to inferior performance.
To further investigate the usefulness of multiple shrinkage tar- gets, we partitioned the genes into 10 groups according to the and applied the shrinkage separately to each ranges of group.
Our results (not shown here) indicated that there is no advantage in specifying multiple shrinkage targets.
^ MM  g  5.2  sSeq accurately detects differential expression  Five datasets with an external  gold standard  were used to evalu- ate the sensitivity and the specificity of detecting differentially expressed genes.
For each method, the genes were ranked by FDR-adjusted P-value of posterior probability and termed  sig- nificant  for varying cutoffs.
The sensitivity and the specificity of differential expression was compared with the  gold standard  and summarized with ROC curves.
Table 2 shows that the pro- posed approach consistently had a similar or a higher accuracy as compared with the existing methods.
Five datasets without an external  gold standard  were used to evaluate the sensitivity and the specificity less formally, as dis- cussed in (Anders and Huber, 2010).
First, comparisons of two conditions ( AvsB ) had some truly differentially expressed genes.
Therefore, methods with higher sensitivity should have higher areas under the empirical cumulative distribution functions  (ECDF) of the P-values defined as  ^FðpÞ ¼ 1  G  Ifp valueg pg.
P  G  g¼1  Table 2.
Areas under the ROC curves of detecting differentially expressed genes for the datasets with an external  gold standard  while varying the FDR- adjusted P-value or posterior probability cutoff  Methods  Proposed Existing  Simulation1 ni ¼ 1  ni ¼ 2  Simulation2 ni ¼ 1  ni ¼ 2  Simulation3 ni ¼ 1  ni ¼ 2  MAQC Project ni ¼ 1  nA ¼ 3, nB ¼ 2  Griffith et al.
ni ¼ 1  sSeq edgeR DESeq baySeq BBSeq SAMseq  0.947 0.918 0.932 0.568 0.675  0.962 0.948 0.940 0.711 0.672 0.964  0.951 0.938 0.937 0.548 0.669  0.967 0.951 0.949 0.714 0.674 0.968  0.856 0.840 0.842 0.558 0.578  0.888 0.833 0.816 0.628 0.619 0.882  0.585 0.558 0.577 0.551 0.560  0.911 0.850 0.867 0.852 0.617 0.563  0.689 0.557 0.596 0.702 0.544  Sub-columns are subsets of the data with one randomly selected replicate per condition and the full datasets.
Values closer to 1 indicate higher sensitivity and specificity.
1280   Estimation of dispersion in Negative Binomial models  (1) sSeq  (2) edgeR  (3) DESeq  (4) baySeq  (5) BBSeq  (a) Brooks    nA1=nA2=1       nA=nB=1 - - - nA=nB=2  (b) Sultan    nA1=nA2=1       nA=nB=1 - - - nA=nB=2  (c) Bottomly    nA1=nA2=1       nA=nB=1 - - - nA=10,nB=11  (d) Hammer    nA1=nA2=1       nA=nB=1       Full dataset  (e) Tuch    nA1=nA2=1       nA=nB=1       Full dataset  F D C E  F D C E  F D C E  F D C E  F D C E  p-value  p-value  p-value  1-post.
prob.
p-value  Fig.
2.
The ECDF curves of detecting differential expression for the datasets with no external  gold standard .
Y-axis: ECDF, function of the gene rank.
x-axis: P-value or 1 minus posterior probability.
Solid line: two randomly selected replicates from a same condition (AvsA).
Dotted line: one randomly selected replicate from each condition (unreplicated AvsB).
Dashed line: AvsB on the full dataset for two-group designs.
Dashed-dotted line: AvsB on the full dataset for more complex designs.
Gray line: 45 degree.
SAMseq is not applicable to unreplicated experiments and is excluded.
The desired patterns are high areas under the AvsB curves, and AvsA curves that are at or below the 45 degree line  Second, comparisons of replicates of a same condition ( AvsA ) had no differentially expressed genes.
Therefore, methods with higher specificity should have ECDF curves at or below the 45 degree line.
For baySeq, we expect similar patterns of the ECDF curves based on the posterior probability cutoff.
Figure 2 sum- marizes the curves for the five datasets.
It shows that sSeq pro- duced most consistently the expected pattern and had a similar or a higher accuracy as compared with the existing methods.
The effect of sample size and of size factors on the accuracy was investigated using the three simulated datasets.
Supplemen- tary Section 4.4 and 4.5 indicate that sSeq is particularly advan- tageous for experiments when n   4.
6 DISCUSSION  In this manuscript, we advocated a model that specifies free per- gene dispersion parameters in the Negative Binomial model for  counts of RNA-seq reads.
We also advocated a biased estimation of these parameters, which can reduce the variance of the esti- mates and minimize the overall MSE.
Biased estimation is dif- ferent from specifying a probability model (such as in DESeq) that assumes a true systematic relationship of the true variance and the true mean.
It is particularly useful for experiments with a small sample size, where the systematic relationship may be dif- ficult to evaluate.
The shrinkage estimates are easy to compute, avoid iterative estimation, minimize the potential for overfitting and do not require extra computation time.
They are compatible with the exact test of differential expression.
For the datasets in this manuscript, sSeq consistently had a similar or a higher sen- sitivity and specificity of detecting differential expression than the existing methods.
The approach can be generalized to express the dependence of the dispersions on the expected value or on other covariates such as guanine-cytosine (GC) content or Gene Ontology annotations.
1281   D.Yu et al.
sSeq can produce meaningful results in under-replicated RNA- seq screens.
However, we stress that RNA-seq screens do not eliminate the biological variation in gene expression Equation (12).
As evidenced by Table 2 and Figure 2, the under-replicated screens have lower reproducibility as compared with the repli- cated studies.
Multiple biological replicates are necessary to ad- equately assess the full extent of the variation in the biological system.
Therefore, the under-replicated screens can only be con- ducted when followed by a rigorous experimental validation with complementary technologies and adequate sample size.
ACKNOWLEDGEMENTS  The authors thank S. Anders, M. E. Bock and the Huber group for helpful discussions.
Funding: NSF CAREER award DBI-1054826 to O.V.
(in part).
Conflict of Interest: none declared.
REFERENCES  Med.
Res., [Epub ahead of print, doi: 10.1177/0962280211428386, November 28, 2011].
Lloyd-Smith,J.
(2007) Maximum likelihood estimation of the negative binomial dispersion parameter for highly overdispersed data, with applications to infec- tious diseases.
PLoS One, 2, e180.
Malo,N.
et al.
(2006) Statistical practice in high-throughput screening data analysis.
Nat.
Biotechnol., 24, 167 175.
Mardis,E.
(2008) Next-generation DNA sequencing methods.
Annu.
Rev.
Genomics  Hum.
Genet., 9, 387 402.
Marioni,J.
et al.
(2008) RNA-seq: an assessment of technical reproducibility and  comparison with gene expression arrays.
Genome Res., 18, 1509 1517.
Markowetz,F.
(2010) How to understand the cell by breaking it: network analysis of  gene perturbation screens.
PLoS Comput.
Biol., 6, e1000655.
McCarthy,D.
et al.
(2012) Differential expression analysis of multifactor RNA-seq experiments with respect to biological variation.
Nucleic Acids Res., 40, 4288 4297.
McCullagh,P.
and Nelder,J.
(1989) Generalized Linear Models.
Monographs on Statistics and Applied Probability (No.
37), Chapman & Hall/CRC, New York.
Metzker,M.
(2009) Sequencing technologies: The next generation.
Nat.
Rev.
Genetics, 11, 31 46.
Oshlack,A.
et al.
(2010) From RNA-seq reads to differential expression results.
Genome Biol., 11, 220.
Patterson,T.
et al.
(2006) Performance comparison of one-color and two-color plat- forms within the MicroArray Quality Control (MAQC) project.
Nat.
Biotechnol., 24, 1140 1150.
Pepke,S.
et al.
(2009) Computation for ChIP-seq and RNA-seq studies.
Nat.
Anders,S.
and Huber,W.
(2010) Differential expression analysis for sequence count  Methods, 6, S22 S32.
data.
Genome Biol., 11, R106.
Arikawa,E.
et al.
(2008) Cross-platform comparison of SYBR Green real-time PCR with TaqMan PCR, microarrays and other gene expression measurement tech- nologies evaluated in the MicroArray Quality Control (MAQC) study.
BMC Genomics, 9, 328.
Auer,P.
and Doerge,R.
(2011) A two-stage Poisson model for testing RNA-seq  data.
Stat.
Appl.
Genet.
Mol.
Biol., 10, 1 26.
Benjamini,Y.
and Hochberg,Y.
(1995) Controlling the false discovery rate: a prac- tical and powerful approach to multiple testing.
J. R Stat.
Soc.
B, 57, 289 300.
Bottomly,D.
et al.
(2011) Evaluating Gene Expression in C57BL/6J and DBA/2J  mouse striatum using RNA-seq and microarrays.
PloS One, 6, e17820.
Bowman,K.
(1984) Extended moment series and the parameters of the negative  binomial distribution.
Biometrics, 40, 249 252.
Brooks,A.
et al.
(2011) Conservation of an RNA regulatory map between  Drosophila and mammals.
Genome Res., 21, 193 202.
Bullard,J.
et al.
(2010) Evaluation of statistical methods for normalization and dif-  ferential expression in mRNA-seq experiments.
BMC Bioinformatics, 11, 94.
Cameron,A.
and Trivedi,P.
(1998) Regression Analysis of Count Data, Econometric  Society Monograph (No.30).
Cambridge University Press, Cambridge, UK.
Clark,S.
and Perry,J.
(1989) Estimation of the negative binomial parameter   by  maximum quasi-likelihood.
Biometrics, 45, 309 316.
Croarkin,C.
and Tobias,P.
(2006) NIST/SEMATECH e-Handbook of Statistical Methods.
National Institute of Standards and Technology.
http://www.itl.nist.
gov/div898/handbook/ (15 April 2013, date last accessed).
Frazee,A.
et al.
(2011) ReCount: a multi-experiment resource of analysis-ready  RNA-seq gene count datasets.
BMC Bioinformatics, 12, 449.
Piegorsch,W.
(1990) Maximum likelihood estimation for the negative binomial dis-  persion parameter.
Biometrics, 46, 863 867.
Richards,J.
(1999) An Introduction to James-Stein estimation, M.I.T.
EECS Area Exam Report, 1999. http://www.yaroslavvb.com/papers/richards-introduction.ps (15 April 2013, date last accessed).
Robinson,M.
et al.
(2010) EdgeR: a Bioconductor package for differential expres-  sion analysis of digital gene expression data.
Bioinformatics, 26, 139 140.
Robinson,M.
and Oshlack,A.
(2010) A scaling normalization method for differen-  tial expression analysis of RNA-seq data.
Genome Biol., 11, R25.
Robinson,M.
and Smyth,G.
(2007) Moderated statistical tests for assessing differ-  ences in tag abundance.
Bioinformatics, 23, 2881 2887.
Shi,L.
et al.
(2006) The MicroArray Quality Control (MAQC) project shows inter- and intraplatform reproducibility of gene expression measurements.
Nat.
Biotechnol., 24, 1151 1161.
Smyth,G.
(2004) Linear models and empirical Bayes methods for assessing differential expression in microarray experiments.
Stat.
Appl.
Genet.
Mol.
Biol., 3, 3.
Smyth,G.
(2005) Limma: Linear models for microarray data.
In: Bioinformatics Computational Biology Solutions Using R and Bioconductor.
Springer, New York, pp.
397 420.
Soneson,C.
and Delorenzi,M.
(2013) A comparison of methods for differential  expression analysis of RNA-seq data.
BMC Bioinformatics, 14, 91.
Stein,C.
(1956) Inadmissibility of the usual estimator for the mean of a multivariate Normal distribution.
In: Proceedings of the Third Berkeley symposium on math- ematical statistics and probability.
Vol.
1, University of California Press, Berkeley, pp.
197 206.
Garber,M.
et al.
(2011) Computational methods for transcriptome annotation and  Sultan,M.
et al.
(2008) A global view of gene activity and alternative splicing by  quantification using RNA-seq.
Nat.
Methods, 8, 469 477.
Griffith,M.
et al.
(2010) Alternative expression analysis by RNA sequencing.
Nature  Methods, 7, 843 847.
Hammer,P.
et al.
(2010) mRNA-seq with agnostic splice site discovery for nervous  system transcriptomics tested in chronic pain.
Genome Res., 20, 847 860.
Hansen,B.
(2008) Generalized Shrinkage Estimators.
University of Wisconsin.
Hardcastle,T.
and Kelly,K.
(2010) BaySeq: Empirical Bayesian methods for identify- ing differential expression in sequence count data.
BMC Bioinformatics, 11, 422.
James,W.
and Stein,C.
(1961) Estimation with quadratic loss.
In: Proceedings of the fourth Berkeley Symposium on Mathematical Statistics and Probability Held at the Statistical Laboratory, University of California, June 20-July 30, 1960.
University of California Press, p. 361.
Lehmann,E.
and Casella,G.
(1998) Theory of Point Estimation.
Springer, New York.
Li,J.
et al.
(2011) Normalization, testing, and false discovery rate estimation for  RNA-sequencing data.
Biostatistics, 13, 523 538.
Li,J.
and Tibshirani,R.
(2011) Finding consistent patterns: a nonparametric ap- proach for identifying differential expression in RNA-seq data.
Stat.
Methods  deep sequencing of the human transcriptome.
Science, 321, 956 960.
Toft,N.
et al.
(2006) The Gamma-Poisson model as a statistical method to deter- mine if micro-organisms are randomly distributed in a food matrix.
Food Microbiol., 23, 90 94.
Tuch,B.
et al.
(2010) Tumor transcriptome sequencing reveals allelic expression  imbalances associated with copy number alterations.
PloS One, 5, e9317.
Wang,L.
et al.
(2010) DEGseq: an R package for identifying differentially expressed  genes from RNA-seq data.
Bioinformatics, 26, 136 138.
Wang,Z.
et al.
(2009) RNA-seq: a revolutionary tool for transcriptomics.
Nat.
Rev.
Genet., 10, 57 63.
Willson,L.
et al.
(1984) Multistage estimation compared with fixed-sample-size es-  timation of the negative binomial parameter k. Biometrics, 40, 109 117.
Zhining,W.
et al.
(2010) Evaluation of gene expression data generated from expired Affymetrix GeneChip microarrays using MAQC reference RNA samples.
BMC Bioinformatics, 11 (Suppl.
6), S10.
Zhou,Y.
et al.
(2011) A powerful and flexible approach to the analysis of RNA  sequence count data.
Bioinformatics, 27, 2672 2678.
1282
