Genomics Proteomics Bioinformatics 12 (2014) 39 47  Genomics Proteomics Bioinformatics  www.elsevier.com/locate/gpb  www.sciencedirect.com  ORIGINAL RESEARCH  Bayesian Peak Picking for NMR Spectra  Yichen Cheng 1, Xin Gao 2, Faming Liang 1,*  1 Department of Statistics, Texas A&M University, College Station, TX 77843, USA 2 Computer, Electrical and Mathematical Sciences and Engineering Division, King Abdullah University of Science and  Technology (KAUST), Thuwal 23955-6900, Saudi Arabia  Received 1 June 2013  accepted 29 July 2013 Available online 31 October 2013  KEYWORDS  Markov chain Monte Carlo  Nuclear magnetic resonance  Peak picking  Abstract Protein structure determination is a very important topic in structural genomics, which helps people to understand varieties of biological functions such as protein-protein interactions, protein DNA interactions and so on.
Nowadays, nuclear magnetic resonance (NMR) has often been used to determine the three-dimensional structures of protein in vivo.
This study aims to auto- mate the peak picking step, the most important and tricky step in NMR structure determination.
We propose to model the NMR spectrum by a mixture of bivariate Gaussian densities and use the stochastic approximation Monte Carlo algorithm as the computational tool to solve the prob- lem.
Under the Bayesian framework, the peak picking problem is casted as a variable selection problem.
The proposed method can automatically distinguish true peaks from false ones without preprocessing the data.
To the best of our knowledge, this is the ﬁrst effort in the literature that tackles the peak picking problem for NMR spectrum data using Bayesian method.
Introduction  Determination of structure-function relationships has been a long-standing research topic in structural genomics.
Nowa- days, nuclear magnetic resonance (NMR) has often been used to determine the three-dimensional structures of proteins, especially for the small proteins that are partially disordered, exist in multiple stable conformations in solution, show weak interactions with ligands, or do not crystallize readily.
The  * Corresponding author.
E-mail: ﬂiang@stat.tamu.edu (Liang F).
Peer review under responsibility of Beijing Institute of Genomics, Chinese Academy of Sciences and Genetics Society of China.
Production and hosting by Elsevier  NMR protein structure determination commonly involves a series of steps, such as peak picking, chemical shift assignment, nuclear Overhauser effect (NOE) assignment and structural calculation [1].
Among them, peak picking is the most impor- tant and tricky step and it is also the prerequisite for all the fol- lowed steps (see e.g., [2,3]).
As shown in Figure 1 using protein TM1112 as an example, a typical NMR spectrum contains many peaks.
We show 3D plot of protein TM1112 in panel A and show contour plot in panel B for the same protein.
Here, H dimension corresponds to chemical shift in hydrogen dimension and N dimension corresponds to chemical shift in nitrogen dimension.
Each peak, which is often referred to as a signal, represents a group of nuclei that can be coupled through bonds (scalar coupling) or space (spin spin coupling).
Peak picking step extracts the frequencies of each peak, which correspond to the chemical shift values of the corresponding nuclei.
Such chemical shift values are then assigned to the cor- responding atoms of the protein by considering the inter- and  1672-0229/$ - see front matter ª 2013 Beijing Institute of Genomics, Chinese Academy of Sciences and Genetics Society of China.
Production and hosting by Elsevier B.V. All rights reserved.
http://dx.doi.org/10.1016/j.gpb.2013.07.003   40  Genomics Proteomics Bioinformatics 12 (2014) 39 47  intra-residue information that different spectra contain.
The assignment is used to interpret NOE peaks, which provide distance constraints for the structural calculation step.
How- ever, the peak picking step is usually very time-consuming.
Typically, it costs an experienced spectroscopist weeks or even months to accomplish the task.
To automate this step, a vari- ety of methods have been proposed, including neural networks [4], singular value decomposition [5,6], wavelet-based smooth- ing [7], among others.
The existing methods select peaks based on the intensities or the volumes of the peaks, and often fail for complex spectra.
For example, they often fail to identify peaks with low inten- sity and overlapping peaks, and fail to distinguish false peaks with high intensities/volumes from true ones.
In addition, they require a preprocessing step of data smoothing to remove noise.
In this paper, we propose a Bayesian method to tackle this problem.
We model the spectrum by a mixture of bivariate Gaussian densities and use the stochastic approximation Monte Carlo (SAMC) algorithm to estimate the positions and intensities of the peaks.
Under the Bayesian framework, we cast the peak picking problem as a variable selection problem.
Therefore, sophisticated Bayesian variable selection methods can be applied to seek for high-quality solutions to this problem.
The rest of this paper is structured as follows.
We will ﬁrst introduce the Bayesian model for NMR spectrum data.
Next, we describe in detail the SAMC algorithm for peak picking.
Following that, we give the results for both simulation studies and real NMR data, which show the beneﬁt of the proposed method.
We then conclude the paper with a brief discussion.
A Bayesian model for NMR spectra  For simplicity, this section describes only the model for the NMR spectra in two-dimensional (2D) space.
The 2D NMR experiments, such as 15N-HSQC, are among the most fre- quently used spectra for protein structure determination.
Extension of the proposed method to higher-dimensional spaces is straightforward.
Suppose that the NMR spectrum consists of a total of n (= L   W) grid points.
Let g(i, j) denote the intensity of the     the grid point  i = 1, .
.
.
,L and spectrum at j = 1, .
.
.
,W. Then we model g(i, j) as a mixture of bivariate Gaussian densities:  (i, j)  for     X  m  k¼1        gði  jÞ¼  ak/k i  jjlk1 lk2 s2  k1 s2  k2  þ  ij   i¼ 1 .. .
L and j¼ 1  .. .
W  ð1Þ  k2  where /k(Æ) is the kth component of the mixture density func- tion with mean (lk1, lk2)0 and covariance matrix diag   ak is the volume (or amplitude) of the kth component, s2 k1  s2 and  ij is the error term, which is assumed to be normally dis- tributed with mean 0 and variance r2.
We use M to denote a model and use m = ŒM Œ to denote its size, i.e., the number of components included in the mixture density function.
By lining up all the n grid points, the model (1) can be writ-  ten in the matrix vector form as follows: Y ¼ Ua þ    where  0BBBBBBBBBBBBBBBBBB@  1CCCCCCCCCCCCCCCCCCA  gð1  1Þ  .
..  gð1  WÞ  .
..  gðL  1Þ  .
..  gðL  WÞ  0BBBBBBBBBBBBBBBBBB@  1CCCCCCCCCCCCCCCCCCA  /1ð1  1Þ      /mð1  1Þ  .
..  /1ð1  WÞ     /mð1  WÞ  .
..  /1ðL  1Þ      /mðL  1Þ  .
..  /1ðL  WÞ     /mðL  WÞ  Y¼    U¼    a¼  ð2Þ  1CCCCCCCCCCCCCCCCCCA  :  0BBBBBBBBBBBBBBBBBB@   11  .
..   1W  .
..   L1  .
..   LW  1CCCA   ¼  0BBB@  a1  .
..  am  Here Y is an n-vector representing the spectrum intensity for each grid point  U is an n   m matrix that carries the informa- tion of m Gaussian density functions, each column of U corre- sponds to one Gaussian density component, and /k (i, j) is deﬁned as in (1) but with parameters omitted  a is a m-vector consisting of the volumes of each component  and   is an n-vec- tor representing the random error.
Let # = (#1, .
.
.
,#n), where #i ¼ li1 li2  log s2    log s2 i2  .
i1  Then the likelihood function of the model (1) is given by  Illustration of 2D NMR spectrum data using protein TM1112 as an example  Figure 1 A.
A 3D plot of 2D NMR spectrum data for protein TM1112.
The Z axis is for the intensity of the spectrum.
B.
A contour plot of the same spectrum data.
Here, H dimension corresponds to chemical shift in hydrogen dimension and N dimension corresponds to chemical shift in nitrogen dimension.
One unit in H dimension represents 0.0148 ppm and one unit in D dimension represents 0.0873 ppm.
Cheng Y et al / Bayesian Peak Picking for NMR Spectra     41    ð2pÞn=2jr2Imjn=2 exp  1  2  1  fðYj# a r2 mÞ¼  ðY  UaÞTðr2InÞ 1ðY  UaÞ     where Im denotes an m   m identity matrix.
li2   Uð0  WÞ  i2   IGða  bÞ   To conduct Bayesian analysis for the model (1), we consider the following prior distributions for the unknown parameters: a   Nð0  r2VÞ  li1   Uð0  LÞ  i1   IGða  bÞ  s2 s2 r2   v2 m m  where IG (Æ, Æ) denotes an inverse gamma distribution, U (Æ, Æ) denotes a uniform distribution, and m, V are hyperparameters to be speciﬁed by the user.
In this paper, we set V = (U0U) 1  that is, we specify a Zellner s g-prior for the regression coefﬁ- cients a with g = 1.
Following [8], we set m = 1 and a = b = 0.05.
The latter leads to vague priors for si1 s and si2 s. Since, for a given spectrum, the peak positions are always bounded, we let lij s be subject to the uniform priors.
Furthermore, we assume the prior distribution of m follows  P  e k  m 2 f1  .
.
.
mmaxg   a truncated Poisson distribution with mean k  that is, km PðjMj ¼ mÞ ¼ 1 m!
C where C ¼ m!
e k, and k and mmax are hyperparameters km mmax i¼1 to be speciﬁed by the user.
In practice, one may set k to a small number to avoid ﬁnding too many false peaks.
In this paper, we set k = 1 in all computations which yield good results.
Our numerical results indicate that the choice of mmax is not crucial for peak picking, as long as it is not too small, e.g., smaller than the number of true peaks.
In this paper, we set mmax to 10 for the simulation studies, and a relatively small number, e.g., two times of the number of amino acids, for a given protein.
Integrating out a and r2 gives us the posterior           Y  m             a 1  exp   b s2 i1 PðYj#  mÞ     Y fð# jMj¼ mjYÞ/ km m!
ba CðaÞ s2        1  m  i2     LmWm  i¼1  i¼1  a 1     i1  ba CðaÞ s2 exp   b s2 i2  where  PðYj#  mÞ¼          C vþn jIn þ UVUTj1=2  fvþ Y TðIþ UVUTÞ 1  ðvÞv=2  2  pn=2C v 2  ð3Þ  Yg ðvþnÞ=2  :  Note that the intensity for a true peak should be positive for the 2D NMR spectrum considered here.
However, in our mod- el, no any constraints are imposed concerning the value of a.
This allows us to integrate out a from the posterior and, as a consequence, this accelerates the convergence of the simulation of the posterior.
The marginal posterior distribution of a is normal with mean ðUTU þ V 1Þ 1UTY and covariance matrix r2ðUTU þ V 1Þ 1 .
Hence, a can be estimated based on its expectation ðUTU þ V 1Þ 1UTY conditional on the samples of # and m obtained at each iteration.
Bayesian peak picking  The Bayesian peak picking problem is to determine the number of peaks, m, and the peak positions (l11, l12), .
.
.
,  (lm1, lm2) through simulating from the posterior (Eq.
(3)).
However, it is not known how many peaks there are for a gi- ven NMR spectrum, although the intensities at the grid points around the peaks are relatively high.
Based on this observa- tion, we propose following algorithm for Bayesian peak picking.
For an L   W grid NMR spectrum, we ﬁrst select N poles as   peak candidates  .
This can be done by selecting N poles with the highest intensities, or, if we have the results from some other methods, we can set them to be part of the peak candi- dates as well.
In this paper, we have tried both.
Let  (P1,1,P1,2), .
.
.
,(PN,1, PN,2)  denote the pool of candidate peaks, which gives all candidate components for the model (Eq.
(1)).
Then the peak picking problem is casted as a Bayes- ian variable selection problem, selecting appropriate compo- nents from the pool of candidate peaks.
For the solution of the Bayesian variable selection problem, we apply the stochastic approximation Monte Carlo (SAMC) algorithm [9] to estimate both the number and positions of the peaks through simulating from the posterior distribution (Eq.
(3)).
SAMC is an adaptive Markov chain Monte Carlo (MCMC) algorithm which possesses the self-adjusting mecha- nism and is immune to local trap problems.
At each step, SAMC updates the set of selected peaks by either adding a peak (birth move), deleting a peak (death move), or reﬁning the position of a selected peak (position update).
Let  t I denote the peaks included in the model at iteration t and let  t R denote the remaining peaks that are not included in the current sam- R ¼ fðP1 1  P1 2Þ  .
.
.
ðPN 1  PN 2Þg The birth ple.
Hence,  t move creates a new peak by randomly selecting one from the set  t R and proposing a peak position based on the selected peak.
The death move removes one peak from the set  t I.
The position update reﬁnes the position of a randomly-selected peak, which does not change the dimension of the model (Eq.
(1)).
I [  t  A brief review of the SAMC algorithm  Let f(x) = cw(x), x 2 v, denote a distribution that we are working with, where c denotes a constant and X denotes the the distribution.
Let U(x) =  log(w(x)) sample space of denote the energy function of the distribution.
SAMC works on a partitioned sample space.
For example, the sample space can be partitioned into j disjoint subregions according to the energy function: E1 =  x:U(x)   u1 , E2 =  x:u1 6 U(x)   u2 , .
.
.
, Ek 1 =  x:uj 2 6 U(x)   uj 1  and Ej =  x: U(x) P uj 1 , where u1, u2, .
.
.
,uj 1 are prespeciﬁed numbers.
SAMC algorithm aims following distribution: PhðxÞ /  Iðx 2 EiÞ   X  to sample  from the  ð4Þ  j  wðxÞ ehi  i  R  where h = (h1, .
.
.
,hk) and hi ¼ log wðxÞdx, and I (Æ) is the indicator function.
It is easy to see that sampling from (Eq.
(4)) will lead to a   random walk   in the space of energy, if the sample space is partitioned according to the energy func- tion and each subregion is treated as a   point  .
Ei  However, h is usually unknown.
SAMC provides an auto- matic mechanism to estimate h in simulations from f(x).
As shown in [10], SAMC is essentially a dynamic importance sam- wðxÞdx at pling algorithm.
Let hti denote the estimate of log  R  Ei   42  Genomics Proteomics Bioinformatics 12 (2014) 39 47  iteration t, and deﬁne ht = (ht1, .
.
.
,htk).
Then one iteration of the SAMC algorithm can be described as follows.
PhtðxÞ /  j  X  (1) Conditioned on the current sample x(t), simulate a sam- ple x(t + 1) according to a Markov transition kernel, which admits the following distribution as the invariant distribution: wðxÞ ehti ht+1 = ht + ct + 1(et+1   1/j), where  et + 1 = (et + 1,1, .
.
.
,et + 1,m), et + 1,i = 1 if x(t + 1) 2 Ei and 0 otherwise, and ct + 1 is called the gain factor.
Iðx 2 EiÞ  (2) Set  ð5Þ  i  P  P  XQ  U  ð  Þ ðtÞ minþ@  i  The gain factor sequence  ct  is positive and non-decreas- t   1 cn some n 2 (1, 2).
maxðt0 tÞ    In this paper, we set ct ¼ dt0  ing, and satisﬁes the conditions for t0 ¼ 5000  d ¼ 0:5.  ct ¼ 1 and  When the dimension of x is high or when the sampling space X is too large, SAMC may take long time to converge.
For this reason, we adopt a variant of SAMC, annealing sto- chastic approximation Monte Carlo [11], for simulating from the posterior (Eq.
(3)).
Annealing SAMC shrinks the sample space at each iteration according to the current sample.
To be precise, at each iteration, annealing SAMC draws samples from the distribution  PhtðxÞ /  fðxÞ exp ht1ð  Þ Iðx 2 EiÞ  ð6Þ  ðtÞ min is the best value of U(x) obtained by iteration where U t,@   0 is a user-deﬁned parameter that determines the broad- ness of the sample space at each iteration, and P(u) denotes the index of if if @ is large, say ui 1   u   ui, @ P 20, then it follows from the principle Occam s razor [12] that the samples simulated using annealing SAMC can still be used for Bayesian inference.
In this paper, we set @ ¼ 1000.  subregions based on the energy function   then P(u) = i.
Clearly,  SAMC for Bayesian peak picking  In this section, we use M* to denote the proposed model, use M(t) to denote the current model, use #* to denote the parameter vec- tor proposed for the model M*, and use #(t) to denote the param- eter vector of the current model.
At each iteration, SAMC randomly chooses to make one of the following moves with equal probability: position update, birth move and death move.
Position update                                 i2  i1  i1  i-th  i1   lðtÞ  say, ðtÞ   log s2 i2 i1  l  i2  log s 2  In this move, we randomly choose one component from the current model, component #ðtÞ ¼ lðtÞ i2   log s2 , then we propose to re- place it by #  ¼ l  , which is gener- ated by one of the following with equal probability: i j ¼ # i j þ un  S  for one j randomly drawn from f1 2 3  4g ðtÞ #  i ¼ # i þ un  S  e  ðtÞ #   the ðtÞ   log s 2  ð7Þ where un is a random variable generated from the standard normal distribution, S is called the step size, and e is a vector randomly drawn from a unit sphere of dimension 4.  )
(  The proposal is accepted with probability  a ¼ min 1   expfhJð#ðtÞÞgPð#  jM kYÞTð#  !
#ðtÞÞ expfhJð# ÞgPð#ðtÞ jMðtÞkYÞTð#ðtÞ !
# Þ  ð8Þ  where J(#) denotes the index of the subregion that the corre- sponding model belongs to and Tð#ðtÞ !
# Þ denotes the pro- posal distribution that is determined by Eq.
(7).
Birth move  This move is to randomly choose a pole from the list of unse- lected peak candidates to add to the current model.
For exam- ple, the peak  Pi,1, Pi,2  is chosen, then the related parameters are proposed as follows: i1 ¼ Pi 1 þ un1   S    l  i2 ¼ Pi 2 þ un2   S  l    log s 2 log s 2  ¼ UðlogðL3Þ  logðU3ÞÞ  ¼ UðlogðL4Þ  logðU4ÞÞ   ð9Þ ð10Þ ð11Þ ð12Þ       i1  i2     where un1 and un2 are random samples drawn from the stan- dard normal distribution.
The acceptance probability of the move is given by  a ¼ min 1   QðjM j !
jMðtÞjÞ QðjMðtÞj !
jM jÞ  PðDeathjM Þ PðBirthjMðtÞÞ RPU  n  o     ð13Þ     the             Jð#ðtÞÞ h  is the acceptance rate  corresponding model belongs    I þ 1  Pð#  jM jjYÞTð# !#ðtÞÞ expfhJð# ÞgPð#ðtÞ jMðtÞjjYÞTð#ðtÞ!# Þ  where RPU ¼ exp for position update move.
where J(#) denotes the index of the to  subregion that QðM  !
MðtÞÞ=QðMðtÞ !
M Þ ¼  Pt accounts for the probability of adding a pole/component to the current model  T(Æ ﬁ Æ) denotes the proposal distribution determined by Eqs.
(9) (12)  P(Birth ŒM(t)) = 1/3 if 1   ŒM(t)Œ   mmax, P(Birth ŒM(t)) = 2/3 if ŒM(t)Œ = 1, and P(Birth ŒM(t)) = 0 if ŒM(t)Œ = mmax  1   ŒM*Œ   mmax, P(Death ŒM*) = 0 if ŒM*Œ = 1, and P(Death ŒM*) = 2/3 if ŒM*Œ = mmax.
and P(Death ŒM*)  =  Pt  if  R  Death move  This move is to randomly delete one component from the model (Eq.
(1)).
The acceptance probability of this move is gi- ven by        a ¼ min 1   n  o  QðjM j !
jMðtÞjÞ QðjMðtÞj !
jM jÞ  PðBirthjM Þ PðDeathjMðtÞÞ RPU  ð14Þ  Pð#  jM jjYÞTð# !#ðtÞÞ  f  the     Jð#ðtÞÞ h exp hJð# Þ  corresponding model belongs    Ij=  Pt  where RPU ¼ exp gPð#ðtÞ jMðtÞjjYÞTð#ðtÞ!# Þ is the acceptance rate for position update move.
where J(#) denotes the index of the subregion that to  QðM  !
MðtÞÞ=QðMðtÞ !
M Þ ¼ j Pt accounts for the probability of removing a component from the current model  T(Æ ﬁ Æ) denotes the proposed distribution determined (9) (12)  P(Birth ŒM*) = 1/3 if 1   ŒM*Œ   mmax, by Eqs.
P(Birth ŒM*) = 2/3 if ŒM*Œ = 1, and P(Birth ŒM*) = 0 if ŒM*Œ = mmax  and P(Death ŒM(t)) = 1/3 if 1   Œ M(t)Œ   mmax, P(Death ŒM(t)) = 0 if ŒM(t)Œ = 1, and P(Death ŒM(t)) = 2/3 if ŒM(t)Œ = mmax.
R þ 1   Cheng Y et al / Bayesian Peak Picking for NMR Spectra  43  Peak identiﬁcation  At the end of the SAMC run, the peaks can be identiﬁed according to the marginal inclusion probability, that is, the posterior probability of each pole.
Since SAMC is essentially a dynamic importance sampling algorithm [10], the marginal inclusion probability for a given pole can be estimated by Ii ¼  P P i expðhJð#ðtÞÞÞ t1þt2 t¼t1þ1It t¼t1þ1 expðhJð#ðtÞÞÞ   t1þt2  i ¼ 1  2  .
.
.
N   ð15Þ  b  where t1 denotes the number of burn-in iterations, t2 denotes the number of iterations used for posterior calculation, and It i is an indicator variable which is 1 if the i-th candidate peak is included in the model M(t) and 0 otherwise.
In this paper, we set and t1 = t2 = 250,000 for the real data examples.
Alternatively, the peaks can be identiﬁed based on the maximum a posteriori (MAP) model.
In our examples, the peaks identiﬁed by these two methods tend to be identical.
t1 = t2 = 50,000  simulation  study  the  for  If a pole is identiﬁed as a peak, the related parameters can  P P be estimated by i j expðhJð#ðtÞÞÞ ðtÞ t1þt2 t¼t1þ1# ^#i j ¼ t¼t1þ1 expðhJð#ðtÞÞÞ t1þt2  :  b  ð16Þ  Ii and ^#i j are  It follows from the theory of SAMC, both consistent.
Post-processing of simulation results  When applying the proposed method to NMR spectrum data, several issues need to be taken care for post-processing the simulation results.
(1) As aforementioned, we did not re- strict the peak intensity parameter vector a to be positive for the reason of computational efﬁciency.
If the simulated mod- el contains some components of negative intensities, we can directly eliminate them from the model.
Those components capture the outrageous noise of the data, and removing them corresponds to a denoising step employed by other methods.
(2) It is believed that the spreads of true peaks are relatively small as compared to the range of the spectrum.
In model (Eq.
(1)), the spreads of components are measured by si1 and si2 for i = 1, 2, .
.
.
,N. Hence, for a component, say com- ponent i, if si1 or si2 is large, then it is reasonable to treat it  p  L/2 and  L/2 or si2    as an overall trend rather than a peak.
This suggests us to remove it from the model.
In our study, we found that it p p is good enough to set the threshold for si1 and si2 to be p W/2, respectively  that is, removing the peaks with si1   W/2.
(3) In the practice of NMR peak picking, the tolerance limit for N dimension is 0.5 and that for H dimension is 0.05.
Hence, if the simulated model contains two components that are close to each other in the sense that the difference between their locations is within the tolerance range, then we will combine them into a single peak.
Numerical results  Simulation study  In the simulation study, we generated an image of size 50   50 with 5 peaks.
The volumes of the 5 peaks are 452293.9, 532729.6, 719234.05, 403184 and 215974.5, respectively.
Their intensities are 14353.41, 15907.05, 18044.68, 43738.34 and 23187.57, respectively.
Extra noises are added to the image.
To study the sensitivity of our method to the noise, two situa- tions are considered.
(1) The noise follows a normal distribu- tion with mean 0 and standard deviation 4000 and (2) the noise follows a normal distribution with mean 0 and standard deviation 4000  in addition, some extra negative spikes are put around the point (10, 20) with the volume 100,000.
Figure 2 shows the example for situation 1.
The image with noises added is shown in Figure 2A, for which the true peaks are hard to detect using naked eyes, whereas the recovered im- age by SAMC, and the pure image without noises added are shown in Figure 2B and C. The comparison of the recovered image and the pure image shows that we have successfully denoised the image and recovered the locations and shapes of the peaks.
As shown in Figure 3, the results for situation 2 is similar.
Table 1 shows the peak position estimation by our method for the simulated example with the noise as simulated in situation 1.
It is easy to see that the estimation is rather accurate.
In this table, we also include the marginal inclusion probability of candidate poles.
The poles corresponding to the true peaks have a marginal inclusion probability of 1 and  Figure 2 A simulated image of 5 peaks with the noise simulated as in situation 1 A.
The image with noises added, for which the true peaks are hard to detect using naked eyes.
B.
The recovered image by SAMC.
C. The pure image without noises added.
44  Genomics Proteomics Bioinformatics 12 (2014) 39 47  Figure 3 A simulated image of 5 peaks with the noise simulated as in situation 2 A.
The image with noises added, for which the true peaks are hard to detect using naked eyes.
B.
The recovered image by SAMC.
C. The pure image without noises added.
Table 1 Peak position estimation for the simulated example in situation 1  Peak  True position  l1  1 2 3 4 5 Note: (l1, l2) is the location of the peaks and ð probability of the corresponding pole.
40 10 20 5 30  c  l1    c  l2  24 37 12 23 46  c  l1  40.80 9.70 20.16 4.84 30.23  Estimated position  c  l2  24.14 36.94 11.91 22.94 46.01  MIP  1 1 1 1 1  l2Þ is the estimation using Bayesian peak picking method.
MIP refers to the marginal inclusion  all others have a marginal inclusion probability of 0.
This im- plies that our method has converged to true peaks.
NMR peak picking  We have applied the proposed method to six proteins along with a comparison with an existing method.
We used 2D 15N-HSQC spectra for the experiment.
For the N dimension, a peak is considered correct if its distance from the truth is less than 0.5.
For the H dimension, a peak is considered correct if  the distance is less than 0.05.
In the 2D space, a peak is consid- ered correct if both the N and H dimensions are within the tol- erance ranges when compared to the true peak.
Let NT denote the number of true peaks in a given spec- trum, let NP denote the number of peaks being picked and let TP denote the number of true peaks being picked.
Then the recall rate is deﬁned as TP/NT, which is the identiﬁcation rate of a true peak  and the precision is deﬁned as TP/NP, which is the proportion of true peaks among the identiﬁed peaks.
Figure 4 shows the results of our method for protein  Figure 4 Results of Bayesian peak picking method for protein HACS1 One unit in H dimension represents 0.0148 ppm and one unit in D dimension represents 0.0873 ppm.
Cheng Y et al / Bayesian Peak Picking for NMR Spectra  45  SAM domain, SH3 domain and nuclear localization signals 1(HACS1), where the asterisk (*) denotes the true peaks and the circle denotes the identiﬁed peaks using the proposed meth- od.
The only peak that was not identiﬁed by our method is the one around the grid point (109,200).
The contour plot given in Figure 5 shows that the intensity around the grid point (109,200) is very low.
Figure 6 gives the peak picking results using our method for protein coilin.
Figure 7 shows the contour plot of the NMR spectrum for coilin.
It is obvious that in the region of [240,320]   [110, 140], there are lots of peaks with very high intensities.
However, there are no true peaks residing in this re- gions.
Results show that our method is able to exclude a big portion of false peaks in that suspicious region, although not all of them.
Table 2 summarizes the results of our method for 6 proteins along with a comparison with PICKY [6], a newly developed powerful peak picking method.
Table 2 reports the recall  and precision and F-score [13] values for PICKY and the pro- posed method.
On average, the proposed method is 1.0% more accurate in recall and 3.9% more accurate in precision for these 6 proteins.
Taking a closer look at Table 2, we can see that the pro- posed method has made improvements over PICKY under dif- ferent situations.
Our method has made the most signiﬁcant improvements over PICKY on proteins vancomycin resistance associated regulator (VraR) and HACS1.
For these two pro- teins, PICKY gives high recall rates but low precision values.
Compared to PICKY, our method works well in eliminating false peaks.
However, our method does not improve the results of PICKY for Thermotoga maritima enzyme protein TM1112, for which PICKY already did a good job.
From this example, we ﬁnd that our method can fail to identify overlapping peaks as other existing methods do.
Table 2 reported the results with the candidate poles selected according to the intensities and according to the preliminary results of PICKY.
Overall,  Figure 5 Contour plot for the 15N-HSQC spectrum of protein HACS1 One unit in H dimension represents 0.0148 ppm and one unit in D dimension represents 0.0873 ppm.
Figure 6 Results of Bayesian peak picking method for protein coilin One unit in H dimension represents 0.0118 ppm and one unit in D dimension represents 0.1508 ppm.
Asterisk (*) denotes the true peaks and the circle denotes the identiﬁed peaks using the proposed method.
46  Genomics Proteomics Bioinformatics 12 (2014) 39 47  Figure 7 Contour plot for the 15N-HSQC spectrum of protein coilin One unit in H dimension represents 0.0118 ppm and one unit in D dimension represents 0.1508 ppm.
Red square box marks the true peaks that are not detected by our method.
Table 2 Numerical results for the 6 proteins tested  Protein name  Protein length  PICKY  SAMC1  SAMC2  Recall  Precision  F-score  Recall  Precision  F-score  Recall  Precision  F-score  TM1112 RP3384 ATC1776 Coilin VraR HACS1 Average  89 64 101 98 72 74     96 94 78 97 87 95 91.2  89 86 82 70 93 67 81.2  92.4 89.8 80.0 81.3 89.9 78.6 85.3  94 91 83 94 93 98 92.2  89 83 84 77 98 81 85.3  91.4 86.8 83.5 84.7 95.4 88.7 88.4  95 93 87 94 91 98 93.0  85 91 76 80 98 81 85.2  89.7 92.0 81.1 86.4 94.4 88.7 88.7  Note: SAMC1, results of SAMC with peak candidates selected by intensities in a descending order  SAMC2, results of SAMC with peak candidates from the results of PICKY.
our method does not perform differently under the two aforementioned settings, since the self adjustment mechanism of SAMC makes the simulation less dependent on the starting point.
Discussion  In this paper, we proposed a Bayesian method to tackle the problem of NMR peak picking.
Our numerical results indicate that the proposed method tends to produce more accurate re- sults than the existing methods.
To the best of our knowledge, this is the ﬁrst effort in the literature that tackles the NMR peak picking problem using a Bayesian method.
Our method has a few advantages over the existing methods.
(1) Through choosing appropriate prior distributions, our method auto- matically penalizes the models with too many or too few peaks.
(2) Our method can automatically distinguish true peaks from false ones without preprocessing the data.
While the existing methods need to ﬁrst remove the noise by setting a threshold at a risk of signal deletion.
(3) Our method has the ability to estimate the spread and volume of each peak dur- ing the process of peak picking.
This helps to reconstruct the denoised spectrum as compared to the existing methods which just give the peak positions.
A drawback of our method is that it is computationally intensive.
This difﬁculty can be alleviated through parallel computing.
We can partition the spectrum into multiple subre- gions and then process each of the subregions in parallel.
For instance, for TM1112, we partition the spectrum into 6 subre- gions, and the run of SAMC takes only a few hours for each subregion.
This is acceptable to most NMR laboratories.
Our method can be improved in various ways.
For example, we can improve the ﬁtting of the model to the spectra by replac- ing the Gaussian density function with a skew Gaussian density function, as the latter has a much more ﬂexible density shape than the former.
Other different prior distributions can also be tried for the model parameters, e.g., the mixture g-prior [14], which can leads to the consistency of variable selection.
Authors  contributions  YC and FL conceived and designed the method.
XG collected the data and YC analyzed the data.
YC, XG and FL wrote the paper.
All authors read and approved the ﬁnal manuscript.
Competing interests  The authors declared that no competing interests exist.
Cheng Y et al / Bayesian Peak Picking for NMR Spectra  47  Acknowledgements  This study was partially supported by grants from the National Science Foundation of USA (Grant No.
DMS- 1007457 and DMS-1106494) and the award (KUS-C1-016- 04) made by King Abdullah University of Science and Technology (KAUST) to FL.
References  [1] Wu  thrich K. NMR of Proteins and Nucleic Acids.
New York:  Wiley  1986.
[2] Gao X.
Mathematical approaches to the NMR peak-picking  problem.
J Appl Comput Math 2012 1:1.
[3] Gao X.
Recent advances in computational methods for nuclear magnetic resonance data processing.
Genomics Proteomics Bio- informatics 2013 11:29 33.
[4] Corne S, Jognson P, Fisher J.
An artiﬁcial neural network for classifying cross peaks in two dimensional NMR spectra.
J Magn Reson 1992 100:256 66.
[5] Koradi R, Billeter M, Engeli M, Gu  ntert P, Wu  thrich K. Automated peak picking and peak integration in macromolecular NMR spectra using AUTOPSY.
J Magn Reson 1998 135:288 97.
[6] Alipanahi B, Gao X, Karakov E, Donaldson L, Li M. PICKY: a novel SVD-based NMR spectra peak picking method.
Bioinfor- matics 2009 25:i268 75.
[7] Liu Z, Abbas A, Jing BY, Gao X. WaVPeak: picking NMR peaks through wavelet-based smoothing and volume-based ﬁltering.
Bioinformatics 2012 28:914 20.
[8] Raftery A, Madigan D, Hoeting J. Bayesian model averaging for  linear regression models.
J Am Stat Assoc 1997 92:179 91.
[9] Liang F, Liu C, Carroll R. Stochastic approximation in Monte  Carlo computation.
J Am Stat Assoc 2007 102:305 20.
[10] Liang F. On the use of stochastic approximation Monte Carlo for  Monte Carlo integration.
Stat Probab Lett 2009 79:581 7.
[11] Liang F. Annealing stochastic approximation Monte Carlo for  neural network training.
Mach Learn 2007 68:201 33.
[12] Madigan D, Raftery A.
Model selection and accounting for model uncertainty in graphical models using Occam s window.
J Am Stat Assoc 1994 89:1535 46.
[13] Huang YJ, Powers R, Montelione GT.
Protein NMR recall, precision, and F-measure scores (RPF scores): structure quality assessment measures based on information retrieval statistics.
J Am Chem Soc 2005 127:1665 74.
[14] Liang F, Paulo R, Molina G, Clyde M, Berger J. Mixtures of g for Bayesian variable selection.
J Am Stat Assoc  priors 2008 103:410 23.
