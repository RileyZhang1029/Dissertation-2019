BIOINFORMATICS ORIGINAL PAPER Vol.
26 no.
2 2010, pages 175 181  doi:10.1093/bioinformatics/btp635  Sequence analysis Target prediction and a statistical sampling algorithm for RNA RNA interaction Fenix W. D. Huang1, Jing Qin1, Christian M. Reidys1,2,  and Peter F. Stadler3 8 1Center for Combinatorics, LPMC-TJKLC, 2College of Life Science, Nankai University, Tianjin 300071, P. R. China, 3Bioinformatics Group, Department of Computer Science, 4Interdisciplinary Center for Bioinformatics, University of Leipzig, Härtelstrasse 16-18, D-04107 Leipzig, 5Max Planck Institute for Mathematics in the Sciences, Inselstrasse 22, 6RNomics Group, Fraunhofer Institut for Cell Therapy and Immunology, Perlickstraße 1, D-04103 Leipzig, Germany, 7Institute for Theoretical Chemistry, University of Vienna, Währingerstrasse 17, A-1090 Vienna, Austria and 8The Santa Fe Institute, 1399 Hyde Park Rd., Santa Fe, NM, USA Received on September 9, 2009  revised on November 4, 2009  accepted on November 5, 2009 Advance Access publication November 13, 2009 Associate Editor: Ivo Hofacker  ABSTRACT Motivation: It has been proven that the accessibility of the target sites has a critical inﬂuence on RNA RNA binding, in general and the speciﬁcity and efﬁciency of miRNAs and siRNAs, in particular.
Recently, O(N6) time and O(N4) space dynamic programming (DP) algorithms have become available that compute the partition function of RNA RNA interaction complexes, thereby providing detailed insights into their thermodynamic properties.
Results: Modiﬁcations to the grammars underlying earlier approaches enables the calculation of interaction probabilities for any given interval on the target RNA.
The computation of the  hybrid probabilities  is complemented by a stochastic sampling algorithm that produces a Boltzmann weighted ensemble of RNA RNA interaction structures.
The sampling of k structures requires only negligible additional memory resources and runs in O(k N3).
Availability: The algorithms described here are implemented in C as part of the rip package.
The source code of rip2 can be downloaded from http://www.combinatorics.cn/cbpc/rip.html and http://www.bioinf.uni-leipzig.de/Software/rip.html.
Contact: duck@santafe.edu Supplementary information: Supplementary data are available at Bioinformatics online.
1 INTRODUCTION RNA RNA binding is a major mode of action of various classes of non-coding RNAs and plays a crucial role in many regulatory processes in all living organisms.
Examples include the regulation of translation in both prokaryotes (Narberhaus and Vogel, 2007) and eukaryotes (Banerjee and Slack, 2002  McManus and Sharp, 2002), the targeting of chemical modiﬁcations (Bachellerie et al., 2002), insertion editing (Benne, 1992) and transcriptional control (Kugel and Goodrich, 2007).
Emerging evidence suggests, furthermore, that RNA RNA interactions also play a role for     To whom correspondence should be addressed.
the functionality of long mRNA-like ncRNAs (Hekimoglu and Ringrose, 2009).
A common theme in many RNA classes, including miRNAs, snRNAs, gRNAs, snoRNAs and in particular many of the procaryotic small RNAs, is the formation of RNA RNA interaction structures that are much more complex than simple complementary sense antisense interactions.
Thermodynamically, the binding of two RNA molecules A and B can be described by the binding energy  Gbind= GAB GA GB, i.e.
by the difference of the energy of structure formation GAB of the AB complex and the folding energies GA and GB of the two individual RNAs A and B.
Thus, the binding or hybridization energy has been widely used as a criterion to predict RNA RNA interactions (Busch et al., 2008  Rehmsmeier et al., 2004  Tjaden et al., 2006).
The interaction between two RNAs is governed by the same physical principles that determine RNA folding: the formation of speciﬁc base pairing patterns whose energy is largely determined by base pair stacking and loop strains.
Secondary structures, therefore, are an appropriate level of description to quantitatively understand the thermodynamics of RNA RNA binding.
Just as the general RNA folding problem with unrestricted pseudoknots (Akutsu, 2000), the RNA RNA interaction problem (RIP) is Non-Polynomial (NP)-complete in its most general form (Alkan et al., 2006  Mneimneh, 2009).
Polynomial-time algorithms can be derived, however, by restricting the space of allowed conﬁgurations in ways that are similar to pseudoknot folding algorithms (Rivas and Eddy, 1999).
The simplest approach concatenates two (or more) interacting sequences and then employs the standard secondary structure folding algorithm with a slightly modiﬁed energy model that treats loops containing cut-points as external elements.
The software tools RNAcofold (Bernhart et al., 2006  Hofacker et al., 1994), pairfold (Andronescu et al., 2005) and NUPACK (Dirks et al., 2007) subscribe to this strategy.
The main problem of this approach is that important motifs such as kissing-hairpin loops.
The paradigm of concatenation has also been generalized to the pseudoknot folding algorithm of Rivas and Eddy (1999).
The resulting model, however, still does not generate all relevant interaction structures (Chitsaz et al., 2009b  Qin and Reidys, 2007).
An alternative line of thought,  it cannot predict    The Author(s) 2009.
Published by Oxford University Press.
This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/ by-nc/2.5) which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.
[10:28 7/1/2010 Bioinformatics-btp635.tex]  Page: 175 175 181   F.W.D.Huang et al.
A  C  B  Fig.
1.
Examples of RNA-RNA interactions structures.
The primary interaction region(s) are highlighted in grey in the experimentally supported structural models from the literature: (A) ompA-MicA: (Udekwu et al., 2005)  (B) sodB-RyhB: (Geissmann and Touati, 2004)  (C) fhlA-OxyS: (Argaman and Altuvia, 2000).
Hybridization probabilities computed by rip2 are annotated by black boxes for regions with a probability larger than 10%.
In many cases, the computational predictions identify additional hybridization regions that may further stabilize the interaction.
interactions to a single interval  implemented in RNAduplex and RNAhybrid (Rehmsmeier et al., 2004), is to neglect all internal base pairings in either strand, i.e.
to compute the minimum free energy (MFE) secondary structure of hybridization of otherwise unstructured RNAs.
RNAup (Mückstein et al., 2006, 2008) and intaRNA (Busch et al., 2008) restrict that remains unpaired in the secondary structure for each partner.
As a special case, snoRNA/target complexes are treated more efﬁciently using a specialized tool (Tafer et al., 2009) due to the highly conserved interaction motif.
Algorithmically, the approaches mentioned so far are close relatives of the RNA folding recursions given by Zuker and Sankoff (1984).
A different approach was taken independently by Pervouchine (2004) and Alkan et al.
(2006), who proposed MFE folding algorithms for predicting the joint structure of two interacting RNA molecules.
In this model,  joint structure  means that the intramolecular structures of each partner is pseudoknot free, the intermolecular binding pairs are non-crossing and there is no so- called  zig-zag  conﬁguration (see below for details).
The optimal joint structure can be computed in O(N6) time and O(N4) space by means of dynamic programming (DP).
More recently, extensions to the partition function were proposed by Chitsaz et al.
(2009b) (piRNA) and Huang et al.
(2009) (rip1).
In contrast with the RNA folding problem, where minimum energy folding and partition functions can be obtained by very similar algorithms, this is much more complicated for joint structures.
The reason is that simple unambiguous grammars are known for RNA secondary structures (Dowell and Eddy, 2004), while the disambiguation of grammar underlying the Alkan Pervouchine algorithm requires the introduction of a large number of additional non-terminals (which algorithmically translate into additional DP tables).
Although the partition function of joint structures can be computed in O(N6) time and O(N4) space, the current implementations require very large computational resources.
Salari et al.
(2009) recently achieved a substantial speed-up making use of the observation that the external interactions mostly occur between pairs of unpaired regions of single structures.
Chitsaz et al.
(2009a), on the other hand, use tree- structured Markov random ﬁelds to approximate the joint probability distribution of multiple ( 3) contact regions.
176  The binding energies provides a useful overall characterization of an RNA RNA interaction.
In many cases, however, the locations of the intermolecular base pairs and the detailed structure of the interaction complex is of crucial importance.
Bacterial sRNAs, for example, may either up- or down-regulate mRNA translation depending on the structural changes induced by the interaction (Urban and Vogel, 2007).
In particular, in RNA RNA complexes with multiple interaction sites, i.e.
in the class of structures for which the expensive computation of joint structures is necessary, one is interested in the probabilities of hybridization in individual regions and in the interdependencies of alternative conformations, see Fig.
1.
The probabilities of the individual building blocks of the DP recursions of Huang et al.
(2009), furthermore, do not lend themselves to direct biophysical interpretations (see Supplementary Material).
We therefore extend our previous framework in two directions: (i) A modiﬁcation of the underlying grammar explicitly treats hybrids, i.e.
maximal regions with exclusively intermolecular interactions.
This allows us to investigate local aspects in much more detail.
(ii) A stochastic bracktracing algorithm, in analogy to similar approaches for RNA secondary structure prediction (Ding and Lawrence, 2003  Tacker et al., 1996), which can be used to produce representative structure and to generate samples from the thermodynamic properties.
These samples can be useful to assess complex structural features for which it would be too tedious or expensive to design and implement dedicated exact backtracing algorithms.
Given two RNA sequences R=(Ri)N  2 THE HYBRID-PARTITION FUNCTION 2.1 Some basic facts We brieﬂy review some basic concepts and outline the notation introduced in Huang et al.
(2009).
Full details are given in the Supplementary Material.
1 (e.g.
an antisense RNA and its target or an mRNA and its sRNA regulator) with N and M vertices, (cid:3) we label the vertices such that R1 is the 5 end of R and S1 denotes the 3 end of S. The arcs of R and S then represent the respective, intramolecular base pairs.
An arc is called exterior if it is of the form RiSj and interior, otherwise.
1 and S=(Sj)M  (cid:3)  [10:28 7/1/2010 Bioinformatics-btp635.tex]  Page: 176 175 181   A  B  Target prediction and Boltzmann sampling for RIP  Procedure (a) 1  N  1  M  R S  or  R S  R S  R S  or  or  or  or  or  or  or  Fig.
2.
(A) A zigzag, generated by R2S1, R3S3 and R5S4.
(B) We partition the joint structure J1,24 1,23 in segments and tight structures.
Procedure (b)  A  B  C  D  R  R  S  R  R  S  or  or  or  R  R  R  S  R  S  Fig.
3.
The four basic types of TS.
(A)  :  RiSh = Ji,j h,(cid:2) and i= j, h= (cid:2)  (B) (cid:5): RiRj   Ji,j h,(cid:2) and ShS(cid:2)(cid:7)  Ji,j h,(cid:2)  (C) (cid:1):  RiRj,ShS(cid:2)   Ji,j h,(cid:2)  (D) (cid:8): ShS(cid:2)  Ji,j h,(cid:2) and RiRj (cid:7)  Ji,j h,(cid:2).
Next, we formally deﬁne joint structures (Alkan et al., 2006  Chitsaz et al., 2009b  Huang et al., 2009  Pervouchine, 2004).
A joint structure, J(R,S,I), see Fig.
2B, is a graph such that  (1) R, S are secondary structures (each nucleotide being paired with at most one other nucleotide via hydrogen bonds, without internal pseudoknots)   (2) I is a set of exterior arcs without external pseudoknots, i.e.
if Ri1 Sj1 ,    I then i1   i2 implies j1   j2   Ri2 Sj2  (3) J(R,S,I) contains no  zig-zags , see Fig.
2A   where a zig-zag is deﬁned as follows: suppose there is an exterior arc RaSb (cid:3) (cid:3)   b   j with RiRj and Si(cid:3) Sj(cid:3) , where i   a   j and i .
Then RiRj is subsumed in Si(cid:3) Sj(cid:3) , if for any RkSk(cid:3)   I, i   k   j implies i (cid:3)   k .
A zigzag, is a subgraph containing two dependent interior arcs Ri1 Rj1 and Si2 Sj2 neither one subsuming the other (Fig.
2).
Dependence here means that there exists at least one exterior arc RhS(cid:2) such that i1   h   j1 and i2   (cid:2)   j2.
(cid:3)   j  (cid:3)  The (induced) subgraph of G induced by V has vertex set V and contains all G-edges having both incident vertices in V. The subgraph of a joint structure J(R,S,I) induced by a pair of subsequences (Ri,Ri+1,...,Rj) and (Sh,Sh+1,...,S(cid:2)) is denoted by Ji,j h,(cid:2).
In particular, J(R,S,I)= J1,N 1,M and Ji,j h,(cid:2)  Ja,b c,d if and only if Ji,j h,(cid:2) is a subgraph of Ja,b c,d induced by (Ri,...,Rj) and (Sh,...,S(cid:2)).
In particular, we use S[i,j] to denote the subgraph of the pre-structure G(R,S,I) induced by (Si,Si+1,...,Sj), where S[i,i]= Si and S[i,i 1]=  .
Given a joint structure, Ja,b c,d, a tight structure (TS), Ji,j h,(cid:2), (Huang et al., 2009) is a speciﬁc subgraph of Ja,b c,d.
A TS contains a rightmost exterior arc whose Ja,b c,d-ancestors (see Supplementary Material for more details) with maximal length give rise to one of the four types of joint structures illustrated in Fig.
3.
Intuitively, a TS is obtained as follows: given an exterior arc, α, consider its ancestors of maximal length.
If there is none, then TS equals α.
If there is (at least) one, β, then the TS is determined by the maximal ancestor of the leftmost exterior arc descending from β or its endpoint if there is none.
i,j h,(cid:2).
If its type is known, then T In the following, a TS is denoted by JT can be replaced by its type   ,(cid:5),(cid:1),(cid:8) , see Fig.
3.
For instance, we use (cid:1) i,j h,(cid:2) to denote a TS of type (cid:1).
J  2.2 The hybrid grammar A hybrid structure, JHy i1,i(cid:2) j1,j(cid:2) , is a maximal sequence of intermolecular ,...,Ri(cid:2) Sj(cid:2) ) where Rih Sjh is interior loops consisting of exterior arcs (Ri1 Sj1 nested within Rih+1 Sjh+1 and where the internal segments R[ih+1,ih+1 1] and S[jh+1,jh+1 1] consist of single-stranded nucleotides only.
That is,  R  A  S  B  1  1  N  M  C  D  E  F  G  H  J  K  L  M  Fig.
4.
Illustration of the reduction of arbitrary joint structures and of right- tight structures, Procedure (a), and of tight structures, Procedure (b).
In the bottom row the symbols for the 10 distinct types of structural components are listed: A, B maximal secondary structure segments R[i,j], S[r,s]  C arbitrary joint structure J1,N 1,M   D right-tight structures JRT i,j r,s  E double- i,j r,s  F tight structure of type (cid:5), (cid:8) or (cid:1)  G type (cid:1) tight tight structure JDT (cid:5) i,j r,s  J type (cid:8) tight structure structure J (cid:8) i,j r,s  K hybrid structure JHy i,j h,(cid:2) such that J RiSj and RhS(cid:2) are exterior arcs and Jh i,j h,(cid:2) itself is not a hybrid since it is not maximal  M isolated segment R[i,j] or S[h,(cid:2)].
i,j r,s  H type (cid:5) tight structure J (cid:1)  i,j h,(cid:2)  L substructure of a hybrid Jh  a hybrid is the maximal unbranched stem loop formed by external arcs.
Each hybrid thus forms a distinctive region of interaction between the two RNAs.
Note that we can interpret interactions admitted by intaRNA/RNAup (Busch et al., 2008  Mückstein et al., 2008) as joint structures with at most one hybrid.
In the following, we redesign the grammar outlined by Huang et al.
(2009) so that it explicitly makes use of hybrids.
An efﬁcient solution of the partition function problem for RIP requires an unambiguous context-free grammar with the constraint that the number of break points, i.e.
the number of non-terminals in each individual production, is as small as possible.
This is achieved by introducing several speciﬁc types of joint structures that are described in detail in the following.
We call a joint right-tight structure i,j r,s in Ji1,j1 r1,s1 , if its rightmost block is a Ji1,j1 r1,s1 -TS and double- (RTS), JRT i,j r,s in Ji1,j1 r1,s1 , if both of its leftmost and rightmost tight structure (DTS), JDT blocks are Ji1,j1 r1,s1 -TS s. We remark that this deﬁnition is a bit different from the notion of the DTS deﬁned in Huang et al.
(2009).
In particular, we consider single interaction arcs as particular DTS.
Adopting the point of view of Algebraic Dynamic Programming (Giegerich and Meyer, 2002), we regard each decomposition rule as a production in a suitable grammar.
Fig.
4 summarizes the three basic steps of the hybrid grammar: (I)  interior arc-removal  to reduce TS.
The scheme is complemented by the usual loop decomposition of secondary structures, and (II)  block-decomposition  to split a joint structure into two smaller blocks.
The grammar in Fig.
4 corresponds to the decomposition (parsing) of a joint structure into interior arcs and hybrids.
Fig.
5A shows the corresponding parse tree.
The full details of the decomposition procedures are described in Section 2 of the Supplementary Material, where we show that for each joint structure J1,N 1,M , we indeed obtain a unique decomposition tree (parse tree), denoted by TJ1,N 1,M .
More precisely, TJ1,N 1,M has root J1,N 1,M and all other vertices correspond to a speciﬁc substructure of J1,N 1,M obtained by the successive application of the decomposition steps of Fig.
4 and the loop decomposition of the secondary structures.
Thus, the hybrid grammar  177  [10:28 7/1/2010 Bioinformatics-btp635.tex]  Page: 177 175 181   F.W.D.Huang et al.
A  B  Fig.
5.
Different grammars lead to different (parse) trees.
We show the parse tree TJ1,11 1,11 for the same joint structure J1,11 1,11 according to the grammars of rip2 (A) and rip1 (B), respectively.
A  B  Fig.
6.
Decomposition of JDT ,KKB  i,j h,(cid:2)  (l.h.s.)
and JRT ,KKA  i,j h,(cid:2)  (r.hs.).
(II) Block decomposition: the second type of decomposition is the splitting of joint structures into  blocks .
Here, the hybrid grammar differs from the grammar of Huang et al.
(2009) in two ways.
First, we use the hybrid as a new block of the grammar, decomposing a hybrid by removing its exterior arcs in parallel simultaneously starting from the right.
Second, we split a joint structure into blocks via alternating decompositions of RTS and DTS as shown in the Procedure (a) of Fig.
4.  is unambiguous.
The two panels of Fig.
5 contrast the grammars of rip1 (Huang et al., 2009) and the hybrid grammar of rip2 introduced here.
In rip1, hybrids were immediately decomposed into individual external base pairs and their associated interior loops, so that individual hybrids were not tractable in a straightforward manner.
The set of base pairs on R[i,j] consists of all  Let us now have a closer look at the energy evaluation of Ji,j h,(cid:2).
Each decomposition step in Fig.
4 results in substructures whose energies are assumed to contribute additively and generalized loops that can be evaluated directly.
There are the following two basic scenarios: (I) Interior Arc removal: the ﬁrst type of decomposition is derived from the decomposition of TS of Huang et al.
(2009).
Most of the decomposition operations in Procedure (b) displayed in Fig.
4 can be viewed as the  removal  of an arc (corresponding to the closing pair of a loop in secondary structure folding) followed by decomposition.
Both, loop type as well as the subsequent decomposition steps depend on the newly exposed structural elements.
Following the approach of Zuker and Sankoff (1984) for secondary structures, we treat the loop-decomposition problem by introducing additional matrices.
Without loss of generality, we can assume that we open an interior base pair RiRj.
interior pairs RpRq with i  p   q  j and all exterior pairs RpSh with i  p  j.
An interior arc is exposed on R[i+1,j 1] is not enclosed by any interior arc in R[i,j].
An exterior arc is exposed on R[i+1, j 1] if and only if it is not a descendant of any interior arc in R[i+1,j 1].
Given RiRj, the arcs exposed on R[i+1,j 1] correspond to the base pairs immediately interior of RiRj.
Let us write ER[i,j]= Ei R[i,j] for this set of  exposed base pairs  and its subsets of interior and exterior arcs.
As in secondary structure folding, the loop type is determined by ER[i,j]:= ER as follows: ER=  , hairpin loop  ER= Ei R and  ER =1, interior loop (including bulge and stacks)  ER= Ei R,  ER  2, multi-branch loop  ER= Ee R, kissing-hairpin loop   Ei This picture needs to be reﬁned even further since the arc removal is coupled with further decomposition of the interval R[i+1,j 1].
This prompts us to distinguish TS and DTS with different classes of exposed base pairs on one or both strands.
It will be convenient, furthermore, to include information on the type of loop in which it was found.
(cid:5) i,j h,(cid:2) is of type E, if S[h,(cid:2)] is not enclosed in any base pair (cid:5) i,j h,(cid:2) is located immediately interior to the closing pair (cid:5) i,j h,(cid:2) (cid:5),M i,j h,(cid:2)).
If SpSq is contained in a kissing loop, we distinguish  (J SpSq (p   h   (cid:2)   q).
If the loop closed by SpSq is a multi-loop, then J is of type M (J the types F and K, depending on whether or not Ee    1, general kissing loop.
A TS J (cid:5),E i,j h,(cid:2)).
Suppose J  R[i,j]   Ee  if and only if   , Ee  S[h,(cid:2)]=  .
it  R  R  four  types of a hybrid JHy  i,j h,(cid:2),  Analogously,  i.e.
JHy,EE i,j h,(cid:2)  there are in total  .
,JHy,KK i,j h,(cid:2)  ,JHy,KE i,j h,(cid:2)  ,JHy,EK i,j h,(cid:2)  i,j h,(cid:2) , JRT ,EK  i,j h,(cid:2) or JDT ,EE i,j h,(cid:2)  i,j h,(cid:2) and JRT ,EE  In order to guarantee the maximality hybrids, we observe that the RTS s JRT ,KK i,j h,(cid:2) , JRT ,KE i,j h,(cid:2) can appear in two scenarios, depending on whether or not there exists an exterior arc Ri1 Sh1 such that R[i,i1 1] and S[h,h1 1] are isolated segments.
In case such an exterior arc exists, we say the RTS is of type (B) or (A), otherwise.
Similarly, a DTS, JDT ,KK i,j h,(cid:2) , JDT ,KE i,j h,(cid:2) , JDT ,EK is of type (B) or (A) depending on whether RiSh is an exterior arc.
In Fig.
6A, we display the decomposition of JDT ,KKB into hybrids and RTS of type (A) and in Fig.
6B, we display the decomposition of JRT ,KKA  i,j h,(cid:2) into secondary structure segments and DTS accordingly.
i,j r,(cid:2) is a DTS contained in a kissing loop, that is, we have Suppose JDT S[h,(cid:2)](cid:7)=  .
Without loss of generality, we may assume either Ee R[i,j](cid:7)=  .
Then, at least one of the two  blocks  contains at least an exterior Ee arc belonging to Ee  R[i,j] labeled by K or F, otherwise, see Fig.
6A.
R[i,j](cid:7)=   or Ee  i,j h,(cid:2)  2.3 Forward recursions The computation of the partition function proceeds  from the inside to the outside , see Equation (3).
The recursions are initialized with the energies of individual external base pairs and empty secondary structures on subsequences of length up to 4.
In order to differentiate multi- and kissing- loop contributions, we introduce the partition functions Qm i,j.
Here, i,j denotes the partition function of secondary structures on R[i,j] or S[i,j] Qm having at least one arc contained in a multi-loop.
Similarly, Qk i,j denotes the partition function of secondary structures on R[i,j] or S[i,j] in which at least one arc is contained in a kissing loop.
Let J be the set of substructures Ji,j h,(cid:2)  J1,N 1,M , induced from some joint structure J1,N 1,M , such that Ji,j h,(cid:2) appears in TJ1,N 1,M as an interaction structure of type ξ  DT ,RT ,(cid:5),(cid:8),(cid:1),   with loop-subtypes Y1,Y2  M,K,F  on the subintervals R[i,j] and S[h,(cid:2)], Y3  A,B .
Let Qξ,Y1Y2Y3 i,j h,(cid:2) denote the partition function of the set J .
All recursions for Qξ,Y1Y2Y3 i,j h,(cid:2) represent a reformulation of the hybrid grammar speciﬁed in Fig.
4.  i,j and Qk  ξ,Y1Y2Y3 i,j h,(cid:2)  ξ,Y1Y2Y3 i,j h,(cid:2)  For instance, the recursion for QDT ,KKB  i,j h,(cid:2)  displayed in Fig.
6A is given by:  =(cid:1)  QDT ,KKB i,j h,(cid:2)  i1,h1  QHy,KK i,i1 h,h1  QRT ,KKA i1+1,j h1+1,(cid:2)  +QHy,KK i,i1 h,h1  QRT ,KF i1+1,j h1+1,(cid:2)  +QHy,KK i,i1 h,h1  QRT ,FF i1+1,j h1+1,(cid:2)  +QHy,KK i,i1 h,h1  QRT ,FK i1+1,j h1+1,(cid:2)  +QHy,KK i,j h,(cid:2)  ,  where the corresponding recursion for QHy,KK  i,j h,(cid:2) is  QHy,KK i,j h,(cid:2)  = (cid:1)  i1,h1  QHy,KK i,i1 h,h1  e   (σ0+σGInt  i1 ,h1 ,j,(cid:2)  +(j+(cid:2) i1 h1 2)β3).
(1)  (2)  178  [10:28 7/1/2010 Bioinformatics-btp635.tex]  Page: 178 175 181   Analogously, the recursions for QHy,EE i,j h,(cid:2)  (σ0+σGInt  i,j h,(cid:2) and QHy,KE ,QHy,EK i1 ,h1 ,j,(cid:2))   i,j h,(cid:2) read:  QHy,EE i,i1 h,h1  e  QHy,EE i,j h,(cid:2)  QHy,EK i,j h,(cid:2)  QHy,KE i,j h,(cid:2)  i1,h1  = (cid:1) = (cid:1) = (cid:1)  i1,h1  i1,h1   (σ0+σGInt  i1 ,h1 ,j,(cid:2)  +((cid:2) h1 1)β3)   (3)   (σ0+σGInt  i1 ,h1 ,j,(cid:2)  +(j i1 1)β3).
QHy,EK i,i1 h,h1  e  QHy,KE i,i1 h,h1  e  2.4 Hybrid probabilities Since the probabilities of individual base pairs are not independent, it is not possible to compute the probabilities for particular hybrids directly from them.
Hybrid probabilities thus cannot be obtained in a simple way from the backward recursions described by Huang et al.
(2009).
Given two RNA sequences, our notion of probability is based on the ensemble of all possible joint interaction structures.
Let QI denote the partition function of all these joint structures that can formed by two input RNA sequences.
The probability of a ﬁxed joint structure J1,N 1,M is given by  PJ1,N 1,M  = QJ1,N 1,M  QI  .
(4)  In difference to the computation of the hybrid-partition function  from the inside to the outside  (IO), the computation of probabilities of speciﬁc substructures is obtained  from the outside to the inside .
The same principle applies to the computation of base pairing computation of base pairing probabilities of secondary structures (McCaskill, 1990) and joint structures (Huang et al., 2009).
Let J = J1,N 1,M , with associated decomposition tree T(J) and let  Ji,j h,(cid:2) =  J   Ji,j h,(cid:2)  T(J)  denote the set of all joint structures J such that Ji,j h,(cid:2) is contained in the decomposition tree T(J).
Then we have, by construction,  PJi,j h,(cid:2)  PJ .
(5)  = (cid:1) J  i,j h,(cid:2)  Following the (OI)-paradigm, the probability of a parent structure, Pθs , is computed prior to the calculation of PJi,j h,(cid:2) .
The conditional probability PJi,j h,(cid:2) θs equals Qθs (Ji,j h,(cid:2))/Q(θs), where Q(θs) is the partition function of θs, and Qθs (Ji,j h,(cid:2)) the partition function of all those θs, that have in addition Ji,j h,(cid:2) as a child in their parse trees.
Consequently, PJi,j h,(cid:2) can inductively be computed by summing over all probabilities Pθs , i.e.
=(cid:1)  =(cid:1)  (cid:2)  PJi,j h,(cid:2)  PJi,j h,(cid:2) θs  Pθs  Qθs (Ji,j h,(cid:2))/Q(θs)  .
Pθs  (6)  (cid:3)  θs  θs  Let PHy  i,j h,(cid:2) denote the probability of the set of substructures J such that i,j h,(cid:2), appears in the decomposition tree i,j h,(cid:2) is either one of the  the speciﬁc hybrid substructure, JHy T(J), i.e.
JHy i,j h,(cid:2) four types JHy,EE i,j h,(cid:2)    T(J).
Since each joint structure JHy ,JHy,EK i,j h,(cid:2)  i,j h,(cid:2) , we arrive at  ,JHy,KE i,j h,(cid:2) or JHy,KK = PHy,EE i,j h,(cid:2)  + PHy,EK i,j h,(cid:2)  PHy i,j h,(cid:2)  + PHy,KE i,j h,(cid:2)  + PHy,KK i,j h,(cid:2)  .
We remark that, by construction, for [h1,(cid:2)1](cid:7)=[h2,(cid:2)2],  the hybrid probabilities PHy joint structures.
This is a consequence of the maximality of hybrids, which implies that, for ﬁxed interval [i,j], each [h1,(cid:2)1] corresponds to a unique hybrid JHy i,j h1,(cid:2)1  .
Based on the notion of hybrid probability, we can introduce  quantify disjoint classes of  and PHy  i,j h2,(cid:2)2  i,j h1,(cid:2)1  (7)  [i,j] =(cid:1)  Ptarget  PHy i,j h,(cid:2)  (8) which is, according to the above, the probability of the target site [i,j] and furthermore  h,(cid:2)  ,  (cid:1)  PHy p,q h,(cid:2)  ,  (9)  πR(i)= (cid:1) p,q: p i q  h,(cid:2)  Target prediction and Boltzmann sampling for RIP  11  19  9  17  11  15  9  13  1  1  1  1  11  19  17  11  15  19  13  17  9  9  24  23  24  23  Fig.
7.
Hybrid probability: the maximality of hybrids implies that although the intervals[h1,(cid:2)1] and[h2,(cid:2)2] overlap they belong to two distinct hybrids (gray).
measuring, for each base i in R the probability that i is contained in a hybrid.
A particulary instructive observable is the interaction base pairing matrix, given by  πi,k = (cid:1) p,q: p i q  (cid:1)  r,s:r k s  PHy p,q r,s  .
(10)  Clearly, πi,k measures the probability that a pair of nucleotides (i,k), located on different strands, is contained in an interaction region.
In contrast with the base pairing probabilities, large values of πi,k do not imply that i and k actually form an exterior base pair.
Instead, it highlights regions of intermolecular interactions.
2.5 Boltzmann sampling A dynamic programming scheme for the computation of a partition function implies a corresponding stochastic backtracing procedure that can be used to sample from the associated distribution (Tacker et al., 1996).
The usefulness of this approach for RNA secondary structures is discussed by Ding and Lawrence (2003).
The same ideas can of course also produce representative samples from the Boltzmann equilibrium distribution of RNA interaction structures (Fig.
8).
The basic data structure of the algorithm is a stack A that stores tuples of the form  (i,j h,(cid:2) ξ)  describing a pair of intervals [i,j] in R and [h,(cid:2)] in S and the type ξ of the not further speciﬁed joint structure formed by the two intervals.
The stack A, initialized with (1,N 1,M, ) where     denotes the unspeciﬁed type, guides the backtracing which is complete as soon as A is empty.
A list L is used to collect the interior and exterior arcs and unpaired bases generated by the decompositions and eventually deﬁne the sampled interaction structure.
In the ﬁrst step, (1,N 1,M, ) is decomposed according to the grammar in Fig.
4 into either (i) a pair of secondary structures, or (ii) a RTS (i,N j,M RTEE) with probabilities derived as explained above.
Depending on the stochastic choice, we push either (i) (1,N 0,0 sec) and (0,0 1,M sec) or (ii) (1,i 1 0,0,sec), (0,0 1,j 1 sec) and (i,N j,M RTEE) into the stack A.
Given A and L, we can associate a probability by considering the decomposition of the particular type of joint structure.
For instance, suppose we have extracted (i,j h,(cid:2),DTKKB) from stack A, see Fig.
6.
Then, the probabilities for continuing with one of the ﬁve decompositions displayed in Fig.
6, for each position of the break points i1 [i,j] and h1 [h,(cid:2)], is given by  P0  i1,h1  P1  i1,h1  P2  i1,h1  P3  i1,h1  P4  i1,h1  = QHy,KK i,i1 h,h1 = QHy,KK i,i1 h,h1 = QHy,KK i,i1 h,h1 = QHy,KK i,i1 h,h1 = QHy,KK i,j h,(cid:2)  QRT ,KKA i1+1,j h1+1,(cid:2) QRT ,KF i1+1,j h1+1,(cid:2) QRT ,FF i1+1,j h1+1,(cid:2) QRT ,FK i1+1,j h1+1,(cid:2) i,j h,(cid:2)  /QDT ,KKB  .
/QDT ,KKB  /QDT ,KKB  i,j h,(cid:2) i,j h,(cid:2) i,j h,(cid:2) i,j h,(cid:2)  /QDT ,KKB  /QDT ,KKB  ,  ,  ,  ,  179  [10:28 7/1/2010 Bioinformatics-btp635.tex]  Page: 179 175 181   F.W.D.Huang et al.
B  A  C  Fig.
9.
Interaction of sodB RhyB.
(A) Base-pairing probability matrix.
The upper right triangle shows the probabilities obtained from the exact backwards recursion, the lower left triangle is the estimate from a sample of 10 000 structures obtained by stochastic backtracing, showing that the estimates converge quickly.
(B) Comparison of the structure proposed in Geissmann and Touati (2004) and the rip2 prediction.
While the major stable hairpins agree and rip2 correctly predicts the primary interaction region, rip2 also identiﬁes additional interaction regions that may stabilize the interaction.
(C) Sampled joint structures (here the 20 most frequent ones) are represented as dot-bracket strings: () and [] represent pairs of interior and exterior arc, respectively, while dots indicate unpaired bases.
separates the two RNA sequences which are both written in 5  (cid:3) 3  direction.
(cid:3)  Fig.
8.
Stochastic backtracing algorithm: elements of stack A are successively decomposed according to the hybrid-grammar.
The resulting arcs and unpaired vertices are stored in the list L which, once A is empty, eventually contains the Boltzmann-sampled interaction structure.
A  5     o o m m p p A A  B  5     S o d B  3     5   5  5  3  4  2  1  One of these decompositions is accordingly sampled and the respective output is pushed back into stack A.
For instance, if P1 is selected, then we push (i,i1 h,h1 HyKK) and (i1+1,j h1+1,(cid:2) RTKF) back into stack A.  i1,h1  3     5   micA  3   2  3  1  4  RhyB   3  C  1 2 3 4 5  1 2 3 4 5  1 2 3 4 5  - -  - -  - -  - -  ompA-micA  1 2 3 4 5 - - - -  -  -  - -  SodB-RhyB  3 RESULTS AND CONCLUSIONS We presented here a modiﬁed and improved unambiguous grammar for the RIP.
Compared with rip1 (Huang et al., 2009), it reduces the computational efforts, in particular the memory consumption, by about a third.
In the Supplementary Material, we contrast rip2 with rip1 and show that hybrids (as opposed to TS, RTS or DTS) are uniquely suited for identifying the interaction regions of two RNA molecules.
The complete set of recursions is compiled in Section 3 (cid:8),(cid:5),(cid:1) i,j r,s of the Supplementary Material.
It comprises 9 4D-arrays Q i,j r,s for RTS and 20 4D- for TS of various types, 20 4D-arrays QRT i,j r,s for DTS.
The implementation has been complemented arrays QDT by a stochastic backtracing facility.
Fig.
9 gives an example of the output produced by rip2 (see also Supplementary Material, Fig.
4).
Despite algorithmic improvements, rip2 still requires quite substantial computational resources for practical applications.
rip2  is in practise limited to problem sizes of N1+N2 (cid:1)250 on current  hardware.
While rip2 is still not an efﬁcient tool for large-scale routine applications, it is suitable for investigating the ﬁne details  (cid:3)  (cid:3)  end of ompA and the 5  Fig.
10.
Interaction maps.
The ompA MicA interaction (A) has a dominating terminus interaction region that brings together the 3 of MicA.
The sodB RhyB interactions (B) has two clear hybridization regions in the middle of the molecules and a diffuse contact area at the 3 end of sodB.
The grayscale show the probabilities πik.
Tick marks indicate every 10th nucleotide.
The correlations between the major binding regions can be computed easily from Boltzmann samples.
The heatmaps show the correlation coefﬁcients for the most probable interaction regions (indicated by numbers in the interaction maps).
(C) For sodB RhyB, we observe fairly weak correlations, except for the cooperative interaction between contacts 3 and 4.
In case of ompA MicA, we observe strong negative correlations between conﬂicting hybridization regions.
(cid:3)  of particular interactions.
Future work will thus focus on controlled approximations with the aim of a drastic reduction of both: CPU and memory consumption.
The major advantage of stochastic sampling is that it provides a generic and convenient means to estimate quantities that cannot be easily computed directly by backwards recursion (Ding and Lawrence, 2003).
Both, the ompA-MicA and sodB-RhyB complexes show a primary, highly likely, hybrid region and several additional less stable points of contact, see Fig.
10.
In these examples, it  180  [10:28 7/1/2010 Bioinformatics-btp635.tex]  Page: 180 175 181   is of interest to investigate in detail how the putative interaction regions inﬂuence each other: is the binding cooperative so that the major hybrids in Fig.
10 are positively correlated, or do they constitute mutually exclusive contacts  Once a sufﬁciently large Boltzmann sample is obtained, we can easily compute, e.g.
correlations ρPQ between indicator variables P and Q that measure the existence of external base pairs in two different hybrids.
Fig.
10C provide examples, showing that there are strong correlations between hybridization regions.
These multiple contacts can contribute substantially to the total interaction energy.
ACKNOWLEDGEMENTS We want to thank Sven Findeiß for discussions.
We are grateful to Sharon Selzo of the Modular and BICoC Benchmark Center, IBM and Kathy Tzeng of IBM Life Sciences Solutions Enablement.
Their great support was vital for all computations presented here.
Funding: 973 Project of the Ministry of Science and Technology  PCSIRT Project of the Ministry of Education  National Science Foundation of China (to C.M.R.
and his lab)  Deutsche Forschungsgemeinschaft under the auspices of SPP-1258  Small Regulatory RNAs in Prokaryotes  (grant No.
STA 850/7-1to P.F.S.
and his lab)  European Community FP-6 project SYNLET (Contract Number 043312 to P.F.S.
and his lab).
Conﬂict of Interest: none declared.
REFERENCES Akutsu,T.
(2000) Dynamic programming algorithms for RNA secondary structure  prediction with pseudoknots.
Disc.
Appl.
Math., 104, 45 62.
Alkan,C.
et al.
(2006) RNA-RNA interaction prediction and antisense RNA target  Target prediction and Boltzmann sampling for RIP  Ding,Y.
and Lawrence,C.E.
(2003) A statistical sampling algorithm for RNA secondary  structure prediction.
Nucleic Acid Res., 31, 7280 7301.
Dirks,R.
et al.
(2007) Thermodynamic analysis of interacting nucleic acid strands.
SIAM  Rev., 49, 65 88.
Dowell,R.D.
and Eddy,S.R.
(2004) Evaluation of several lightweight stochastic context- free grammars for RNA secondary structure prediction.
BMC Bioinformatics, 5, 7.
Geissmann,T.
and Touati,D.
(2004) Hfq, a new chaperoning role: binding to messenger  RNA determines access for small RNA regulator.
EMBO J., 23, 396 405.
Giegerich,R.
and Meyer,C.
(2002) Algebraic Dynamic Programming.
In Vol.
2422 of  Lecture Notes in Computer Science.
Springer, London, pp.
349 364 .
Hekimoglu,B.
and Ringrose,L.
(2009) Non-coding RNAs in polycomb/trithorax  regulation.
RNA Biol., 6, 129 137.
Hofacker,I.L.
et al.
(1994) Fast folding and comparison of RNA secondary structures.
Monatsh.
Chem., 125, 167 188.
Huang,F.W.D.
et al.
(2009) Partition function and base pairing probabilities for RNA-  RNA interaction prediction.
Bioinformatics, 25, 2646 2654.
Kugel,J.
and Goodrich,J.
(2007) An RNA transcriptional regulator templates its own  regulatory RNA.
Nat.
Struct.
Mol.
Biol., 3, 89 90.
McCaskill,J.S.
(1990) The equilibrium partition function and base pair binding  probabilities for RNA secondary structure.
Biopolymers, 29, 1105 1119.
McManus,M.T.
and Sharp,P.A.
(2002) Gene silencing in mammals by small interfering  RNAs.
Nat.
Rev., 3, 737 747.
Mneimneh,S.
(2009) On the approximation of optimal structures for RNA-RNA  interaction.
IEEE/ACM Trans.
Comp.
Biol.
Bioinform., 6, 682 688.
Mückstein,U.
et al.
(2006) Thermodynamics of RNA-RNA binding.
Bioinformatics,  22, 1177 1182.
Mückstein,U.
et al.
(2008) Translational control by RNA-RNA interaction: improved computation of RNA-RNA binding thermodynamics.
In Elloumi,M.
et al.
(eds) Bioinformatics Research and Development   BIRD 2008, Vol.
13 of Information Science.
Springer, Berlin, Communication in Computer and pp.
114 127.
Narberhaus,F.
and Vogel,J.
(2007) Sensory and regulatory RNAs in prokaryotes: A new  german research focus.
RNA Biol., 4, 160 164.
Pervouchine,D.
(2004) IRIS: intermolecular RNA interaction search.
Proc.
Genome  Inform., 15, 92 101.
Qin,J.
and Reidys,C.M.
(2007)  tertiary http://arxiv.org/PS_cache/arxiv/pdf/0710/0710.3523v3.pdf.
interaction.
Technical Report  A combinatorial 0710.3523,  framework arXiv.
Available  for RNA at  search.
J. Comput.
Biol., 13, 267 282.
Rehmsmeier,M.
et al.
(2004) Fast and effective prediction of microRNA/target duplexes.
Andronescu,M.
et al.
(2005) Secondary structure prediction of interacting RNA  Gene, 10, 1507 1517.  molecules.
J. Mol.
Biol., 345, 1101 1112.
Argaman,L.
and Altuvia,S.
(2000) fhlA repression by OxyS RNA: kissing complex formation at two sites results in a stable antisense-target RNA complex.
J. Mol.
Biol., 300, 1101 1112.
Bachellerie,J.
et al.
(2002) The expanding snoRNA world.
Biochimie, 84, 775 790.
Banerjee,D.
and Slack,F.
(2002) Control of developmental timing by small temporal RNAs: a paradigm for RNA-mediated regulation of gene expression.
Bioessays, 24, 119 129.
Benne,R.
(1992) RNA editing in trypanosomes.
the use of guide RNAs.
Mol.
Biol.
Rep.,  16, 217 227.
Rivas,E.
and Eddy,S.R.
(1999) A dynamic programming algorithms for RNA structure  prediction including pseudoknots.
J. Mol.
Biol., 285, 2053 2068.
Salari,R.
et al.
(2009) Fast prediction of RNA-RNA interaction.
In Proceedings of the 9th Workshop on Algorithms in Bioinformatics (WABI), Vol.
5724 of Lecture Notes in Computer Science.
Springer, pp.
261 272.
Tacker,M.
et al.
(1996) Algorithm independent properties of RNA structure prediction.
Eur.
Biophy.
J., 25, 115 130.
Tafer,H.
et al.
(2009) RNAsnoop: efﬁcient target prediction for box H/ACA snoRNAs.
Bioinformatics, University of Leipzig.
Available at http://www.bioinf.uni- leipzig.de/Publications/PREPRINTS/0 9-025.pdf  Bernhart,S.
et al.
(2006) Partition function and base pairing probabilities of RNA  Tjaden,B.
et al.
(2006) Target prediction for small, noncoding RNAs in bacteria.
Nucleic  heterodimers.
Algorithms Mol.
Biol., 1, 3.
Acids Res., 34, 2791 2802.
Busch,A.
et al.
(2008) IntaRNA: efﬁcient prediction of bacterial sRNA targets incorporating target site accessibility and seed regions.
Bioinformatics, 24, 2849 2856.
Chitsaz,H.
et al.
(2009a) biRNA:  In Proceedings of the 9th Workshop on Algorithms in Bioinformatics (WABI), Vol.
5724 of Lectures Notes in Computer Science.
Springer, pp.
25 36.  fast RNA-RNA binding sites prediction.
Chitsaz,H.
et al.
(2009b) A partition function algorithm for interacting nucleic acid  strands.
Bioinformatics, 25, i365 i373.
Udekwu,K.
et al.
(2005) Hfq-dependent regulation of OmpA synthesis is mediated by  an antisense RNA.
Genes Dev., 19, 2355 2366.
Urban,J.H.
and Vogel,J.
(2007) Translational control and target recognition by  Escherichia coli small RNAs in vivo.
Nucleic Acids Res., 35, 1018 1037.
Zuker,M.
and Sankoff,D.
(1984) RNA secondary structures and their prediction.
Bull.
Math.
Biol., 46, 591 621.
181  [10:28 7/1/2010 Bioinformatics-btp635.tex]  Page: 181 175 181
