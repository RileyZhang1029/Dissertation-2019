BIOINFORMATICS ORIGINAL PAPER Vol.
27 no.
10 2011, pages 1397 1403  doi:10.1093/bioinformatics/btr145  Systems biology Mass-balanced randomization of metabolic networks Georg Basler1, , Oliver Ebenhöh2, Joachim Selbig1,3 and Zoran Nikoloski1,3,  1University of Potsdam, Institute for Biochemistry and Biology, D-14476 Potsdam, Germany, 2University of Aberdeen, Institute of Medical Sciences, AB25 2ZD Aberdeen, UK and 3Max Planck Institute for Molecular Plant Physiology, D-14476 Potsdam, Germany Associate Editor: Jonathan Wren  Advance Access publication March 23, 2011  review the shortcomings of  ABSTRACT Motivation: Network-centered studies in systems biology attempt to integrate the topological properties of biological networks with experimental data in order to make predictions and posit hypotheses.
For any topology-based prediction, it is necessary to ﬁrst assess the signiﬁcance of the analyzed property in a biologically meaningful context.
Therefore, devising network null models, carefully tailored to the topological and biochemical constraints imposed on the network, remains an important computational problem.
Results: We ﬁrst the existing generic sampling scheme switch randomization and explain its unsuitability for application to metabolic networks.
We then devise a novel polynomial-time algorithm for randomizing metabolic networks under the (bio)chemical constraint of mass balance.
The tractability of our method follows from the concept of mass equivalence classes, deﬁned on the representation of compounds in the vector space over chemical elements.
We ﬁnally demonstrate the uniformity of the proposed method on seven genome-scale metabolic networks, and empirically validate the theoretical ﬁndings.
The proposed method allows a biologically meaningful estimation of signiﬁcance for metabolic network properties.
Contact: basler@mpimp-golm.mpg.de  nikoloski@mpimp-golm.mpg.de Supplementary Information: Supplementary data are available at Bioinformatics online.
Received on December 10, 2010  accepted on March 13, 2011  revised on March 7, 2011   1 INTRODUCTION The advances in omics technologies and algorithmic techniques for analysis of high-throughput data have placed network-based integrative studies in the focus of systems biology (Albert, 2005  Yamada and Bork, 2009).
The promise of network analyses lies in the possibility to devise genome-scale representations of biological systems for predictive analyses.
However, the statistical signiﬁcance of any prediction must be validated in a biologically meaningful context using an appropriate null model.
The seminal work of (Barabási and Albert, 1999) directed complex networks research toward revealing the unifying properties of biological networks, starting from metabolic (Jeong et al., 2000) to gene regulatory (Shen-Orr et al., 2002) to protein protein networks (Maslov and Sneppen, 2002) and their integrated variants (Yamada and Bork, 2009).
Despite the identiﬁcation of simple     To whom correspondence should be addressed.
mechanisms by which these networks may arise and evolve, such as the preferential attachment of newly added nodes (representing genes, proteins, to already highly connected ones, the advantage of such approaches to answering biological questions remains debatable.
reactions or metabolites)  Nevertheless, this direction in network research has resulted in the discovery of salient properties of biological networks, i.e.
properties which show similar trends for a wide variety of networks from different cells, tissues and species.
Some of these properties include: scale-free (i.e.
power-law) degree distribution, large clustering coefﬁcient, small average path length, degree degree correlation, different behavior of various centrality measures and the distribution and overrepresentation of subnetworks, known as motifs (Barabási and Oltvai, 2004  Milo et al., 2002).
The studies following the work of Barabási and Albert have attempted to relate the salient properties of biological networks to their functionality (Albert and Albert, 2004  Jeong et al., 2001  Ma and Zeng, 2003  Marr et al., 2007  Papin et al., 2005  Stuart et al., 2003).
However, it is often the case that the detection of novel salient properties of complex biological networks and determination of their statistical signiﬁcance is based on a generic null model, which may result in misleading conclusions and, consequently, in inappropriate biological reasoning (Artzy-Randrup et al., 2004  Bernhardsson and Minnhagen, 2010).
Network null models are essential for establishing the signiﬁcance of any prediction obtained from a network representation of a biological system.
A randomization procedure allows for sampling from the (usually large) space of networks from a null model, and for estimating the statistical signiﬁcance empirically.
A P-value of a given property is usually calculated based on the following procedure: (i) determine the chosen property from an investigated biological network, (ii) sample a large number of random networks which have a similar structure to that of the analyzed network and (iii) estimate the mean and variance of the property from the simulated networks to calculate a z-score and P-value under the assumption of normal distribution.
Without this assumption, in principle, step (iii) requires determining the distribution of values for the property under the considered network null model.
Clearly,  the P-value of a property strongly depends on the sampling procedure and structure of the network null model.
Therefore, any network-based analysis is prone to detecting statistically signiﬁcant properties due to an ill-posed null model (Artzy-Randrup et al., 2004).
Finally, a null model strongly and ultimately depends on the type of analyzed network.
For instance, gene regulatory networks include directionality, while protein protein interaction networks    The Author(s) 2011.
Published by Oxford University Press.
This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/ by-nc/2.5), which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.
[17:39 18/4/2011 Bioinformatics-btr145.tex]  Page: 1397 1397 1403   G.Basler et al.
are undirected  signal transduction and metabolic networks are directed hypergraphs (representable as bipartite graphs) (Klamt et al., 2009), whereas metabolic networks include stoichiometry and biologically meaningful node labels (representing chemical structure).
Thus, a common randomization procedure, which samples from a generic network null model, is unlikely to resolve the problem of relating the properties of different classes of networks to their biological function.
Despite these observations, many network-based studies e.g.
(Guimera et al., 2006  Maslov and Sneppen, 2002  Milo et al., 2002  Sales-Pardo et al., 2007) do rely on a common reference frame for all biological networks, called switch randomization.
According to switch randomization, a randomized network is obtained from a given network by shufﬂing its edges while ensuring that the number of (incoming and outgoing) edges of every node remains unchanged.
This can be achieved by the switch operation, whereby a randomly chosen pair of edges, (u,v) and (x,y), is replaced by two other edges, (u,y) and (x,v), provided that they do not already exist in the network.
Switch randomization ensures that the probability of two nodes being connected is effectively independent of their distance in the original network.
However, there are contradicting results with regard to whether the generated networks are sampled uniformly from the ensemble of networks with preserved degree distribution (Artzy-Randrup and Stone, 2005  Milo et al., 2003  Picard et al., 2008).
The underlying assumption of switch randomization is that the distribution of incoming and outgoing edges sufﬁciently characterizes the constraints under which networks of the analyzed type evolve.
While this assumption may be valid on, e.g.
gene regulatory networks, where the number of regulatory targets of a gene is a principle constraint, completely different constraints permeate the evolution of metabolic networks.
For illustration, consider the following two metabolic reactions: glucose isomerase (glucose   fructose) and maleate isomerase (maleate   fumarate).
After applying switch randomization, we may obtain: glucose   fumarate and maleate  fructose, which is chemically infeasible due to the violation of the preservation of mass, since the corresponding chemical equations are C6H12O6 C4H2O4 and C4H2O4  C6H12O6.
In the metabolic networks we analyzed, 99.8% of the reactions are unbalanced after applying switch randomization.
By disregarding this fundamental principle, the generated networks are able to consume and produce matter out of nothing, yielding them incomparable to metabolic networks.
Establishing the statistical signiﬁcance of a network property, mediated through a common, yet inappropriate reference frame, may result in the erroneous detection of signiﬁcant properties, leading to questionable biological hypotheses.
Therefore, the techniques for establishing suitable null models and randomization procedures need to be developed further, before making any statements about their biological importance.
Recent work of (Picard et al., 2008) on estimating the overrepresentation of motifs is a ﬁrst step toward a network null model tailored to a particular set of real-world biological networks (therein, protein protein interaction networks).
Motivated by the shortcomings of the switch randomization and the lack of a network null model for metabolic networks which includes directionality, topological salient properties and biochemical constraints (e.g.
reaction degrees and preservation of mass in biochemical reactions), here we present a method for randomizing metabolic networks.
Our randomization procedure is  1398  based on the notion of mass equivalence classes for compounds and can be used to estimate the signiﬁcance of a given topological property with respect to its importance in chemically constrained biological systems.
Moreover, we show that our procedure samples a randomized network uniformly at random, which is another important requirement for any network sampling scheme.
For the empirical validation of our results, we use the metabolic networks of seven organisms from all kingdoms of life: (i) Bacillus subtilis (Oh et al., 2007), (ii) Saccharomyces cerevisiae (Herrgård et al., 2008), (iii) Escherichia coli from iAF1260 (Feist et al., 2007) and (iv) EcoCyc (Keseler et al., 2009), (v) Chlamydomonas reinhardtii (May et al., 2008), (vi) Arabidopsis thaliana (Swarbreck et al., 2008) and (vii) Homo sapiens (Ma et al., 2007) (network properties are shown in Supplementary Table S1).
2 APPROACH A metabolic network is represented as a directed bipartite graph G=(Vc Vr ,E), where Vc is the set of compound nodes, Vr the set of reaction nodes and E (Vc Vr) (Vr Vc) is the set of directed edges denoting substrate reaction and product reaction relationships.
For a compound c  Vc, we denote by mc  Nn its mass vector, i.e.
the vector representation of c over n chemical elements.
For instance, one may consider only the six most abundant elements in biological systems (Dobson, 2004): carbon (C), hydrogen (H), nitrogen (N), oxygen (O), phosphorus (P) and sulfur (S).
The mass  vector of water is then mH2O=(0,2,0,1,0,0) (C,H,N ,O,P,S)T .
For a given reaction r, rin= c  Vc (c,r)  E  denotes the set of substrates, and rout= c  Vc (r,c)  E , the set of products.
We abbreviate the expression c  rin rout by c  r, and write d(r)=  rin + rout  for the degree of r (we omit the deﬁnition of compound degree, as it is not required for our purpose).
Reversible reactions +   are represented by one reaction node for each direction: r and r ,   + in.
Furthermore, let sc,r   N where r be the stoichiometric coefﬁcient of a substrate (product) c of reaction r. A reaction is mass balanced, i.e.
chemically feasible with respect to the conservation of mass, if and only if the sum of its substrate atoms equals the sum of its product atoms:    out and r  + out  = r  = r  + in  sc,r mc=  sk,r mk .
(1)  (cid:1) c rin  (cid:1) k rout  In order to uniformly randomize a network while preserving mass balance, each possible mass-balanced network has to be generated with equal probability.
This requires enumeration of all possible sets of substrates and products, for which Equation (1) is satisﬁed.
A special case of this problem is to ﬁnd all possible partitions of a set of integers, which sum up to 0 (which, in turn, is a special case of the Knapsack problem, see (Horowitz and Sahni, 1974).
As a consequence, the number of possible mass-balanced networks is at least exponential in the number of compounds.
We approach the complexity of the general problem by restricting the set of possible solutions to Equation (1) 2-fold: (i) the in- and out-degrees of reactions are preserved and (ii) the substitution of compounds is limited to certain subsets, as detailed below, which allows to easily ﬁnd a solution for Equation (1).
The ﬁrst restriction is in line with the observation that reaction degrees are biochemically constrained by the number of interacting compounds.
The second allows to divide the randomization procedure into a precalculation step and an actual randomization.
As a result, the  [17:39 18/4/2011 Bioinformatics-btr145.tex]  Page: 1398 1397 1403   Table 1.
Example of a mass equivalence class for individual compounds and their mass vectors  Table 2.
Example of a mass equivalence class for pairs of compounds and their mass vectors  Mass-balanced randomization  Compound  Allose Alpha-d-galactose Alpha-glucose Arabinose Cpc-10774 Cpd0-1108 Cpd0-1110 D-arabinose D-ribulose D-xylulose Dihydroxyacetone Formaldehyde Galactose Glc Glycolaldehyde L-lyxose L-ribulose L-xylulose Mannose Myo-inositol Xylose  C  6 6 6 5 5 5 5 5 5 5 3 1 6 6 2 5 5 5 6 6 5  H  12 12 12 10 10 10 10 10 10 10 6 2 12 12 4 10 10 10 12 12 10  N  O  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0  6 6 6 5 5 5 5 5 5 5 3 1 6 6 2 5 5 5 6 6 5  P  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0  S  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0  Each mass vector is a multiple of a scalar and the basis vector (1,2,0,1,0,0).
generation of a large set of mass-balanced randomized networks becomes computationally feasible.
We now move to the description of our randomization procedure including the above-mentioned restrictions.
Our procedure depends on determining the classes of linearly dependent mass vectors.
Two compounds c,k  Vc will be called mass equivalent if and only if their respective mass vectors mc and mk are linearly dependent.
(cid:6),k (cid:6) Moreover, two pairs of compounds, denoted by (c,k) and (c ), will be called mass equivalent if and only if the corresponding sums of mass vectors mc+mk and mc(cid:6) +mk(cid:6) are linearly dependent.
Note  that mass equivalence is an equivalence relation, which follows from the reﬂexivity, symmetry and transitivity of linear dependence for vectors in Nn.
As a result, the mass equivalence relation partitions the set of compounds and pairs of compounds (see Tables 1 and 2 for examples, and Supplementary Fig.
S2 for the class size distributions).
linear-dependent  The inclusion of  triplets of mass vectors is straightforward and may further increase the sample space.
However, due to the computational restrictions imposed by the size of genome-scale metabolic networks, we rely only on substitutions of individual and pairs of compounds.
Finally, our approach is in line with the observations that some fundamental properties should be ﬁxed while carrying out the randomization here, these are the degrees of the reaction nodes and mass balance.
3 METHODS In this section, we present the details of the proposed algorithm for randomizing metabolic networks together with its computational complexity, and show the main result about the uniformity of the method for network randomization.
Compound pair  C  2-Ketoglutarate D-beta-D-heptose-17-diphosphate  2-pg Methyl-glyoxal  3-p-hydroxypyruvate Acetol  3-p-hydroxypyruvate Hydroxypropanal  3-p-hydroxypyruvate Lactald  3OH-4P-OH-alpha-ketobutyrate Acetald  Ascorbate Fructose-16-diphosphate  Ascorbate Tagatose-1-6-diphosphate  Cpd0-1063 Phospho-enol-pyruvate  Formate Cpd-10551  Dihydroxy-butanone-p Glyox  Dihydroxyacetone Phospho-enol-pyruvate  Dihydroxy-acetone-phosphate Pyruvate  Gap Pyruvate  G3P Methyl-glyoxal  Hydrogen-molecule L-ascorbate-6-phosphate  L-glyceraldehyde-3-phosphate Pyruvate  OH-pyr Propionyl-P  Propionyl-P Tartronate-S-ald  5 7  3 3  3 3  3 3  3 3  4 2  6 6  6 6  9 3  1 5  4 2  3 3  3 3  3 3  3 3  0 6  3 3  3 3  3 3  H  4 12  4 4  2 6  2 6  2 6  4 4  6 10  6 10  14 2  1 7  7 1  6 2  5 3  5 3  4 4  2 6  5 3  3 5  5 3  N  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  O  5 13  7 2  7 2  7 2  7 2  8 1  6 12  6 12  12 6  2 7  6 3  3 6  6 3  6 3  7 2  0 9  6 3  4 5  5 4  P  S  0 2  1 0  1 0  1 0  1 0  1 0  0 2  0 2  1 1  0 1  1 0  0 1  1 0  1 0  1 0  0 1  1 0  0 1  1 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  0 0  The sum of mass vectors for each pair is a multiple of a scalar and the basis vector (6,8,0,9,1,0).
1399  [17:39 18/4/2011 Bioinformatics-btr145.tex]  Page: 1399 1397 1403   G.Basler et al.
3.1 Randomization algorithm The algorithm consists of two steps: in the ﬁrst step, for a given metabolic network G, the mass equivalence classes are generated from the set of compounds Vc(G).
This step is to be executed only once for all subsequent randomizations of the same network.
In the second step, the reactions of G are randomized while preserving mass balance.
To randomize a reaction, chosen uniformly at random from Vr(G), substrates and products are replaced by randomly chosen substitutes from their corresponding mass equivalence classes.
In addition, this substitution entails recalculation of the stoichiometric coefﬁcients to guarantee the preservation of mass balance.
The output from this step is a network in which stoichiometric coefﬁcients are changed, edges are replaced and, consequently, the degrees of the compounds are altered, while the reaction degrees and mass balance of all reactions are preserved (see Supplementary Fig.
S1 for an overview and comparison to switch randomization).
Let σ(c) denote the mass equivalence class of a compound c and σ(c,k), the mass equivalence class of a pair of compounds (c,k).
Given a reaction r, a substrate (product) c of r will be called substitutable in r by a compound (cid:6)  Vc, denoted by c r c , if and only if the following two conditions are c satisﬁed:  (cid:6)  (cid:6)  σ(c) and  (cid:6)  is not already a substrate (product) of r.    (S1) the compounds are mass equivalent, i.e.
c   (S2) the substitute c Similarly, we deﬁne a pair of substrates (products) (c,k) (rin rin)  (rout rout), c(cid:8)= k, to be substitutable in r by a pair of compounds (c (cid:6) (cid:6),k ), (cid:6)(cid:8)= k if and only if the following three c conditions hold:  , denoted by (c,k) r (c  (cid:6),k  ),  (cid:6)  (cid:6)  (cid:6),k   (P1) (c,k) is mass equivalent to (c   (P2) neither c   (P3) there are stoichiometric coefﬁcients sl,r(cid:6)   N reaction r  )  σ(c,k), is already a substrate (product) of r and +,l  r (cid:6)  , such that Equation (1) is satisﬁed.
), i.e.
(c  nor k  (cid:6),k  (cid:6)  (cid:6)  (cid:6)  (cid:6)  (cid:6)  for the new  Note that substitutability, in contrast to mass equivalence, is deﬁned over substrates and products of a reaction, such that a substitution only affects either the substrates or the products of one reaction.
In addition, conditions (cid:6)(cid:8)= c, such that each substitution results in a reaction (S2) and (P2) imply c (cid:6)(cid:8)= r (i.e.
substitutability is irreﬂexive).
r In order to choose a particular substitution for a given reaction r uniformly at random, the set of all possible substitutions for r has to be determined.
Let the set of substitutions of individual compounds be denoted by  s(r), and the set of substitutions of pairs of compounds be denoted by  p(r).
According to the above deﬁnitions, these sets are then given by   s(r)= (c,c (cid:6)  p(r)= (c,k,c  )  c r c (cid:6),k  (cid:6), c  r , ) (c,k) r (c  (cid:6)  (cid:6)  (cid:6),k  ),  (c,k) (rin rin) (rout rout) ,  (2)  (cid:6),k  (cid:6)  Vc.
The combined set of all possible substitutions for r is where c,k,c then given by  (r)=  s(r)  p(r).
Note that substitutability is symmetric, i.e.
any substitution can be reversed, as we can always replace the substitutes and their stoichiometric coefﬁcients by those of the original reaction.
Proposition 3.1.
For a given reaction r, each substitution results in a unique reaction.
(cid:6)  (cid:6)  ) in r both result in the same reaction r (cid:6)  r and k  Proof.
Suppose the substitutions of individual compounds (c,c (cid:6)  r (cid:6)  ) and imply (k,k (cid:6)  r, which contradicts condition (S2).
By condition (P2), that c this holds analogously for the substitution of pairs of compounds.
Suppose the substitution of individual compounds (c,c ) results in the same reaction (cid:6)  r (cid:6) r or l  as the substitution of a pair of compounds (k,l,k (cid:6)  r, both contradicting condition (P2).
).
Then, either k  .
Then, c  (cid:6)  r  and k  (cid:6),l  (cid:6)  (cid:6)  (cid:6)  (cid:6)  In the following, we analyze the algorithm for randomizing metabolic networks: For a reaction r, chosen uniformly at random, the set of possible  1400  substitutions for all substrates, products and pairs of substrates or products in r is generated, in order to then choose one substitution uniformly at random (see Algorithm).
The stoichiometric coefﬁcients in r are recalculated (line 6) by ﬁnding positive integers sl,r   N +,l  r satisfying Equation (1).
For the substitution of an individual compound (c,c ), such coefﬁcients can always be found, due to the linear dependence of the mass vectors: sc(cid:6),r is mc(cid:6)  sc,rmc.
If sc(cid:6),r is a non-integer a/b, then all coefﬁcients of obtained as r are multiplied by b.
Recalculation of the stoichiometric coefﬁcients for the substitution of pairs of compounds requires solving a system of n linear equations with two unknowns.
In case there is no solution, the substitution is not carried out.
Table 3 shows examples of possible substitutions (details of the algorithms can be found in the Supplementary Material).
1  (cid:6)  +  Algorithm: Mass-balanced randomization of metabolic networks Input: Mass-balanced metabolic network, G=(Vc Vr ,E), Mass equivalence classes, σ= σ(c) σ(c,k), (c,k)  Vc Vc, c(cid:8)= k, Number of iterations, t  N Output: Randomized mass balanced network Repeat t times: 1 Choose a reaction r  Vr uniformly at random 2 Determine the set of possible substitutions  (r) from σ 3 Choose a substitution d   (r) with probability 1/  (r)  4 if d is an individual substitution (c,c  if c is a substrate of r then  replace the edge (c,r) by (c  else  replace the edge (r,c) by (r,c (cid:6),k  5 else if d is a pair substitution (c,k,c  if c,k are substrates of r then  (cid:6) ) then (cid:6),r) (cid:6) (cid:6)  )  ) then  replace the edges (c,r) and (k,r) by (c  else  replace the edges (r,c) and (r,k) by (r,c  (cid:6),r) and (k (cid:6)  (cid:6),r) (cid:6)  ) and (r,k  )  6 Recalculate the stoichiometric coefﬁcient(s) in r  Note that the number of reactions in G as well as the in- and out-degrees of perturbed reactions are not changed by the algorithm.
Since both directions of a reversible reaction are considered independently, reversibilities can optionally easily be preserved by choosing only forward reactions in line 1, and updating the reversed reaction accordingly after line 6.
Due to the consideration of all pairs of compounds, the time complexity for precalculating the mass equivalence classes is in O( Vc 2).
However, this step is executed only once for any (usually large) number of subsequent randomizations of the same network.
For the randomization procedure, choosing a reaction and a substitution uniformly at random (lines 1 and 3) and replacing edges (lines 4 and 5) can be performed in constant time.
Determining all possible substitutions for a reaction r (line 2) requires retrieving the precalculated mass equivalence class of each substrate, product and each pair of substrates or products, which is in O(d(r)2).
Then, for each mass equivalent compound or pair of compounds, one has to determine whether they are already substrates or products in r, and whether there exist stoichiometric coefﬁcients satisfying Equation (1), in order to obtain  (r).
The latter requires solving a system of n linear equations with two unknowns, which is in O(n), such that the solution can be used in line 6.
Hence, line 2 is in O(d(r)2 σmax n), where σmax is the size of the largest mass equivalence class, and line 6 can be executed in constant time.
Therefore, the algorithm has time complexity in O(t ( 2 σmax n)), where   is the maximum reaction degree of G. Note that   and n are bounded by small constants:   17, n 23 and σmax  780 in the investigated networks.
3.2 Uniformity of sampling Any algorithm for randomizing a combinatorial structure should guarantee that every random instance is generated with equal probability.
In other words, the probability distribution over the space of possible combinatorial structures must converge to the uniform probability distribution.
Otherwise,  [17:39 18/4/2011 Bioinformatics-btr145.tex]  Page: 1400 1397 1403   Mass-balanced randomization  Table 3.
Phosphoenolpyruvate-glycerone phosphotransferase reaction in E.coli (EcoCyc) (row 1) and examples of possible substitutions for individual substrates (rows 2 and 3) and pairs of substrates (rows 4 and 5)  Dihydroxyacetone + C3 H6 O3  Phospho-enol-pyruvate C3 H2 O6 P1  3  3  Formaldehyde C1 H2 O1 Glycolaldehyde C2 H4 O2 G3P C3 H4 O7 P1 Ascorbate C6 H6 O6  +  +  +  +  2  Phospho-enol-pyruvate C3 H2 O6 P1 Phospho-enol-pyruvate C3 H2 O6 P1 Methyl-glyoxal C3 H4 O2 Fructose-16-diphosphate C6 H10 O12 P2         2     2  Dihydroxy-acetone-phosphate C3 H5 O6 P1  Dihydroxy-acetone-phosphate C3 H5 O6 P1 Dihydroxy-acetone-phosphate C3 H5 O6 P1 Dihydroxy-acetone-phosphate C3 H5 O6 P1 Dihydroxy-acetone-phosphate C3 H5 O6 P1  +  +  +  +  +  2  2  Pyruvate C3 H3 O3  Pyruvate C3 H3 O3 Pyruvate C3 H3 O3 Pyruvate C3 H3 O3 Pyruvate C3 H3 O3  The mass vectors are given below the compound names, modiﬁed stoichiometric coefﬁcients and compounds are shown in bold.
the properties of the sample space would be biased toward those of more frequently generated networks, and, consequently, the signiﬁcance assigned to any property would be questionable.
Here, we show that our proposed algorithm for randomizing metabolic networks indeed has this property on the class of metabolic networks randomized via substitutions of single compounds and pairs of compounds (with mild assumption for the latter).
if z  σ(x), then the transitivity of mass equivalence implies z  σ(y).
Thus, the substitutions for z do not change, except that z r y is replaced by z r(cid:6) x ].
On the other hand, if [as y is a substrate (product) of the new reaction r z /  σ(x), then z /  σ(y) implies that the substitutions for z do not change after substituting x in r by y.
Thus, we have d(G0)= d(G), and the sampling is uniform.
(cid:6)  To establish this result, we rely on a transition graph  G, in which a node represents a network that can be generated by our algorithm, and two nodes are connected by an edge (u,v), if there exists a substitution in u generating v. The given metabolic network to be randomized is denoted by G0  V( G).
The set of networks obtained after applying t substitutions to G0 is denoted by  t = Gt + .
Note that, due to the symmetry of the substitutability relation,  G is undirected (i.e.
each edge corresponding to a substitution can be traversed in both directions).
Moreover, since each node in the transition graph  G corresponds to a network obtained after applying t substitutions starting from G0, the transition graph  G is connected.
i=1,...m,m  N  i  Applying the randomization algorithm is equivalent to a random walk on  G, starting at G0.
Therefore, we use the existing results from the theory of random walks on graphs.
The classical theorem for uniformity of random walks on graphs (see (Lovasz, 1993)) states that, for any non-bipartite regular transition graph  G, a random walk using transition probabilities, 1/d(u), u  V( G), is stationary, i.e.
the probabilities for stopping the random walk at a node after any number t of transitions do not change with t  .
Therefore, to prove the uniformity, we show that  G is (almost) regular, i.e.
the degree distribution of  G is (almost) uniform.
We ﬁrst show the uniformity of our method if only individual compounds are allowed to be substituted.
Given a metabolic network G0, for any reaction r  Vr the number of possible substitutions of individual compounds in r is   s(r)  [see Equation (2)].
From Proposition 3.1, it follows that each substitution corresponds to a unique edge in  G. Therefore, the degree of G0 in the transition graph is  ds(G0)=    s(r) .
(cid:1) r Vr (G0)  (3)  If only individual compounds are allowed to be substituted,  Theorem 1. then  G is regular.
Proof.
To establish the claim, we need to show that d(G0)= d(G),G   t, for any number of substitutions t  N. Note that the number of reactions  Vr  and their degrees remain unchanged.
Therefore, it sufﬁces to show that the number of possible substitutions for a reaction r does not change after substituting a compound.
Let x be a substrate (product) of a reaction r and let x r y, i.e.
y  σ(x) and y is not already a substrate (product) of r. The symmetry of mass equivalence implies x  σ(y).
The possible substitutions for x are then the same as the possible substitutions for y after replacing x in r by y, except that x r y is .
For any substrate (product) z(cid:8)= x, replaced by y r(cid:6) x in the new reaction r  (cid:6)  The more general case, on which our algorithm is based, considers substitutions of both individual compounds and pairs of compounds.
In this case, due to changes after applying a substitution,  G may not be regular.
To illustrate this point, for a reaction r, if a substrate c is substituted by a compound x, we may subsequently substitute the pair of substrates (x,k), where k is any other substrate of r. The possible substitutions for (c,k) in r,  (c,k,c ) , may be different from the ) (x,k) r(cid:6) possible substitutions for (x,k) in the new reaction r ) .
Similarly, the possible substitutions for individual compounds may (cid:6),k (x change after substituting a pair of compounds.
Consequently, the sizes of (cid:6) substitutability classes  s(r) and  p(r) may differ from the sizes of  s(r ) and  p(r  ), so that two nodes in  G may have different degrees.  )
(c,k) r (c  ,  (x,k,x  (cid:6),k  (cid:6),k  (cid:6),k  (cid:6)(cid:6)  (cid:6)(cid:6)  (cid:6)  (cid:6)  (cid:6)  (cid:6)  In the following, we analyze the probability that the algorithm samples nodes from  G almost uniformly at random.
Let us consider a random walk  G0,G1,...,Gt  on  G, starting at node G0.
Let Yi be the non-negative random variable whose value is the absolute value of difference of degrees between two neighbors Gi and Gi+1 on the walk, i.e.
Yi = d(Gi) d(Gi+1) , 0  i   t. We assume that all Yi are independent and identically distributed variables, with probability density function P(Yi = k)= P(Y = k)= Ck  γ for a positive constant C. Since all networks and the number of possible substitutions are ﬁnite, this distribution exhibits a ﬁnite mean.
k=0 Yk+(cid:2) the sequence Xj =(cid:2)j 1 A sequence of random variables X0,X1,...,Xt, where the expected value of Xt is determined by Xt 1, is called a martingale (Williams, 1991).
Then, (cid:4) (cid:3)(cid:2) k=j E[Yk], 0  j  t, forms a martingale, and, t 1 in particular, X0= E and Xt = Y0+Y1+...Yt 1 (Chung and Lu, 2006).
Furthermore, let Bj denote the event that  Xj Xj+1    cj, cj  0, 0  j   t  then, P(Bj)= P( E[Yj] Yj    cj) is the probability that the absolute difference between expected and actual degree changes in step j of the random walk on  G exceeds some cj  0.
By a result of (Chung and Lu, 2003) (Theorem 8.3), the following generalized Azuma inequality holds for the probability that degree changes differ at least by λ from the expected degree changes after t steps:  t 1 k=0 Yk  (cid:7)  (cid:6) exp  (cid:8)  (cid:2)  λ2 t j=1 c2 j  2  P  (cid:5) Xt X0   λ (cid:9) d(Gi) d(Gi+1) (cid:10)  where B= Bt.
δ= E[Y]= E cumulative probability distribution is given by P(Y   k)= C  Let δ denote the expected degree difference of adjacent nodes, i.e.
, 0  i   t. Given that P(Y = k)= Ck  γ , the (cid:6) k1 γ (Li  +P(B),  (4)  [17:39 18/4/2011 Bioinformatics-btr145.tex]  Page: 1401 1397 1403  1401   G.Basler et al.
A  1  ) g o l (   y c n e u q e r F  1  .
0  1 0 0  .
1 0 0  .
0  1 0 0 0  .
0  B  y c n e u q e r f   n r u o o S  j  0 0 2 1  0 0 0 1  0 0 8  0 0 6  0 0 4  0 0 2  0  1  2  5  10  20  50  100  200  500  1  200  400  600  800  1024  Absolute difference in degrees (log)  Network  Fig.
1.
(A) Distribution of absolute differences in degrees between neighbors, sampled by a random walk on the transition graph of E.coli (EcoCyc).
The dashed line shows the power-law ﬁt with a scaling coefﬁcient of γ  1.87.
The mean difference is δ 7.14 (see Supplementary Fig.
S3 for the remaining organisms).
(B) Sojourn frequencies of a random walk on the transition graph of the TCA cycle (equivalent to a randomization of the TCA cycle).
For 105 steps, the SD of sojourn frequencies is σ 10.8, yielding a coefﬁcient of variation of 0.113 (grey line)  after 106 steps, we have σ 34.6 and a coefﬁcient of variation of 0.038 (black line), conﬁrming that the probability distribution over the 1024 networks converges toward the uniform distribution.
(cid:5) Xj Xj+1    δ  et al., 2005).
Therefore, the probability that the degree difference between neighbors is larger than the expected difference can be expressed as P(B)= P(Y   δ)  δ1 γ .
We then have the following claim: (cid:6)  δ1 γ , Theorem 2.
If the distribution of differences in degrees between neighboring nodes follows a power-law P(Y = k)  k δ= E[Y], then the probability that the accumulated degree difference between any two nodes, sampled by a random walk, exceeds the number of steps t is (cid:6) exp bounded by:   γ and P (cid:12) (cid:11)  t 2δ2 Proof.
By invoking Equation (4) with cj = δ, 2 =2t δ2, we get the probability that, after t steps, the accumulated difference between expected (cid:11)  t2 (cid:12) and actual degree differences is at least t: 2t δ2  (cid:5) Xt X0   t  (cid:5) Xt X0   t  +δ1 γ .
(cid:2)  (cid:6) exp  +δ1 γ .
t j=1 c2 j  P  P  As Xt and X0 are the sums of absolute differences in degrees, the above expression represents the maximum difference in degrees between any two nodes reachable within t steps, i.e.
Xt X0   d(Gt) d(G0) .
The proof relies on the assumption that the distribution of differences in degrees of neighboring nodes in  G follows a power-law distribution.
This is conﬁrmed in Figure 1A for E.coli (see Supplementary Fig.
S3 for the remaining organisms).
if, for any two nodes G,H   V( G), the following holds:  Let d( G) denote the average degree of  G. We call  G almost regular   d(G) d(H)    1.
We then have the following corollary.
d( G)  Corollary.
The probability that the algorithm samples nodes from  G almost uniformly at random is bounded by:  1 exp   δ1 γ .
(cid:8)  (cid:7)  (cid:12)   1   d( G)2 2t δ2  (cid:11) Xt X0  (cid:9) d(Gj) d(Gj+1) (cid:10)  Proof.
Since  d( G)  P  E   Xj Xj+1 = E[Yj] Yj   d(Gj) d(Gj+1) + , from Equation (4) we can establish the probability  that  Xt X0   λ with λ= d( G), as in the proof of Theorem 2.
We then have P 1 P  (cid:5) Xt X0   d( G) (cid:6)  e  d( G)2 (cid:7) 2t δ2 +δ1 γ , which is equivalent to (cid:12) (cid:11) Xt X0   d( G)2  exp 2t δ2  +δ1 γ .
(cid:8)   1  d( G)  As an example of the corollary, for the case of E.coli, we obtain  1.87, δ 7.14 and d( G) 19490 from sampling 104 random P( = k)  k walks.
Then the probability, that the algorithm samples nodes from  G (cid:11) d(Gt) d(G0)  uniformly at random within t=106 steps is bounded by:   194902 2 106 7.142  7.141 1.87 0.80   1 e  (cid:12)   1  P  d( G)  (Supplementary Table S2 shows the results for the remaining organisms).
Note that these probabilities represent a rare worst case, since all Xj are the sums of absolute differences in degrees.
In practice, the cumulative degree changes of sampled nodes are likely to be smaller due to positive and negative changes in degree.
(cid:5) e  (cid:6)  Finally, we brieﬂy analyze some practical implications of these ﬁndings.
First, we determine the size of the sample space, i.e.
the number of distinct randomized networks which can be generated from a given metabolic network G, if only individual compounds are substituted.
Let  s(r) denote the set of all mass equivalence classes, which contain a substrate or product of r. From each such equivalence class es   s(r), we may choose any subset with the size of the number of substrates (products) of r contained in  s(r)  let φ denote this number.
Then, there are possible reactions for each mass equivalence class es, where the original reaction may be obtained by reversing any previous substitutions.
Therefore, the number of distinct networks which can be generated from G by substituting only individual compounds is  (cid:13) r Vr (G) For the model organism E.coli,  (cid:13) e  s(r) the size of the sample space is  s 2.97 10957 (see Supplementary Table S2 for the remaining organisms).
The large sample spaces, again, illustrate the importance of uniform sampling.
(cid:11) e    G,s=  (cid:12)  φ  φ  .
As shown before, the number of distinct networks which can be generated by substituting pairs of compounds does not merely depend on the reactions in the original network, as the number of possible substitutions may change after applying substitutions.
Therefore, we are unable to give a precise  1402  [17:39 18/4/2011 Bioinformatics-btr145.tex]  Page: 1402 1397 1403   expression for the sample size in this case.
Nevertheless, it is clear that, for the case of substituting individual compounds and pairs of compounds, the sample space is at least as large as  G,s.
In order to conﬁrm the result of uniformity empirically, we analyze a random walk on the transition graph of the TCA cycle, a central respiratory metabolic pathway consisting of only 8 reactions and 20 compounds.
For this network, the sample spaces are  TCA,s=256,  TCA,p=1024, with a combined total of 1024 possible randomized networks (i.e.
all networks generated by a sequence of individual compound substitutions can also be generated by pair substitutions).
We observe that the sojourn frequencies, i.e.
the number of times each network is visited by the random walk, indeed converge toward the uniform distribution (see Fig.
1B), conﬁrming our theoretical claims.
4 CONCLUSION The advances in high-throughput omics technologies require developing algorithmic techniques for the analysis of large-scale biological networks.
However, the signiﬁcance of any network- based prediction must be validated using a realistic null model.
While the method based on switch randomization has been extensively used to study the signiﬁcance of topological properties in many different types of networks, we argued that it is unsuitable for the analysis of metabolic networks.
We presented a new method for randomizing metabolic networks under the constraint of mass balance.
We observed that a null model should satisfy two important requirements: preservation of ubiquitous constraints characterizing the class of analyzed networks and uniformity of the sampling procedure.
We demonstrated the uniformity of the proposed method theoretically and empirically on seven metabolic networks from all kingdoms of life.
By integrating the (bio)chemical constraint of mass balance into a network null model, our method allows for a more realistic measure of signiﬁcance.
In addition, the proposed approach can be used for identifying network properties which are independent of mass balance constraints, and thus are likely to relate to the evolutionary history of metabolic networks.
For instance, in a recent study, we applied the method to assess the evolutionary signiﬁcance of thermodynamic favorability of metabolic reactions (Basler et al., 2010).
We believe that the integration of mass balance constraints is a necessary ﬁrst step toward extracting biologically meaningful properties of genome-scale metabolic networks.
Funding: G.B., J.S.
and Z.N.
are supported by the GoFORSYS project funded by the German Federal Ministry of Education and Research (0313924).
O.E.
is supported by the Scottish Universities Life Sciences Alliance (SULSA) funded by the Scottish Funding Council.
Conﬂict of Interest: none declared.
REFERENCES Albert,R.
(2005) Scale-free networks in cell biology.
J.
Cell Sci., 118, 4947 4957.
Albert,I.
and Albert,R.
(2004) Conserved network motifs allow protein-protein  interaction prediction.
Bioinformatics, 20, 3346 3352.
Mass-balanced randomization  Barabási,A.-L. and Oltvai,Z.N.
(2004) Network biology: understanding the cell s  functional organization.
Nat.
Rev.
Genet., 5, 101 114.
Basler,G.
et al.
(2010) Thermodynamic landscapes of randomized large-scale metabolic networks.
In Proceedings of the 7th International Workshop on Computational Systems Biology, Tampere International Center for Signal Processing (Tampere), pp.
23 26.
Bernhardsson,S.
and Minnhagen,P.
(2010) Selective pressure on metabolic network structures as measured from the random blind-watchmaker network.
N. J.
Phys., 12, 103047.
Chung,F.R.K.
and Lu,L.
(2003) Coupling online and ofﬂine analyses for random power  law graphs.
Internet Math., 1, 409 461.
Chung,F.R.K.
and Lu,L.
(2006) Concentration inequalities and martingale inequalities:  a survey.
Internet Math., 3, 79 127.
Dobson,C.M.
(2004) Chemical space and biology.
Nature, 432, 824 828.
Feist,A.M.
et al.
(2007) A genome-scale metabolic reconstruction for Escherichia coli k-12 mg1655 that accounts for 1260 orfs and thermodynamic information.
Mol.
Syst.
Biol., 3, 121.
Guimera,R.
et al.
(2006) Classes of complex networks deﬁned by role-to-role  connectivity proﬁles.
Nat.
Phys., 3, 63 69.
Herrgård,M.J.
et al.
(2008) A consensus yeast metabolic network reconstruction obtained from a community approach to systems biology.
Nat.
Biotechnol., 26, 1155 1160.
Horowitz,E.
and Sahni,S.
(1974) Computing partitions with applications to the knapsack  problem.
J. ACM, 21, 277 292.
Jeong,H.
et al.
(2000) The large-scale organization of metabolic networks.
Nature, 407,  651 654.
Jeong,H.
et al.
(2001) Lethality and centrality in protein networks.
Nature, 411, 41 42.
Keseler,I.
et al.
(2009) EcoCyc: a comprehensive view of Escherichia coli biology.
Nucleic Acids Res., 37, D464 D470.
Klamt,S.
et al.
(2009) Hypergraphs and cellular networks.
PLoS Comput.
Biol., 5,  e1000385.
Li,L.
et al.
(2005) Towards a theory of scale-free graphs: deﬁnition, properties, and  implications.
Internet Math., 2, 431 523.
Lovasz,L.
(1993) Random walks on graphs: a survey.
Bolyai.
Math.
Stud., 2, 1 46.
Ma,H.W.
and Zeng,A.P.
(2003) The connectivity structure, giant strong component and  centrality of metabolic networks.
Bioinformatics, 19, 1423 1430.
Ma,H.
et al.
(2007) The edinburgh human metabolic network reconstruction and its  functional analysis.
Mol.
Syst.
Biol., 3, 135.
Marr,C.
et al.
(2007) Regularizing capacity of metabolic networks.
Phys.
Rev.
E Stat.
Nonlin.
Soft Matter Phys., 75, 041917.
Maslov,S.
and Sneppen,K.
(2002) Speciﬁcity and stability in topology of protein  networks.
Science, 296, 910 913.
May,P.
et al.
(2008) Metabolomics- and proteomics-assisted genome annotation and analysis of the draft metabolic network of Chlamydomonas reinhardtii.
Genetics, 179, 157 166.
Milo,R.
et al.
(2002) Network motifs: simple building blocks of complex networks.
Science, 298, 824 827.
Milo,R.
et al.
(2003) Uniform generation of  random graphs with arbitrary degree sequences.
cond-mat/0312028.
Available at http://www.arxiv.com/abs/cond- mat/0312028v1.
Oh,Y.-K. et al.
(2007) Genome-scale reconstruction of metabolic network in bacillus subtilis based on high-throughput phenotyping and gene essentiality data.
J. Biol.
Chem., 282, 28791 28799.
Papin,J.A.
et al.
(2005) Reconstruction of cellular signalling networks and analysis of  their properties.
Nat.
Rev.
Mol.
Cell Biol., 6, 99 111.
Picard,F.
et al.
(2008) Assessing the exceptionality of network motifs.
J. Comput.
Biol.,  15, 1 20.
Sales-Pardo,M.
et al.
(2007) Extracting the hierarchical organization of complex  systems.
Proc.
Natl Acad.
Sci.
USA, 104, 15224 15229.
Shen-Orr,S.S.
et al.
(2002) Network motifs in the transcriptional regulation network of  Escherichia coli.
Nat.
Genet., 31, 64 68.
Stuart,J.M.
et al.
(2003) A gene-coexpression network for global discovery of conserved  genetic modules.
Science, 302, 249 255.
Swarbreck,D.
et al.
(2008) The Arabidopsis Information Resource (TAIR): gene  structure and function annotation.
Nucleic Acids Res., 36, D1009 D1014.
Artzy-Randrup,Y.
and Stone,L.
(2005) Generating uniformly distributed random  Williams,D.
(1991) Probability With Martingales.
Cambridge University Press, The  networks.
Phys.
Rev.
E, 72, 056708.
Artzy-Randrup,Y.
et al.
(2004) Comment on network motifs: simple building blocks of complex networks and superfamilies of evolved and designed networks.
Science, 305, 1107c.
Barabási,A.-L. and Albert,R.
(1999) Emergence of scaling in random networks.
Science,  286, 509 512.
Edinburgh Building, Cambridge, UK.
Yamada,T.
and Bork,P.
(2009) Evolution of biomolecular networks: lessons from  metabolic and protein interactions.
Nat.
Rev.
Mol.
Cell Biol., 10, 791 803.
1403  [17:39 18/4/2011 Bioinformatics-btr145.tex]  Page: 1403 1397 1403
