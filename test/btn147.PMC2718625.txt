BIOINFORMATICS Vol.24 ISMB 2008, pages i105 i113 doi:10.1093/bioinformatics/btn147 A model of higher accuracy for the individual haplotyping problem based on weighted SNP fragments and genotype with errors Minzhu Xie 1,2, Jianxin Wang 1, and Jianer Chen 1,3 1School of Information Science and Engineering, Central South University, Changsha 410083, 2College of Physics and Information Science, Hunan Normal University, Changsha 410081, China and 3Department of Computer Science, Texas A&M University, College Station, TX 77843, USA ABSTRACT Motivation: In genetic studies of complex diseases, haplotypes provide more information than genotypes. However, haplotyping is much more difﬁcult than genotyping using biological techniques.
Therefore effective computational techniques have been in demand.
The individual haplotyping problem is the computational problem of inducing a pair of haplotypes from an individual s aligned SNP fragments.
Based on various optimal criteria and including different extra information, many models for the problem have been proposed.
Higher accuracy of the models has been an important issue in the study of haplotype reconstruction.
Results: The current article proposes a highly accurate model for the single individual haplotyping problem based on weighted fragments and genotypes with errors.
The model is proved to be NP- hard even with gapless fragments.
Based on the characteristics of Single Nucleotide Polymorphism (SNP) fragments, a parameterized algorithm of time complexity O(nk22k2 +mlogm+mk1) is developed, where m is the number of fragments, n is the number of SNP sites, k1 is the maximum number of SNP sites that a fragment covers (no more than n and usually smaller than 10) and k2 is the maximum number of the fragments covering a SNP site (usually no more than 19). Extensive experiments show that this model is more accurate in haplotype reconstruction than other models.
Availability: The program of the parameterized algorithm can be obtained by sending an email to the corresponding author.
Contact: jxwang@mail.csu.edu.cn 1 INTRODUCTION The different DNAs between two individuals genomes account for about 0.5% of the whole genome sequence (Levy et al., 2007), and these differences make the two individuals different from each other in ﬁgures, diseases susceptibilities and other phenotypes. A single nucleotide polymorphism (SNP) is a change of a single nucleotide in a given position of the genome sequence with a frequency not 1% in a given population.
There are millions of SNPs in the human genome (The International HapMap Consortium, 2005 Venter et al., 2001). SNPs are believed to be the major genetic cause to human phenotypic variability.
It is widely accepted that at a given SNP site, there are only two possible nucleotides, one usually occurs in more than 90% individuals of a population and is called major allele, and the other   To whom correspondence should be addressed.
is called minor allele.
For briefness, a SNP is represented by 0, or 1, instead of a nucleotide (A, C, G or T), where 0 denotes the major allele (at the SNP site), and 1 denotes the minor allele.
The human genome is made up of 23 pairs of chromosomes.
A sequence of SNP alleles on one of a pair of chromosomes is called a haplotype, which can be denoted by a string over 0, 1.
A sequence of conﬂated (unordered pair of) SNP alleles at each SNP site of a pair of homologous chromosomes is called a genotype. A genotype can be represented by a string over 0, 1, 2 , where 0 (resp. 1 ) indicates that both SNPs are 0 (resp. 1 ) at the same SNP site of the pair of chromosomes, and 2 indicates that at the same SNP site, the SNP on one of the pair of chromosomes is 0 , while on the other of the pair is 1.
In Figure 1, the haplotypes of the individual are (A, C, G, T) and (G, C, C, T), which can be denoted by 0100 and 1110.
The genotype is (A/G, C/C, G/C, T/T), which can be denoted by 2120.
In ﬁnding susceptibility loci for complex diseases, haplotype- based methods are more powerful and robust than the methods based on individual SNPs (Akey et al., 2001). However, determining haplotypes using biological techniques is both time consuming and expensive, and is much harder than determining individual SNPs or genotypes. Therefore, to reduce the cost of determining haplotypes, effective computational methods have been in demand.
There have been many computational models for the haplotyping problem (Adkins, 2004 Bonizzoni et al., 2003 Zhang et al., 2006), and they generally fall into two classes: individual haplotyping and population haplotyping. The individual haplotyping problem is concerned with assembling a pair of haplotypes from an individual s aligned DNA fragments, while the population haplotyping problem is to infer the haplotypes of a sample of people in a population from their genotypes. This current article is focused on the individual haplptyping problem and aimed at studying highly accurate model and developing effective computational algorithms for the problem.
The article is organized as follows.
In Section 2, we introduce the individual haplotyping problem and propose a new model based on weighted SNP fragments and genotype with errors.
We prove that the individual haplotyping problem under this model is NP-hard. To effectively solve the problem under this model, we develop in Section 3 an exact parameterized algorithm for the problem.
Section 4 presents experimental results and discussions.
The article is concluded by Section 5.
2008 The Author(s) This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/2.0/uk/) which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.
[18:55 18/6/03 Bioinformatics-btn147.tex] Page: i105 i105 i113  M.Xie et al. 2 FORMULATION AND PROBLEMS 2.1 The individual haplotyping problem For large-scale haplotyping, a set of aligned SNP fragments from a pair of chromosomes can be generated by DNA shotgun sequencing or other sequencing experiments.
The individual haplotyping problem (Lancia et al., 2001) is aimed at partitioning the set of SNP fragments into two subsets, each determining a haplotype. To formulate the problem, we introduce some notations and concepts, similar to those used in Xie and Wang (2007). In the following discussion, m aligned SNP fragments coming from a pair of chromosomes with n SNP sites are represented by an m n SNP matrix M over the alphabet 0, 1,  , in which each row corresponds to a fragment and each column corresponds to a SNP site.
The SNP allele of the ith fragment at the jth SNP site is denoted by the entry Mi,j of M at the ith row and the jth column, and the entry Mi,j takes value   if either the ith fragment does not cover the jth SNP site or the corresponding SNP allele of the ith fragment cannot be determined with enough conﬁdence. We say that the ith row covers the jth column if either Mi,j (cid:2)=  , or there are two indices k and r such that k  j  r and both Mi,k and Mi,r are not .
The set of (ordered) rows covering the jth column is denoted by Rs(j). The ﬁrst column that the ith row covers is denoted by l(i), and the last column that the ith row covers is denoted by r(i). As an example, in the SNP matrix in Figure 2, row 2 covers columns 2, 3, 4, 5 and 6, and Rs(5)= 1,2,4,7.
If Mi,j takes the value 0 and Mk,j takes the value 1 , or Mi,j takes the value 1 and Mk,j takes the value 0 , we say that the ith row and the kth row of M conﬂict at the column j.
If two rows of M do not conﬂict at any column, we say that they are compatible.
If the rows of a SNP matrix M can be partitioned into two subsets such that the rows in each subset are all compatible, then we say that the SNP matrix M is feasible.
Obviously, a SNP matrix M is feasible if and only if there are two haplotypes such that every row of M is compatible with one of the two haplotypes. In this case, we say that the SNP matrix M can be derived from the two haplotypes. Since a row of M comes from one of a pair of chromosomes, if there are no DNA sequencing errors, we can always derive M from the haplotypes of the pair of chromosomes.
However, DNA  A  C  G  T   G  C  C  T     SNPs    0 0 1  0  1  1  0  1 1 1 0 0    0 1    1   0   1 0 0  1   0 s t n e m g a r F Fig.1.
Haplotypes Fig.2.
A SNP matrix.
i106 sequencing errors are unavoidable and it is hard to decide which copy of chromosome a SNP fragment comes from.
This has made the individual haplotyping problem complicated.
Based on different optimal criteria, various computational models have been proposed for the problem.
Some typical models include (Lancia et al., 2001 Lippert et al., 2002): Minimum fragment Removal (MFR), Minimum SNPs Removal (MSR) and Minimum Error Correction (MEC). Among these models, MEC is considered to have most biological meaning.
MEC is also called Minimum Letter Flips (MLF) (Greenberg et al., 2004) and has been extended to include different extra information.
A DNA sequencer can provide a conﬁdence level for each base, which is the probability that the base was correctly read (Zhao et al., 2005). The conﬁdence levels for an m n SNP matrix M can be represented as an m n weight matrix W, in which the element Wi,j of W at row i and column j is the conﬁdence level of the value Mi,j. We also deﬁne Wi,j =0 if Mij = . By including a weight matrix, Greenberg et al. (2004) introduced the weighted minimum letter ﬂips (WMLF) model, and Zhao et al. (2005) formulated it as follows: Weighted Minimum Letter Flips (WMLF): Given a SNP matrix M and the corresponding weight matrix W, ﬂip a number of elements in M ( 0 into 1 and vice versa) so that the resulting matrix is feasible and the sum of the elements in W corresponding to the ﬂipped elements in M is minimized.
An individual s genotype can be phased relatively easily.
Wang et al. (2005) extended the MEC model as follows: MEC with Genotype Information (MEC/GI): Given a SNP matrix M and a genotype G, ﬂip a minimum number of elements in M ( 0 into 1 and vice versa) so that the resulting matrix can be derived by two haplotypes that make up the genotype G. In general, WMLF and MEC/GI are superior to MEC (or MLF) in the accuracy of haplotype reconstruction.
However, WMLF does not take genotype information into account, and MEC/GI does not consider the errors in a genotype and the conﬁdence levels of DNA bases.
In fact, there are always genotyping errors.
In order to improve the accuracy of haplotype reconstruction, we propose a new model in the next subsection.
2.2 WMLF incorporating genotyping uncertainty There are two broad categories of genotyping errors (Kang et al., 2004): operational errors and genotype scoring errors.
Recently, the operational errors have decreased signiﬁcantly in high-throughput genotyping due to biological technology advances.
On the other hand, genotype scoring errors are still a signiﬁcant challenge for automated scoring softwares (Kang et al., 2004), and research on kernel algorithms for genotype scoring remains a hot spot (Carvalho et al., 2007 Xiao et al., 2007). Limited by scoring softwares, genotyping errors are unavoidable (Kang et al., 2004 Zhu, 2006). Therefore, incorporating genotyping uncertainty will help the process of reconstructing haplotypes. To incorporate genotyping uncertainty, Kang et al. (2004) introduced GenoSpectrum. Considering n SNPs of a individual, a GenoSpectrum F is a 3 n matrix as given in Figure 3, where for each j, 1 j  n, f0,j, f1,j, f2,j are the likelihood that the individual s genotype at the jth SNP site is 0, 1 and 2, respectively.
[18:55 18/6/03 Bioinformatics-btn147.tex] Page: i106 i105 i113  Genotype 0: Genotype 1: Genotype 2: SNP1 f0,1 f1,1 f2,1 SNP2 f0,2 f1,2 f2,2      SNPn f2,n f1,n f2,n        Fig.3.
GenoSpectrum. Let H[j] and G[j] denote the jth character of a haplotype H and a genotype G, respectively.
Deﬁnition 1.
Let M be an m  n SNP matrix and let F be a 3  n GenoSpectrum. The most likely genotype GM,F of M with respect to F is deﬁned to be the genotype whose values satisfy the following conditions for all j: k: k maximizes fk,j, if Mi,j =   for all i  GM,F[j]= 2, if there are Mi,j and Ml,j such that Mi,j =0 and Ml,j =1  otherwise.
Mi,j : Mi,j (cid:2)=  , Roughly speaking, GM,F[j] gives an index h so that the value fh,j shows the degree of consistency of the jth column of the SNP matrix M and the jth column of the GenoSpectrum F. In particular, if all elements in the jth column of M are  , then the SNP matrix M provides no information for the jth SNP site.
Thus, the largest value fk,j in the jth column of F, where k= GM,F[j], shows the degree of conﬁdence that the most likely genotype of the jth SNP site is k. If there are both 0 s and 1 s in the jth column of M, then GM,F[j]=2 and the value f2,j is the degree of conﬁdence that the jth column in the SNP matrix M and the jth column in the GenoSpectrum F are consistent.
Finally, if the jth column in the SNP matrix M contains exactly one value q from 0,1 , then GM,F[j]= q and the value fq,j is the degree of conﬁdence that the jth column in the SNP matrix M and the jth column in the GenoSpectrum F are consistent.
Deﬁnition 2.
Let M be an m  n SNP matrix and let F be a 3  n GenoSpectrum. The distance d(M, F) between M and F is deﬁned as follows: d (M,F)= n(cid:5) j=1 (1 fGM,F[j],j), By the above discussion on the most likely genotype GM,F of M with respect to F, we can see, intuitively, that the distance d (M,F) measures the degree of inconsistency between the SNP matrix M and the GenoSpectrum F. Deﬁnition 3.
Let M be an m  n SNP matrix, W be an m  n weight matrix corresponding to M, F be a 3  n GenoSpectrum, gw be a weighted coefﬁcient, S be an element subset of M (i.e. S Mi,j 1 i m,1 j n ), and M be the SNP matrix derived from M by ﬂipping the elements in S. The ﬂipping cost of S based on gw, M, W and F is deﬁned as follows: (cid:5),F)+ C(S)= gw d(M Wi,j. (cid:5) (cid:5) Mi,j S Since the value d (M (cid:5),F) measures the degree of inconsistency between the SNP matrix M and the GenoSpectrum F, the ﬂipping cost C(S) of a subset S of elements in the SNP matrix M is measured (cid:5) A model of higher accuracy for WMEC/GS (cid:5) and the GenoSpectrum F (i.e. d (M Based on Deﬁnitions 2 and 3, the following equation holds true: in terms of two metrics: the degree of inconsistency between the (cid:5),F)), (cid:6) resulting SNP matrix M and the degree of conﬁdence that is decreased during ﬂipping the Mi,j S Wi,j). The weighted coefﬁcient gw is used elements in S (i.e. to adjust the relationship between these two metrics.
(cid:7) C(S)= n(cid:5) = ngw+ n(cid:5) gw (1 fGM(cid:5) ,F[j],j)+  gw fGM(cid:5) ,F[j],j+ (cid:5) i:Mi,j S (cid:5) i:Mi,j S j=1 j=1 (cid:8) (cid:7) (cid:8) Wi,j Wi,j (1) In the following, we propose a new computational model for the individual haplotyping problem.
WMLF/GS: (Weighted Minimum Letter Flips with GenoSpectrum) Given an m n SNP matrix M, an m n weight matrix W, a 3 n GenoSpectrum F and a weighted coefﬁcient gw, ﬁnd a subset S of elements in M and ﬂip the elements in S ( 0 into 1 and vice versa) so that the resulting matrix is feasible and the ﬂipping cost of the subset S based on gw, M, W and F is minimized.
It is easy to see that when the weighted coefﬁcient gw is set to 0, the WMLF/GS problem degenerates into the WMLF problem.
Let WMLF/GS(gw,M,W ,F) denote a solution to the WMLF/GS problem, i.e. an element subset S of M that minimizes C(S) under the condition that after ﬂipping the elements in S, M is feasible.
Theorem 1.
The WMLF/GS problem is NP-hard even if its SNP matrix is gapless. Proof.
The WMLF problem can be reduced from the weighted max-cut problem, which is a well-known NP-hard problem (Zhao et al., 2005). Similarly, the WMLF/GS problem can be reduced from the weighted max-cut problem.
The weighted max-cut problem is deﬁned as follows: given a undirected graph G=(V ,E) and a positive edge weight function w: E R+, ﬁnd a partition (V1,V2) of V such that the sum of the weights of the edges with one end in V1 and the other end in V2 is maximized.
For briefness, the sum of the weights of the edges with one end in V1 and the other end in V2 will be called the cut weight of (V1,V2), and the weight of an edge (i,j) is denoted by w(i,j). As an example, consider the graph G in Figure 4(a). Let V1= 1,4 and V2= 2,3.
Then the cut weight of (V1,V2) is 0.5+0.2+ 0.3+ 0.6=1.6. It can be easily veriﬁed that this cut has a maximum weight.
Given a undirected graph G=(V ,E) with n vertices and a positive edge weight function w, where, without loss of generality, the vertices are named as 1, 2,..., n. We can construct an n n SNP matrix M and a n n weight matrix W as follows: (cid:9) 0 if i= j, 1 if i(cid:2)= j  Mi,j =    0 1+(cid:6) w(i,j) Wi,j = if i(cid:2)= j and (i, j)(cid:2) E, if i(cid:2)= j and (i, j) E, if i= j.
(k,j) E w(k,j) i107 [18:55 18/6/03 Bioinformatics-btn147.tex] Page: i107 i105 i113  M.Xie et al. 1 0.2  3 0.5  0.1  0.6  (a) 0.3 2 4 0 (1.7)  1 (0.5)  1 (0.5)  0 (1.9)  1 (0.2)  1 (0.1)  1 (0)  1 (0.3)  1 (0.2)  1 (0.1)  0 (1.9)  1 (0.6)  1 (0)  1 (0.3) 1 (0.6) 0 (1.9) 0 0 1  0 0 1  0 0 1  0 0 1 (b) (c) Fig.4.
(a) A weighted graph.
(b) A SNP matrix corresponding to the weighted graph in (a), with weighted values given in brackets.
(c) A GenoSpectrum corresponding to the weighted graph in (a). The 3 n GenoSpectrum F can be constructed as follows: for j=1,...,n, f0,j = f1,j =0, f2,j =1. Let gw be any positive number.
According to the rules above, the SNP matrix M and the corresponding matrix W constructed from the undirected weighted graph G in Figure 4a are given in Figure 4b (with the weight values given in the brackets), and the GenoSpectrum F is given in Figure 4c. In general, for the SNP matrix M constructed above, the ith row represents the ith vertex of G, and a partition of V corresponds to a partition (S1= V1,S2= V2) of the rows of M. Let k be 1 or 2.
To make the rows in Sk compatible with each other and minimize the sum of the weights of the ﬂipped elements, for each row i Sk, all the elements of other rows in Sk at column i should ﬂip from (cid:6) 1 to 0, in order not to conﬂict with row i at column i.
Therefore, the minimum sum of the weights of the ﬂipped elements is equal to i,j Sk ,i(cid:2)=j Wi,j. Consequently, we have: (cid:5) i, j S1,i(cid:2)=j Wi, j+ = = Wi, j (cid:5) (cid:5) i, j S2,i(cid:2)=j (cid:5) i, j V1,(i, j) E w(i, j) (cid:5) (i, j) E  w(i, j)+ (cid:5) w(i, j) (cid:5) i, j V2,(i, j) E i V1, j V2,(i, j) E w(i, j) i V2,j V1,(i, j) E w(i, j). Let the set of the ﬂipped elements above be S. After ﬂipping the elements in S the distance between M and F is 0.
Therefore, C(S) is minimized if and only if the cut weight of (V1,V2) is maximized.
(cid:1) This completes the proof of the theorem.
In fact, most models for the individual haplotyping problem are NP-hard. To obtain exact solutions to these models, some dynamic programming and branch-and-bound algorithms have been proposed.
For larger problem instances, these exact algorithms become infeasible, and heuristic algorithms have been used instead.
However, heuristic algorithms usually cannot ensure accuracy.
Recently, ﬁxed-parameter tractability theory has been used to design practical exact algorithms for certain NP-hard problems with great success.
For the MFR and MSR problems, Xie et al. (2007) and Xie and Wang (2007) have proposed parameterized algorithms by taking the advantage of the characters of SNP fragments.
In the following section, we will use the technique to develop a parameterized algorithm for the WMLF/GS problem.
i108 3 METHODS In Xie and Wang (2007) and Xie et al. (2007), we have observed the following properties of DNA sequence fragment data.
Due to technical limits, the sequencing instruments such as ABI 3730 and MageBACE in most big sequencing centers can only sequence DNA fragments whose length is usually not more than 1200 nucleotide bases.
Since the SNP density is about 1 SNP per 1 kb, the maximum number of SNP sites that a fragment can cover is small.
Moreover, in DNA sequencing experiments, the fragment coverage is also small.
In both Celera s whole-genome shotgun assembly of the human genome and the human genome project of the International Human Genome Sequencing Consortium, the fragment average coverage is about ﬁve (International Human Genome Sequencing Consortium, 2001 Venter et al., 2001). Although the fragment covering rate varies along the whole genome, the fragment coverage plot in Huson et al. (2001) about the fragment data of the human genome project of Celera s shows that the number of fragments covering a site is bounded by 19.
Therefore, compared with the total number of fragments, the number of fragments that cover a SNP site is very small.
Based on the observations above, as in Xie and Wang (2007), we introduce the (k1,k2) parameterized condition.
Deﬁnition 4.
The (k1,k2) parameterized condition: a single fragment covers at most k1 SNP sites, and the number of fragments that cover a SNP site is bounded by k2. As to the corresponding SNP matrix M, the (k1,k2) parameterized condition means that each row of M covers at most k1 columns and each column of M is covered by at most k2 rows.
For an m n SNP matrix M, the parameters k1 and k2 can be obtained by scanning all rows of M. In the worst case, k1= n and k2= m. But as to the fragment data of Celera s human genome project, k2 is no more than 19 (Huson et al., 2001). 3.1 A parameterized algorithm for WMLF/GS In this subsection, the SNP matrix M is preprocessed as follows: sort the rows in M in ascending order such that for any two rows i1 and i2, if i1  i2, then l(i1) l(i2), which is similar to the preprocessing in Xie et al. (2007) and Xie and Wang (2007). For a solution to the WMLF/GS problem for a SNP matrix M, after ﬂipping the corresponding elements, all the rows of M can be partitioned into two classes H0 and H1, such that every two rows in the same class are compatible.
Deﬁnition 5.
Let R be a subset of rows in a SNP matrix M. A partition function P on R maps each row in R to one of the values 0,1.
Suppose that R contains h 0 rows, a partition function P on R can be denoted by an h-digit binary number in 0,1 , where the ith digit is the P value of the ith row in R. If R= , we also deﬁne a unique partition function P, which is denoted by 1.
[18:55 18/6/03 Bioinformatics-btn147.tex] Page: i108 i105 i113  A model of higher accuracy for WMEC/GS E[P,1]= gw+C1(Flips(P,1)) (4) Figure 5 gives a function CompFlipsW(j,P,Flips,C) to compute Flips(P,j) and Cj(Flips(P,j)), whose time complexity is O(k2) for a SNP matrix M satisfying the (k1,k2) parameterized condition.
In order to present our algorithm, we need to extend the above concepts from one column to two columns as follows.
Let the set of all rows that cover both columns j1 and j2 be Rc(j1,j2). (cid:5) (cid:5)= F[:,j], P Deﬁnition 8.
Fix a j.
Let gw be a weighted coefﬁcient, M (cid:5)= W[:,j], F W and the collection of all possible subsets VE[P (cid:5),j]= minS V C(S) and SB[P B[P C(SB[P and SB[P (cid:5)= M[:,j], be a partition function on Rc(j,j+1), (cid:5),j] be V.
Deﬁned (cid:5),j] to be any element in V that satisﬁes (cid:5),j], where C(S) and C(SB[(cid:5),j]) are the ﬂipping costs of S (cid:5),j])= B[P (cid:5),j], respectively, based on gw, M and F , W (cid:5) (cid:5) (cid:5). Given a j and a partition function P (cid:5) are known for each extension P of P calculated by the following equations: on Rc(j,j+1). If E[P,j] and SE[P,j] (cid:5) on Rs(j), B[P (cid:5),j] can be (cid:5),j] and SB[P B[P (cid:5), j]= P: P is an extension of P(cid:5) on Rs(j) min (E[P, j]) (5) SB[P (cid:5),j]= SE[P,j], where P minimizes E[P,j] (6) Inversely, for any partition function P on Rs(j), because Rc(j 1, j) is a (cid:5),j 1] and subset of Rs(j), the project P (cid:5), j 1] are known, E[P, j] and SE[P, j] can be calculated according to B[P the following equations, whose correctness can be proved similarly as that for Equations (3) and (4). of P on Rs(j) is unique.
When SB[P (cid:5) SE[P, j]= SB[P (cid:5), j 1] Flips(P, j) E[P, j]= B[P (cid:5),j 1]+gw+Cj(Flips(P, j)) (7) (8) Based on Equations (2) (8), the solution to the WMLF/GS problem for a SNP matrix M can be obtained as follows: ﬁrst, E[P,1] and SE[P,1] Recall that Rs(j) denotes the set of rows in the SNP matrix M that cover the jth column.
For briefness, a partition function deﬁned on Rs(j) is called a partition function at column j.
For a SNP matrix M satisfying the (k1,k2) parameterized condition, there are at most 2k2 different partition functions at column j.
(cid:5) (cid:5) (cid:5) (cid:5) of R, the partition function P is called the projection of P on R Let R be a set of rows of the matrix M, and P be a partition function on R. obtained by restricting , and P is called an For a subset R P on the subset R (cid:5) extension of P For briefness, let M(j) denote the set of all non-empty elements from column 1 to column j in M, and M[:,j] ( W[:,j], or F[:,j] ) denotes the SNP matrix (resp. the weighted matrix, or the GenoSpectrum) consisting of the ﬁrst j columns of M (resp. W, or F). on R. on R (cid:5) Deﬁnition 6.
Fix a j.
Let P be a partition function on a row set R. Deﬁned VE[P,j] to be any subset S of elements of M that satisﬁes the following conditions: (1) For each element Mr,k in S, 1 k j.
(2) After ﬂipping the elements of S, there is a partition (H0,H1) of all rows in M such that any two rows in the same class do not conﬂict at any column from 1 to j, and for any row i R, row i is in the class Hq if and only if P(i)= q, for q 0,1.
Deﬁnition 7.
Fix a column index j.
Let gw be a weighted coefﬁcient, (cid:5)= M[:,j], W (cid:5)= F[:,j], P be a partition function at column M j, and the collection of all possible subsets VE[P,j] be V.
Deﬁned E[P,j]= minS V C(S) and SE[P,j] to be any subset in V that satisﬁes C(SE[P,j])= E[P,j], where C(S) and C(SE[P,j]) are the ﬂipping costs of S and SE[P,j], respectively, based on gw, M (cid:5)= W[:,j], F , and F , W (cid:5) (cid:5) (cid:5). From Deﬁnitions 6 and 7, it is easy to verify that the following equation holds true: E (cid:5) (cid:5) E E i:Mi,l V l [P,j]). l=1 Cl(V l E [P,j]) denote Given a VE[P,j], let M WMLF/GS(gw,M,W ,F)= SE[P,n], (cid:6) (2) where P is a partition function at column n that minimizes E[P,n]. be the SNP matrix derived from M[:,j] by ﬂipping the elements in VE[P,j], and V l [P,j] be the set of the elements of M that [P,j] Wi,l are in column l and in VE[P,j]. Let Cl(V l gwfGM(cid:5) ,F[:,j][l],l, where GM(cid:5),F[:,j][l] is the value at column l of the most likely , and fGM(cid:5) ,F[:,j][l],l is the value of the element in F[:,j] at genotype of M row GM(cid:5),F[:,j][l] and column l. From Equation (1), the ﬂipping cost of C(VE[P,j])= j gw+(cid:6)j VE[P,j] based on gw, M[:,j], W[:,j] and F[:,j] can be calculated as follows: Given a partition function P at column j, the rows covering column j can be partitioned into (H0,H1) by P according to the following rule: for each row i Rs(j), i Hq if P(i)= q.
In order to make the rows in the same class not conﬂict at column j, the values at column j of some rows may have to be ﬂipped. For q 0,1 , let vq=0 or 1.
For any row i Hq, if Mi,j = vq, Mi,j is Cj(Flips)=(cid:6) to be ﬂipped. In consequence, we obtain a set Flips of ﬂipped elements, and (cid:5) is the SNP matrix derived from M[:,j] by ﬂipping the elements in Flips.
Obviously, M Let g(v0,v1) be a map such that: if v0= v1=0, g(v0,v1)=1 if v0= v1=1, g(v0,v1)=0 and if v0(cid:2)= v1, g(v0,v1)=2. Based on Deﬁnition 1, It is easy to see that GM(cid:5),F[:,j][j]= g(v0,v1). For k,v=0,1, let w(P,j,k,v) denote(cid:5) i:i Rs(j),P(i)=q,Mi,j=vq Wi,j gwfGM(cid:5) ,F[:,j][j],j, where M q=0,1 (cid:5) is feasible.
(cid:6) i:i Rs(j),P(i)=k,Mi,j=v Wi,j. Let Minor(P,j,0) and Minor(P,j,1) denote the value of v0 and the value of v1 that minimize w(P,j,0,v0)+w(P,j,1,v1) gwfg(v0,v1),j, respectively.
Let Flips(P,j) denote the set of the ﬂipped elements Mi,j  Mi,j =Minor(P,j,P(i)). [P,j]) is the minimum if and only Fix a P and a j, it is obvious that Cl(V l [P,j]=Flips(P,j). Therefore, the following equations hold true.
E if V l E SE[P,1]=Flips(P,1) (3) Fig.5.
CompFlipsW. i109 [18:55 18/6/03 Bioinformatics-btn147.tex] Page: i109 i105 i113  M.Xie et al. (cid:5) (cid:5),1] and SB[P are obtained according to Equations (3) and (4) for all partition functions P at column 1 second, B[P (cid:5),1] can be obtained by using on Rc(1,2) third, E[P,2] Equations (5) and (6) for all partition functions P and SE[P,2] can be obtained by using Equations (7) and (8) for all partition functions P on Rs(2) and so on.
Finally, E[P,n] and SE[P,n] can be obtained for all partition functions P at column n. Once E[P,n] and SE[P,n] for all possible P are known, a solution to the WMLF/GS problem for M can be obtained by using Equation (2). See Figure 6 for the details of our P-WMLF/GS algorithm.
Theorem 2.
If an m n SNP matrix M satisﬁes the (k1,k2) parameterized condition, the P-WMLF/GS algorithm solves the WMLF/GS problem in time O(nk22k2 +mlogm+mk1) and space O(mk12k2 +nk2). Proof.
Given an m n SNP matrix M satisfying the (k1,k2) parameterized condition, consider the following data structure: each row keeps the ﬁrst and the last column that the row covers, i.e. its left and right value, and its values at the columns from its left column to its right column.
In such a data structure, M takes space O(mk1). It is easy to see that Rs takes space O(nk2), H takes space O(n), E and B take space O(2k2 ) and SE and SB take space O(mk12k2 ). In summary, the space complexity of the algorithm is O(mk12k2 +nk2). Now we discuss the time complexity of the algorithm.
In Step 1, sorting takes time O(mlogm). All Rss can be obtained by scanning the rows only once, which takes time O(mk1). For any column j, because no more than k2 rows cover it, H[j] k2, the function CompFlipsW takes time O(k2), and Step 2 takes time O(k22k2 ). In Step 3.1, scanning Rs(j) and Rs(j+1) simultaneously can obtain Nc and Bits, and takes time O(k2). Step 3.2 takes time O(2k2 ), and Step 3.3 takes time O(k22k2 ). In Step 3.5, for each P , there (cid:5) are 2H[j] NC extensions of P can be , an extension of P on Rs(j). Given P (cid:5) (cid:5) (cid:5) obtained by a bit-or operation in time O(1), because after the sorting in Step 1, the rows that cover column j, but do not cover column j 1 are all behind the rows in Rc(j 1,j). In all, Step 3.5 takes time O(k22Nc 2k2 Nc ). Then Step 3 is iterated n 1 times and takes time O(nk22k2 ). Step 4 takes time O(2k2 ). In summary, the time complexity of the algorithm is O(nk22k2 +mlogm+mk1). (cid:1) This completes the proof of the theorem.
4 EXPERIMENTAL RESULTS We compare three models WMLF/GS, MEC/GI and WMLF for the individual haplotyping problem.
For WMLF/GS, we adopt our P- WMLF/GS algorithm for MEC/GI, we adopt Wang et al. s genetic algorithm GA-MEC/GI (Wang et al., 2005) and for WMLF, we adopt Zhao et al. s dynamic clustering algorithm DC-WMLF (Zhao et al., 2005). In the experiments, we compare the running time and the reconstruction rate of haplotypes (Wang et al., 2005) of these three algorithms.
The reconstruction rate of haplotypes is deﬁned as the ratio of the number of the SNP sites that are correctly inferred out by an algorithm to the total number of the SNP sites of the haplotypes. The haplotype data can be obtained by two methods (Wang et al., 2005): the ﬁrst is to get real haplotypes from public domain, and the second is to generate simulated haplotypes by computers.
In our experiments, the real haplotypes were obtained from the ﬁle genotypes_chr1_CEU_r21_nr_fwd_phased.gz,1 which was issued in July 2006 by the International HapMap Project (2005). The ﬁle contains 120 haplotypes on chromosome 1 of 60 individuals of the CEU with each haplotype containing 193 333 SNP sites.
From the 60 individuals, select a individual at random.
Then beginning with a random SNP site, a pair of haplotypes of a given length can be obtained from the haplotypes of the selected individual.
The simulated haplotypes can be generated as follows (Panconesi and Sozio, 2004 Wang et al., 2005). At ﬁrst a haplotype h1 of length n is generated at random, then another haplotype h2 of the same length is generated by ﬂipping every character of h1 with a probability of d. As to fragment data, to the best of our knowledge, real DNA fragments data in the public domain are not available, and references Wang et al. (2005) and Panconesi and Sozio (2004) used computer- generated simulated fragment data.
After obtaining a pair of real or simulated haplotypes, in order to make the generated fragments have the same statistical features as the real data, a widely used shotgun assembly simulator Celsim (Myers, 1999) is invoked to generate m fragments whose lengths are between lMin and lMax. At last the output fragments are processed to plant reading errors with probability es and empty values with probability p. In our experiments, the parameters are as follows: fragment coverage rate c=10, the difference rate between two haplotypes d = 20%, the minimal length of fragment lMin=3, the maximal length of fragment lMax=7 and empty values probability p=2%. The weight matrix W corresponding to the fragments is generated by the method of Zhao et al. (2005): the entries of w are normally distributed with mean µ and variance σ 2=0.05. For a correct SNP site, µ=0.9, and for an error SNP site, µ=0.8. The genotype without error can be obtained from the pair of haplotypes produced above.
Since the genotyping error in biological Fig.6.
P-WMLF/GS algorithm.
1From http://www.hapmap.org/downloads/phasing/2006-07_phaseII/phased/ i110 [18:55 18/6/03 Bioinformatics-btn147.tex] Page: i110 i105 i113  assay is about 1% (Xiao et al., 2007), we plant some errors in the genotype (Zhu, 2006) by changing the value of every char of the genotype with a probability eg as follows: if the value is 0 or 1 , it is changed to 2  if the value is 2 , it is changed to 0 or 1 randomly.
The GenoSpectrum F is generated as follows.
For the column j at which the genotype is k: when k is correct, if k=0 (or 1), f0,j (or f1,j) is normally distributed with mean µ=0.9 and variance σ 2=0.05, f1,j (or f0,j) = 0, f2,j = max(0,1 f0,j) (or max(0,1 f1,j) if k=2, f2,j is normally distributed with mean µ=0.9 and variance σ 2=0.05, and f0,j and f1,j, are normally distributed with mean µ=0.05 and variance σ 2=0.05 when k is error, suppose the correct genotype at column j is i, then fk,j and fi,j are normally distributed with variance 0.05 and means 0.8 and 0.2, respectively.
For the remained element of F at column j, let it be max(0,1 fi,j fk,j). We ran our experiments on a Linux server (4 Intel Xeon 3.6GHz CPU and 4GByte RAM) with the length of haplotype n, the number of fragments m (m=2 n c/(lMax+lMin)), the reading error probability es and the genotype error eg varied.
The data of the following tables and ﬁgures are the average over 100 repeated experiments.
To select a appropriate weighted coefﬁcient gw, we change gw from 0 to 6.5, and examine the haplotype reconstruction rate of P-WMLF/GS on the simulated data with n=80, es and eg be randomly selected from 0 to 5%. The experiment result is illustrated by Figure 7.
Figure 7 shows that when gw=2.5, i. e. 1/4 of c, P-WLMF/GS achieves the highest haplotype reconstruction rate.
In the following experiments, we set gw=2.5. When es varies from from 3 to 7% and eg varies from 0 to 7%, we test the three algorithms on both the real haplotype data and the simulated haplotype data with n=100 and m=200. The experiment results are presented in Table 1, in which the experiment results on the real haplotype data are put outside brackets, and the experiment results on the simulated haplotype data are enclosed in brackets.
As shown in Table 1, the haplotype reconstruction rate of WMLF/GS and MEC/GI are decreasing with the increasing of es and eg. Since WMLF does not consider the genotype information, its haplotype reconstruction rate is not related with eg, but is decreasing with the increasing of es.
Although there are errors planted in the genotype information, the false-genotype alleles are much less than the true-genotype alleles, and the positive impact suppresses the negative impact of the genotype information.
A model of higher accuracy for WMEC/GS For using the genotype information, MEC/GI gets higher haplotype reconstruction rate than WMLF, which is illustrated in Table 1.
Anyway, the experiment results on both the real and the simulated haplotype data show consistently that, in the reconstruction rate of haplotypes, WMLF/GS model is about 4% more accurate than MEC/GI model and is about 12% more accurate than WMLF model.
As shown in Figure 8, when es= eg=5%, the experiments on both the real and the simulated haplotype data with n increasing from 20 to 120 also show that P-WMLF/GS is the most accurate algorithm in haplotype reconstruction rate.
In Figure 8, the left Y-axis shows the reconstruction rate of haplotypes, and the right Y-axis shows the running time.
Figure 8a shows the experiment results on the real haplotype data, and Figure 8b shows the experiment results on the simulated haplotype data.
When n increases, the haplotype reconstruction rate of the three algorithms decreases, and their running time increases accordingly.
In Figure 8a, when n=20, the haplotype reconstruction rates of P-WMLF/GS, GA-MEC/GI and WMLF are 96.6, 93.0 and 84.9%, respectively and their running time are 1.3, 0.4 and 0.0007 s. When n increases to 120, their haplotype reconstruction rates decrease to 93.5, 88.1 and 79.8% and their running time increases to 10.2, 6.5 and 0.008 s. The experiment results in Figure 8b are similar.
Although P-WMLF/GS is the slowest among the three Fig.7.
The performance of P-WMLF/GS with gw varying.
Table 1.
Comparison of the haplotype reconstruction rate of the algorithms with es and eg varying eg es=3% Haplotype reconstruction rate (%) es=5% es=7% (%) WMLF/GS MEC/GI WMLF WMLF/GS MEC/GI WMLF WMLF/GS MEC/GI WMLF 0 3 5 7 94.6 (94.7) 94.3 (93.8) 95.0 (93.8) 93.9 (93.3) 90.5 (90.7) 90.2 (89.5) 89.6 (88.7) 87.5 (88.7) 80.5 (80.4) 81.1 (80.3) 80.0 (80.5) 79.8 (80.9) 94.2 (94.0) 92.1 (93.7) 93.5 (93.2) 92.9 (93.2) 89.6 (90.5) 88.3 (89.3) 89.7 (88.5) 88.4 (87.9) 79.8 (80.1) 80.2 (80.0) 79.3 (80.0) 79.9 (80.2) 93.6 (93.7) 92.1 (93.1) 91.6 (92.6) 92.8 (93.0) 90.1 (90.3) 88.6 (88.9) 87.5 (87.4) 87.4 (87.3) 80.1 (79.6) 79.0 (79.5) 80.0 (79.7) 80.1 (80.0) The data not enclosed in brackets are the experiment results on the real haplotype data, and the date enclosed in brackets are the experiment results on the simulated haplotype data.
All experiments are repeated 100 times with n=100 and m=200. i111 [18:55 18/6/03 Bioinformatics-btn147.tex] Page: i111 i105 i113  M.Xie et al. (a) On the real haplotype data (b) On the simulated haplotype data Fig.8.
The performance comparison of the algorithms when n increases.
algorithms, with the fragment coverage rate ﬁxed, the running time of P-WMLF/GS is a linear function of n, which is very acceptable.
The running time of P-WMLF/GS is about 10 s when n=120. 5 CONCLUSION Haplotyping plays an increasingly important role in some regions of genetics such as locating of genes, designing of drugs and forensic applications.
The typical computational models of individual haplotyping problem are MFR, MSR, MEC and the variations of MEC. By including the conﬁdence levels a DNA sequencer provides and the genotyping uncertainty, the current article proposes a new computational model WMLF/GS, and proves it to be NP-hard. Based on the fact that the maximum number of fragments covering a SNP site is small (usually no more than 19, Huson et al. the current article proposed a parameterized algorithm P-WMLF/GS to solve the WMLF/GS problem.
With the fragment maximum length k1 and the maximum number k2 of fragments covering a SNP site, (2001)), i112 the P-WMLF/GS algorithm can solve the WMLF/GS problem in time O(nk22k2 +mlogm+mk1) and in space O(mk12k2 +nk2). Extensive experiments show that WMLF/GS has higher haplotype reconstruction rate than other models, and that P-WMLF/GS algorithm is practical.
ACKNOWLEDGEMENTS The authors are very grateful to the anonymous referees for comments and help in improving the presentation of the earlier version of the paper.
Funding: This research was supported in part by the National Natural Science Foundation of China under Grant Nos.
60433020 and 60773111, the National Basic Research 973 Program of China No.2008CB317107, the Program for New Century Excellent Talents in University No.NCET-05-0683, the Program for Changjiang Scholars and Innovative Research Team in University No.IRT0661 and the Scientiﬁc Research Fund of Hunan Provincial Education Department under Grant No.06C526. Conﬂict of Interest: none declared.
REFERENCES Adkins,R.M. (2004) Comparison of the accuracy of methods of computational haplotype inference using a large empirical dataset. BMC Genet., 5, 22.
Akey,J. et al. (2001) Haplotypes vs single marker linkage disequilibrium tests: what do we gain Eur. J. Hum.
Genet., 9, 291 300.
Bonizzoni,P. et al. (2003) The haplotyping problem: an overview of computational models and solutions.
J. Comp.
Sci.
Technol., 18, 675 688.
Carvalho,B. et al. (2007) Exploration, normalization, and genotype calls of high-density oligonucleotide SNP array data.
Biostatistics, 8, 485 499.
Greenberg,H.J. et al. (2004) Opportunities for combinatorial optimization in computational biology.
INFORMS J.
Comput., 16, 211 231.
Huson,D.H. et al. (2001) Comparing assemblies using fragments and mate-pairs.
In Gascuel,O. and Moret,B.M.E. (eds) Proceedings of the 1st International Workshop on Algorithms in Bioinformatics, Vol.2149, Lecture Notes in Computer Science, Springer, Berlin/Heidelberg, pp.
294 306. International Human Genome Sequencing Consortium (2001) Initial sequencing and analysis of the human genome.
Nature, 409, 860 921.
Kang,H. et al. (2004) Incorporating genotyping uncertainty in haplotype inference for single-nucleotide polymorphisms. Am.
J. Hum.
Genet., 74, 495 510.
Lancia,G. et al. (2001) SNPs problems, complexity and algorithms.
In auf der Heide,F.M. (ed.) Proceedings of Annual European Symposium on Algorithms (ESA), Vol.2161, Lecture Notes in Computer Science, Springer, Berlin/Heidelberg, pp.
182 193.
Levy,S. et al. (2007) The diploid genome sequence of an individual human.
PLoS Biology, 5, e254 e254. Lippert,R. et al. (2002) Algorithmic strategies for the single nucleotide polymorphism haplotype assembly problem.
Brief.
Bioinform., 3, 1 9.
Myers,G. (1999) A dataset generator for whole genome shotgun sequencing.
In Lengauer,T. Schneider,R. Bork,P. Brutlag,D.L. Glasgow,J.I. Mewes,H.W. and Zimmer,R. the 7th International Conference for Molecular Biology.
AAAI Press, California, on Intelligent Systems pp.
202 210.
(eds), Proceedings of Panconesi,A. and Sozio,M. (2004) Fast hare: a fast heuristic for single individual SNP haplotype reconstruction.
In Jonassen,I. and Kim,J. (eds) Proceedings of the 4th International Workshop on Algorithms in Bioinformatics, Vol.3240, Lecture Notes in Computer Science, Springer, Berlin/Heidelberg, pp.
266 277.
The International HapMap Consortium (2005) A haplotype map of the human genome.
Nature, 437, 1299 1320.
Venter,J.C. et al. (2001) The sequence of the human genome.
Science, 291, 1304 1351.
Wang,R.S. et al. (2005) Haplotype reconstruction from SNP fragments by minimum error correction.
Bioinformatics, 21, 2456 2462.
Xiao,Y. et al. (2007) A multi-array multi-SNP genotyping algorithm for affymetrix SNP microarrays. Bioinformatics, 23, 1459 1467.
[18:55 18/6/03 Bioinformatics-btn147.tex] Page: i112 i105 i113  Xie,M. (2007) An and Wang,J. parameterized algorithm for the individual haplotyping problem mfr with mate-pairs.
Algorithmica, DOI 10.1007/s00453-007-9150-2, http://www. springerlink.com/ content/p2202u8wrnr65117/. improved practical) (and A model of higher accuracy for WMEC/GS Zhang,X.S. et al. (2006) Models and algorithms for haplotyping problem.
Curr. Bioinform., 1, 105 114.
Zhao,Y.Y. et al. (2005) Haplotype assembly from aligned weighted SNP fragments.
Comput. Biol.
Chem., 29, 281 287.
Xie,M. et al. (2007) Research on parameterized algorithms of the individual haplotyping Zhu,W.S. (2006) Statistical Methods for Haplotype Analysis with Genotyping Errors.
problem.
J. Bioinform. Comput. Biol., 5, 795 816.
Ph. d. thesis, Northeast Normal University, Changchun. [18:55 18/6/03 Bioinformatics-btn147.tex] Page: i113 i105 i113 i113 